{"version":3,"sources":["IntroTips.js"],"names":["require","convertAssetArrayToObject","lodash","cc","Class","extends","Component","properties","display","Node","phase1","Label","symbol","Sprite","phase2","imageList","SpriteFrame","textList","JsonAsset","onLoad","node","config","SHOW_INTRO_TIPS","on","showRandomIntro","bind","hideIntro","specSymbols","forEach","push","it","name","loadTextFromFile","json","data","INTRO_GAME_PLAY","start","curIndex","opacity","speed","isFirstShow","assets","scheduleOnce","showIntro","stopAllActions","destination","Vec2","width","runAction","sequence","callFunc","reset","parseString","length","delayTime","center","x","distance","street","Math","abs","time","moveBy","str","arrStr","split","groupStr","runIndex","indexGroup","phase","element","findSpecialSymbol","space","filter","removeAllChildren","isEqual","addStrToTips","addSpriteToTips","getComponent","Layout","updateLayout","tem","instantiate","string","addChild","spriteFrame","found","index","sym","active","onDestroy","unscheduleAllCallbacks","off"],"mappings":"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","file":"IntroTips.js","sourceRoot":"../../../../../../assets/cc-common/cc-slotbase-v2/gui","sourcesContent":["const {convertAssetArrayToObject} = require('utils');\nconst lodash = require('lodash');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        display : cc.Node,\n        phase1: cc.Label,\n        symbol: cc.Sprite,\n        phase2: cc.Label,\n        imageList: [cc.SpriteFrame],\n        textList: cc.JsonAsset,\n    },\n\n    onLoad(){\n        if (this.node.config.SHOW_INTRO_TIPS) {\n            this.node.on(\"SHOW_INTRO\",this.showRandomIntro.bind(this),this);\n            this.node.on(\"HIDE_INTRO\",this.hideIntro.bind(this),this);\n        }\n        this.specSymbols = [];\n        this.imageList.forEach(it=>{this.specSymbols.push(it.name);});\n        this.loadTextFromFile();\n    },\n\n    loadTextFromFile() {\n        if (this.textList && this.textList.json.data) {\n            this.node.config.INTRO_GAME_PLAY = this.textList.json.data;\n        }\n    },\n\n    start() {\n        this.curIndex = 0;\n        this.node.opacity = 1;\n        this.display.opacity = 1;\n        this.speed = 200;\n        this.isFirstShow = true;\n        this.assets = convertAssetArrayToObject(this.imageList);\n        if (this.node.config.SHOW_INTRO_TIPS) {\n            this.scheduleOnce(()=>{\n                this.node.opacity = 255;\n                this.showRandomIntro();\n            },1);\n        }\n    },\n\n    showIntro() {\n        this.display.opacity = 255;    \n    },\n\n    showRandomIntro(){\n        this.node.stopAllActions();\n        this.display.stopAllActions();\n\n        const destination = new cc.Vec2(-this.node.width/2,0);\n        this.node.runAction(cc.sequence(\n            cc.callFunc(()=>{\n                this.reset();\n                this.parseString(this.node.config.INTRO_GAME_PLAY[this.curIndex]);\n                this.curIndex = (this.curIndex + 1) % this.node.config.INTRO_GAME_PLAY.length;\n                \n            }),\n            cc.delayTime(2),\n            cc.callFunc(()=>{\n                this.showIntro();\n                const center = (this.display.width - this.node.width) / 2;\n                this.display.x = this.display.width - this.node.width > 0 ? center : 0;\n            }),\n            cc.delayTime(2),\n            cc.callFunc(()=>{\n                const distance = this.display.width + this.node.width / 2;\n                const street  = Math.abs(destination.x - distance) ;\n                let time = street / this.speed ;\n                if (street > this.node.width/2) {\n                    this.display.runAction(cc.sequence(\n                        cc.moveBy(time, -street, 0),\n                        cc.callFunc(()=>{\n                            this.showRandomIntro();\n                        }),\n                    ));\n                } else {\n                    this.display.runAction(cc.sequence(\n                        cc.delayTime(time),\n                        cc.callFunc(()=>{\n                            this.showRandomIntro();\n                        }),\n                    ));\n                }\n                this.isFirstShow = false;\n            }),\n        ));\n    },\n\n    parseString(str = \"\"){\n        let arrStr = str.split(' ');\n        let groupStr = [];\n        let runIndex = 0;\n        let indexGroup = 0;\n        let phase = '';\n        while(runIndex < arrStr.length) {\n            const element = arrStr[runIndex];\n            let symbol  = this.findSpecialSymbol(element);\n            if (symbol == null) {\n                let space = (runIndex === arrStr.length - 1) ? '' : \" \";\n                phase += element + space;\n                groupStr[indexGroup] = {phase : phase, symbol : null};\n            } else {\n                indexGroup++;\n                groupStr[indexGroup] = {phase : element, symbol : symbol};\n                phase = '';\n                indexGroup++;\n            }\n            runIndex++;\n        }\n        groupStr = groupStr.filter(it=> it != null);\n        this.display.removeAllChildren();\n        groupStr && groupStr.forEach(it=>{\n            if (lodash.isEqual(it.symbol, null)){\n                this.addStrToTips(it.phase);\n            } else {\n                this.addStrToTips(\"   \");\n                this.addSpriteToTips(it.symbol);\n                this.addStrToTips(\"   \");\n            }\n        });\n        this.display.getComponent(cc.Layout).updateLayout();\n    },\n\n    addStrToTips(str = ''){\n        const tem = cc.instantiate(this.phase1.node);\n        tem.getComponent(cc.Label).string = str;\n        this.display.addChild(tem);\n    },\n\n    addSpriteToTips(symbol){\n        const tem = cc.instantiate(this.symbol.node);\n        tem.getComponent(cc.Sprite).spriteFrame = this.assets[symbol];\n        this.display.addChild(tem);\n    },\n\n    findSpecialSymbol(str = \"\"){\n        let found = -1;\n        this.specSymbols.forEach((it,index)=>{\n            let sym = '[' + it + ']';\n            if (lodash.isEqual(sym, str)) found = index;\n        });\n        return (found != -1) ? this.specSymbols[found] : null;\n    },\n\n    reset(){\n        this.display.opacity = 0;\n        this.phase1.string = \"\";\n        this.symbol.spriteFrame = null;\n        this.phase2.string = \"\";\n    },\n\n    hideIntro(){\n        this.node.stopAllActions();\n        this.display.stopAllActions();\n        this.node.active = false;\n    },\n\n    onDestroy(){\n        this.unscheduleAllCallbacks();\n        this.node.stopAllActions();\n        this.display.stopAllActions();\n        if (this.node.config.SHOW_INTRO_TIPS) {\n            this.node.off(\"SHOW_INTRO\",this.showRandomIntro.bind(this),this);\n            this.node.off(\"HIDE_INTRO\",this.hideIntro.bind(this),this);\n        }\n    }\n});\n"]}