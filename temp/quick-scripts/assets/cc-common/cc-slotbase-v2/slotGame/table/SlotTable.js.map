{"version":3,"sources":["SlotTable.js"],"names":["cc","Class","extends","Component","properties","table","Node","reelPrefab","Prefab","symbolPrefab","isFreeMode","onLoad","node","on","init","setMode","startSpinning","stopSpinning","fastToResult","changeMatrix","stopReelRoll","stopReeWithRandomMatrix","mode","isFastToResult","curentConfig","config","STATS","reels","tableFormat","TABLE_FORMAT","col","length","reel","instantiate","name","parent","mainComponent","x","getXPosition","y","SYMBOL_HEIGHT","index","SYMBOL_WIDTH","SYMBOL_MARGIN_RIGHT","matrix","rowOffset","row","showSymbols","changeToSymbol","startSpinningWithDelay","emit","matrixRandom","getRandomSymbolNameWithExceptions","data","callback","bigSymbols","stopSpinningCallbackCount","currentCol","symbolValue","push","stopSpinningWithDelay","checkStopSpinningCallback","bind","context","count","runAction","sequence","delayTime","REEL_EASING_TIME","callFunc","fastStopSpinning"],"mappings":"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","file":"SlotTable.js","sourceRoot":"../../../../../../../assets/cc-common/cc-slotbase-v2/slotGame/table","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        table: cc.Node,\n        reelPrefab: cc.Prefab,\n        symbolPrefab: cc.Prefab,\n        isFreeMode: false\n    },\n    onLoad() {\n        if (!this.table) this.table = this.node;\n\n        this.node.on(\"INIT\",this.init,this);\n        this.node.on(\"SET_MODE\",this.setMode,this);\n        this.node.on(\"START_SPINNING\",this.startSpinning,this);\n        this.node.on(\"STOP_SPINNING\",this.stopSpinning,this);\n        this.node.on(\"FAST_TO_RESULT\",this.fastToResult,this);\n        this.node.on(\"CHANGE_MATRIX\",this.changeMatrix,this);\n\n        this.node.on(\"STOP_REEL_ROOL\",this.stopReelRoll,this);\n        this.node.on(\"STOP_REEL_WITH_RANDOM_MATRIX\",this.stopReeWithRandomMatrix,this);\n\n        this.node.mode = 'FAST';\n    },\n    init() {\n        this.isFastToResult = false;\n        this.node.curentConfig = this.node.config.STATS[this.node.mode];\n        this.node.reels = [];\n        this.tableFormat = this.node.config.TABLE_FORMAT;\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            const reel = cc.instantiate(this.reelPrefab);\n            //Must attach to node so component can be loadded\n            reel.name = \"Reel_\" + col;\n            reel.parent = this.table;\n            //Then we can use this\n            reel.mainComponent.init(this.tableFormat[col], this.node.config, col, this.symbolPrefab);\n            reel.x = this.getXPosition(col);\n            reel.y += -1*(this.tableFormat[col] - 3)*this.node.config.SYMBOL_HEIGHT/2;\n            this.node.reels[col] = reel.mainComponent;\n        }\n    },\n    getXPosition(index) {\n        return (this.node.config.SYMBOL_WIDTH + this.node.config.SYMBOL_MARGIN_RIGHT) * index;\n    },\n    setMode(mode) {\n        this.node.mode = mode;\n    },\n    changeMatrix({matrix, rowOffset = 0}) {\n        this.matrix = matrix;\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            for (let row = 0; row < this.tableFormat[col]; ++row) {\n                this.node.reels[col].showSymbols[row+rowOffset].changeToSymbol(this.matrix[col][row]);\n            }\n        }\n    },\n    stopReelRoll() {\n        for (let col = 0; col < this.node.reels.length; ++col) {\n            this.node.reels[col].stopReelRoll();\n        }\n    },\n    startSpinning() {\n        this.isFastToResult = false;\n        this.node.curentConfig = this.node.config.STATS[this.node.mode];\n        for (let col = 0; col < this.node.reels.length; ++col) {\n            this.node.reels[col].setMode(this.node.mode);\n            this.node.reels[col].startSpinningWithDelay(col);\n        }\n        this.node.emit('TABLE_START_NEARWIN');\n        this.node.emit('TABLE_START_SOUND');\n        this.node.emit('TABLE_START_EFFECT');\n        this.node.emit('TABLE_START_MISC');\n    },\n    stopReeWithRandomMatrix() {\n        this.matrixRandom = [];\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            this.matrixRandom[col] = [];\n            for (let row = this.tableFormat[col] - 1; row >=0 ; --row) {\n                const reel = this.node.reels[col];\n                if(reel && reel.getRandomSymbolNameWithExceptions){\n                    this.matrixRandom[col][row] = reel.getRandomSymbolNameWithExceptions(['A', 'R', 'K']);\n                }else{\n                    this.matrixRandom[col][row] = \"3\";\n                }\n            }\n        }\n        this.stopSpinning(this.matrixRandom, () => {});\n    },\n\n    stopSpinning(data, callback) {\n        this.matrix = data;\n        this.node.bigSymbols = [];\n        this.stopSpinningCallbackCount = 0;\n\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            const currentCol = this.matrix[col];\n            let matrix = [];\n            for (let row = currentCol.length-1; row >=0 ; --row) {\n                let symbolValue = currentCol[row];\n\n                this.node.emit('CHECK_MEGA_SYMBOL',symbolValue,col,row);\n\n                matrix.push(symbolValue);\n            }\n            this.node.reels[col].stopSpinningWithDelay(col, matrix, this.checkStopSpinningCallback.bind(this, matrix, callback));\n        }\n        \n        if (this.table) {\n            this.table.bigSymbols = this.node.bigSymbols;\n        }\n\n        this.node.emit('REEL_ABOUT_TO_STOP_NEARWIN', {reels: this.node.reels, data, context: this,});\n        this.node.emit('REEL_ABOUT_TO_STOP_SOUND', {reels: this.node.reels, data, context: this,});\n        this.node.emit('REEL_ABOUT_TO_STOP_EFFECT', {reels: this.node.reels, data, context: this,});\n        this.node.emit('REEL_ABOUT_TO_STOP_MISC', {reels: this.node.reels, data, context: this,});\n    },\n    checkStopSpinningCallback(matrix, callback) {\n        this.stopSpinningCallbackCount++;\n        const count = this.stopSpinningCallbackCount;\n\n        if (count >= this.node.reels.length && callback && typeof callback == \"function\") {\n            this.node.runAction(cc.sequence([\n                cc.delayTime(this.node.curentConfig.REEL_EASING_TIME*2),\n                cc.callFunc(()=>{\n                    callback();\n                })\n            ]));\n        }\n        \n        this.node.emit('REEL_STOP_NEARWIN',{matrix, count, context: this,});\n        this.node.emit('REEL_STOP_SOUND',{matrix, count, context: this,});\n        this.node.emit('REEL_STOP_EFFECT',{matrix, count, context: this,});\n        this.node.emit('REEL_STOP_MISC',{matrix, count, context: this,});\n    },\n    fastToResult() {\n        if (this.stopSpinningCallbackCount < this.node.reels.length) {\n            this.isFastToResult = true;\n            for (let col = 0; col < this.node.reels.length; ++col) {\n                this.node.reels[col].fastStopSpinning();\n            }\n        }\n    },\n});"]}