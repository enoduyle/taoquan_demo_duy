{"version":3,"sources":["../../../../../../../assets/cc-common/cc-slotbase-v2/portrailGame/History/assets/cc-common/cc-slotbase-v2/portrailGame/History/BetHistoryDetailPage.js"],"names":["require","isNumber","formatMoney","DescriptionFeature","convertPayLine","payLines","listNewPL","dataSplit","replace","split","i","length","data","symbolID","payLinePositions","payLineWinAmount","Number","symbolCount","push","cc","Class","extends","Component","properties","sessionLabel","Label","betAmountLabel","winAmountLabel","table","pageLabel","iconFeature","Sprite","featureSpriteFrames","SpriteFrame","activedFeatureSpriteFrames","progressBarFeature","Node","progressFeatureValue","betHistoryPaylines","featureGroup","spriteActivedFeature","descriptionActivedFeature","onLoad","node","updateData","bind","hideInfoDetailPage","opacity","string","active","summaryData","extendData","lastJP","latestWinJackpotInfo","currentPage","totalPages","lastedNumberWinFeatures","result","numberWinFeatures","usingFeature","emit","configFeature","sessionId","mode","totalBetAmount","jackpotAmount","winAmount","toString","wonSymbolTotal","totalWinSymbol","maxSymbol","forEach","numSymbols","parseInt","item","undefined","getComponent","getCurrentProgressText","width","height","spriteFrame","renderResult","applyFeature","scale","paylines","highlightPaylines"],"mappings":"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","file":"BetHistoryDetailPage.js","sourceRoot":"../../../../../../../assets/cc-common/cc-slotbase-v2/portrailGame/History","sourcesContent":["const { isNumber } = require(\"lodash\");\nconst { formatMoney } = require(\"utils\");\n\nconst DescriptionFeature = [\n    \"Huyền Vũ thực hiện kỹ năng Địa Liệt\",\n    \"Loại bỏ tất cả các biểu tượng phổ thông\",\n    \"Thanh Long thực hiện kỹ năng Chân Long Chúc Phúc\",\n    \"Tặng 4 Wild Thái Cực\",\n    \"Bạch Hổ thực hiện kỹ năng Nộ Phác\",\n    \"Đổi biểu tượng tại các vị trí được đánh dấu\",\n    \"Chu Tước thực hiện kỹ năng Hỏa Dực Phần Thiên\",\n    \"Chuyển đổi tất cả các biểu tượng phổ thông thành đặc biệt\",\n    \"Mở phong ấn Huyền Vũ\",\n    \"Mở phong ấn Thanh Long\",\n    \"Mở phong ấn Bạch Hổ\",\n    \"Mở phong ấn Chu Tước\",\n    \"Thắng Jackpot\",\n];\n\nconst convertPayLine = (payLines = []) => {\n    const listNewPL = [];\n    const dataSplit = payLines.replace(\"[\", \"\").replace(\"]\", \"\").split(' ');\n\n    for (let i = 0; i < dataSplit.length; i++) {\n        let data = dataSplit[i].split(';');\n        if (data.length < 4) break;\n\n        let symbolID = data[0];\n        let payLinePositions = data[1].split(',');\n        // payLinePositions: data[1].split(',').map(item => item.trim()),\n\n        let payLineWinAmount = Number(data[2]);\n        let symbolCount = Number(data[3].replace(',', \"\"));\n\n        listNewPL.push({\n            symbolID: symbolID,\n            payLinePositions: payLinePositions,\n            payLineWinAmount: payLineWinAmount,\n            symbolCount: symbolCount\n        });\n    }\n    return listNewPL;\n};\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        sessionLabel: cc.Label,\n        betAmountLabel: cc.Label,\n        winAmountLabel: cc.Label,\n\n        table: require(\"SlotTableHistory\"),\n\n        pageLabel: cc.Label,\n        iconFeature: cc.Sprite,\n        featureSpriteFrames: [cc.SpriteFrame],\n        activedFeatureSpriteFrames: [cc.SpriteFrame],\n        //progress bar\n        progressBarFeature: cc.Node,\n        progressFeatureValue: cc.Node,\n\n        betHistoryPaylines: cc.Node,\n\n        //feature group\n        featureGroup: cc.Node,\n        spriteActivedFeature: cc.Node,\n        descriptionActivedFeature: cc.Node,\n    },\n\n    onLoad() {\n        this.node.updateData = this.updateData.bind(this);\n        this.node.hideInfoDetailPage = this.hideInfoDetailPage.bind(this);\n    },\n\n    hideInfoDetailPage() {\n        this.table.node.opacity = 0;\n        this.featureGroup.opacity = 0;\n\n        this.sessionLabel.string = \"\";\n        this.betAmountLabel.string = \"\";\n        this.winAmountLabel.string = \"\";\n        this.pageLabel.string = \"\";\n\n        this.featureGroup.active = false;\n        this.betHistoryPaylines.active = false;\n    },\n\n    updateData(data, summaryData, extendData) {\n        const lastJP = data.latestWinJackpotInfo && data.latestWinJackpotInfo[0];\n        \n        let { currentPage, totalPages, lastedNumberWinFeatures } = extendData;\n        let { numberWinFeatures, usingFeature } = data.result;\n        this.progressBarFeature.emit('UPDATE_DATA_FEATURE', data.result.configFeature);\n        this.sessionLabel.string = summaryData.sessionId;\n        this.betAmountLabel.string = data.mode === \"free\" ? 0 : formatMoney(data.totalBetAmount);\n        this.winAmountLabel.string = lastJP ? formatMoney(lastJP.jackpotAmount + data.winAmount) : formatMoney(data.winAmount);\n\n        this.pageLabel.string = \"Lượt \" + (currentPage + 1).toString() + \"/\" + totalPages;\n        this.progressBarFeature.opacity = 255;\n        let wonSymbolTotal = data.result.totalWinSymbol;\n        let maxSymbol = 0;\n        data.result.configFeature.forEach(item =>{\n            const numSymbols = parseInt(item.split(';')[1]);\n            if (numSymbols > maxSymbol) maxSymbol = numSymbols;\n        });\n        wonSymbolTotal = wonSymbolTotal >= maxSymbol ? maxSymbol : wonSymbolTotal;\n        if (wonSymbolTotal != undefined && isNumber(wonSymbolTotal)) {\n            this.progressBarFeature.emit(\"UPDATE_STATIC_PROGRESS_BAR\", {wonSymbolTotal});\n            this.progressFeatureValue.getComponent(cc.Label).string = this.progressBarFeature.getCurrentProgressText(wonSymbolTotal);\n        }\n\n\n        if (numberWinFeatures) {\n            if (numberWinFeatures == 4) {\n                this.iconFeature.node.width = 130;\n                this.iconFeature.node.height = 130;\n            } else {\n                this.iconFeature.node.width = 80;\n                this.iconFeature.node.height = 80;\n            }\n            this.iconFeature.spriteFrame = this.featureSpriteFrames[numberWinFeatures];\n        } else {\n            this.iconFeature.node.width = 80;\n            this.iconFeature.node.height = 80;\n            this.iconFeature.spriteFrame = this.featureSpriteFrames[0];\n        }\n        \n        this.table.renderResult(data);\n        // must renderResult matrix first\n        if (usingFeature && usingFeature > 0) {\n            this.featureGroup.active = true;\n            this.betHistoryPaylines.active = false;\n            this.table.applyFeature(usingFeature);\n\n            if (usingFeature == 4) this.spriteActivedFeature.scale = 0.45;\n            else this.spriteActivedFeature.scale = 0.5;\n\n            this.spriteActivedFeature.getComponent(cc.Sprite).spriteFrame = this.activedFeatureSpriteFrames[usingFeature -1];\n            this.descriptionActivedFeature.getComponent(cc.Label).string = DescriptionFeature[(usingFeature - 1) * 2] + \"\\n\" + DescriptionFeature[(usingFeature - 1) * 2 + 1];\n\n        } else {\n            this.featureGroup.active = false;\n            this.betHistoryPaylines.active = true;\n            \n            let paylines = convertPayLine(data.paylines);\n            if (paylines && paylines.length > 0) this.table.highlightPaylines(paylines);\n            else this.table.highlightPaylines([]);\n            if (lastJP) paylines.push({symbolID : \"JP\", payLineWinAmount : lastJP.jackpotAmount});\n            this.betHistoryPaylines.emit(\"UPDATE_DATA\", paylines, { numberWinFeatures, lastedNumberWinFeatures });\n        }\n        this.iconFeature.node.active = (data.result.totalWinSymbol <= maxSymbol || lastJP != null);\n        // show\n        this.table.opacity = 255;\n        this.featureGroup.opacity = 255;\n    },\n});\n"]}