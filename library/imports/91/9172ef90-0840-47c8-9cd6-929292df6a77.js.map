{"version":3,"sources":["../../../../../../../../assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect/assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect/WinEffectCutscene.js"],"names":["cc","Class","extends","Component","properties","megaWinRate","superWinRate","onLoad","milisecondRate","isSuperWinShow","isBigWinShow","isMegaWinShow","duration","node","opacity","active","gSlotWinEffect","winAmount","getChildByName","soundPlayer","on","show","data","callback","_children","emit","isShow","value","currentBetData","init","spriteData","calbackWin","enterFrame","per","finalWin","runMegaWin","runSuperWin","runFinishBigWin","runFinishWin","setTimeout","quickShow","showWinAnimation","timeOutSoundLoop","runAction","sequence","delayTime","callFunc","onUpdateWinValue","clearTimeout","start","Number","string","range","animationDuration","stopAllActions","setWinEff","off","hideFn","gSlotDataStore","currentGameMode","resetValue"],"mappings":"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","file":"WinEffectCutscene.js","sourceRoot":"../../../../../../../../assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        megaWinRate: 30,\n        superWinRate: 50,\n    },\n    onLoad() {\n        this.milisecondRate = 1000;\n        this.isSuperWinShow = false;\n        this.isBigWinShow = false;\n        this.isMegaWinShow = false;\n        this.duration = 9000;\n        this.node.opacity = 0;\n        this.node.active = false;\n        this.gSlotWinEffect = this.node.gSlotWinEffect;\n        this.winAmount = this.node.getChildByName(\"WinAmount\");\n        this.soundPlayer = (this.node.soundPlayer) ? this.node.soundPlayer : this.node;\n        this.node.on(\"PLAY\",this.show,this);\n    },\n\n    show(data, callback) {\n        if(this.node == null || this.node == 'undefined'|| this.node._children == null|| this.node._children == 'undefined'){\n            return;\n        }\n        this.soundPlayer.node.emit(\"STOP_ALL_AUDIO\");\n        this.isShow = true;\n        this.callback = callback;\n        this.value = data.winAmount;\n        this.currentBetData = data.currentBetData;\n        this.node.active = true;\n        this.node.opacity = 255;\n\n        const gSlotWinEffect = this.node.gSlotWinEffect;\n        gSlotWinEffect.init(0, this.spriteData);\n\n        this.calbackWin = {\n            currentBetData: this.currentBetData,\n            enterFrame: (per, finalWin) => {\n                this.enterFrame(gSlotWinEffect, per, finalWin);\n            },\n            runMegaWin: () => {\n                this.runMegaWin(gSlotWinEffect);\n            },\n            runSuperWin: () => {\n                this.runSuperWin(gSlotWinEffect);\n            },\n            runFinishBigWin: () => {\n                this.runFinishBigWin();\n            },\n            runFinishWin: () => {\n                this.runFinishWin(gSlotWinEffect);\n            }\n        };\n\n        setTimeout(() => {\n            if (this.isShow) {\n                this.node.on('click', () => {\n                    this.quickShow(gSlotWinEffect);\n                });\n            }\n        }, 500);\n\n        this.showWinAnimation();\n    },\n\n    showWinAnimation() {\n        if(this.node == null || this.node == 'undefined'|| this.node._children == null|| this.node._children == 'undefined'){\n            return;\n        }\n        this.soundPlayer.node.emit(\"PLAY_WIN_START\");\n        this.timeOutSoundLoop = setTimeout(() => {\n            this.soundPlayer.node.emit(\"PLAY_WIN_LOOP\");\n        }, 1000);\n\n        this.node.runAction(cc.sequence(\n            cc.delayTime(.2),\n            cc.callFunc(() => {\n                this.winAmount.onUpdateWinValue(this.value, this.duration, this.calbackWin, false, 1000, 50, this.superWinRate, this.megaWinRate);\n            }),\n        ));\n    },\n\n    quickShow(gSlotWinEffect) {\n        if(this.node == null || this.node == 'undefined'|| this.node._children == null|| this.node._children == 'undefined'){\n            return;\n        }\n        if (!this.isShow) {\n            return;\n        }\n        if (this.timeOutSoundLoop) {\n            clearTimeout(this.timeOutSoundLoop);\n        }\n        this.isShow = false;\n        this.calbackWin = {\n            enterFrame: (per, finalWin) => {\n                this.enterFrame(gSlotWinEffect, per, finalWin);\n            },\n            runFinishWin: () => {\n                this.runFinishWin(gSlotWinEffect);\n            }\n        };\n        const start = Number(this.winAmount.string);\n        const range = this.value - start;\n        let animationDuration = 1000;\n        this.node.stopAllActions();\n        this.node.runAction(cc.sequence(\n            cc.callFunc(() => {\n                if (range / this.currentBetData * this.milisecondRate < animationDuration) {\n                    animationDuration = range;\n                }\n                this.soundPlayer.node.emit(\"STOP_WIN_LOOP\");\n                this.soundPlayer.node.emit(\"PLAY_WIN_END\");\n                this.winAmount.onUpdateWinValue(this.value, animationDuration, this.calbackWin, true);\n            }),\n            cc.callFunc(() => {\n                if (this.value >= this.currentBetData * this.superWinRate) {\n                    this.runSuperWin(gSlotWinEffect);\n                } else if (this.value >= this.currentBetData * this.megaWinRate) {\n                    this.runMegaWin(gSlotWinEffect);\n                } else {\n                    this.runFinishBigWin();\n                }\n            }),\n        ));\n    },\n\n\n\n    enterFrame(gSlotWinEffect, per, finalWin) {\n        gSlotWinEffect.enterFrame(per, finalWin);\n    },\n\n    runMegaWin(gSlotWinEffect) {\n        if(this.node == null || this.node == 'undefined'|| this.node._children == null|| this.node._children == 'undefined'){\n            return;\n        }\n        if (this.isMegaWinShow) {\n            return;\n        }\n        this.isMegaWinShow = true;\n        gSlotWinEffect.setWinEff(1);\n    },\n\n    runSuperWin(gSlotWinEffect) {\n        if(this.node == null || this.node == 'undefined'|| this.node._children == null|| this.node._children == 'undefined'){\n            return;\n        }\n        if (this.isSuperWinShow) {\n            return;\n        }\n        this.isSuperWinShow = true;\n        gSlotWinEffect.setWinEff(2);\n    },\n\n    runFinishBigWin() {\n        if(this.node == null || this.node == 'undefined'|| this.node._children == null|| this.node._children == 'undefined'){\n            return;\n        }\n        if (this.isBigWinShow) {\n            return;\n        }\n        this.isBigWinShow = true;\n    },\n\n    runFinishWin(gSlotWinEffect) {\n        if(this.node == null || this.node == 'undefined'|| this.node._children == null|| this.node._children == 'undefined'){\n            return;\n        }\n        if (this.isShow) {\n            this.soundPlayer.node.emit(\"STOP_WIN_LOOP\");\n            this.soundPlayer.node.emit(\"PLAY_WIN_END\");\n        }\n        this.isSuperWinShow = false;\n        this.isMegaWinShow = false;\n        this.isBigWinShow = false;\n        this.node.off('click');\n        gSlotWinEffect.hideFn(() => {\n            if (this.node.gSlotDataStore) this.soundPlayer.node.emit(\"PLAY_SOUND_BACKGROUND\",this.node.gSlotDataStore.currentGameMode);\n            this.winAmount.resetValue();\n            if (this.callback && typeof this.callback == \"function\") {\n                this.callback();\n            }\n        });\n    },\n});\n"]}