{"version":3,"sources":["../../../../../../../../assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect/assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect/WinEffectEmpty.js"],"names":["cc","Class","extends","require","properties","winAmount","Node","coinEffect","blockInputs","bigWinDuration","megaWinDuration","superWinDuration","onLoad","_super","delayTimeToSkip","duration","timeHide","delaySkip","enter","resetValue","toggleBlockInputs","isX100","content","currentBetData","currentSlotDirector","node","mainDirector","currentGameMode","director","buttons","emit","isForceSkip","showEffectWin","isOn","forEach","item","active","skippable","isSpeedUp","isFTR","gSlotDataStore","gameSpeed","config","GAME_SPEED","INSTANTLY","overlayNode","_showFastBigWin","value","time","playSoundStart","_actionBindQuickShow","sequence","callFunc","delayTime","finish","runAction","isAutoSpin","isFinished","playSession","callback","exit","playSoundEnd","onClick","log","stopAllActions","soundPlayer","stopAllAudio","playMainBGM","fadeOut","skip","isTutorialShowing","onIngameEvent","name"],"mappings":"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","file":"WinEffectEmpty.js","sourceRoot":"../../../../../../../../assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect","sourcesContent":["cc.Class({\n    extends: require('CutsceneMode'),\n\n    properties: {\n        winAmount: cc.Node,\n        coinEffect: cc.Node,\n        blockInputs: [cc.Node],\n        bigWinDuration: 20,\n        megaWinDuration: 36,\n        superWinDuration: 72\n    },\n\n    onLoad() {\n        this._super();\n        this.delayTimeToSkip = 2;\n        this.duration = 10;\n        this.timeHide = 1;\n        this.delaySkip = 0.5;\n    },\n\n    enter() {\n        this.resetValue();\n        this.toggleBlockInputs(true);\n        this.isX100 = (this.content.winAmount / this.content.currentBetData) >= 100;\n        const currentSlotDirector = this.node.mainDirector.currentGameMode.director;\n        if (currentSlotDirector && currentSlotDirector.buttons) {\n            currentSlotDirector.buttons.emit('ENABLE_SPIN_KEY', false);\n        }\n        this.isForceSkip = false;\n        this.showEffectWin();\n    },\n\n    toggleBlockInputs(isOn = false) {\n        this.blockInputs.forEach(item => {\n            item.active = isOn;\n        });\n    },\n\n    resetValue() {\n        this.skippable = false;\n        this.isSpeedUp = false;\n    },\n\n    showEffectWin() {\n        const isFTR = this.node.gSlotDataStore.gameSpeed === this.node.config.GAME_SPEED.INSTANTLY;\n        if (this.overlayNode) { this.overlayNode.active = true; }\n        if (isFTR) {\n            this._showFastBigWin();\n        } else {\n            const { winAmount, currentBetData } = this.content;\n            this.duration = this.bigWinDuration;\n            if (winAmount / currentBetData >= 50) {\n                this.duration = this.megaWinDuration;\n            } else if (winAmount / currentBetData >= 100) {\n                this.duration = this.superWinDuration;\n            }\n            this.winAmount.emit(\"UPDATE_WIN_AMOUNT\", { value: winAmount, time: this.duration * 1000 });\n            this.coinEffect.emit(\"PLAY_COIN_EFFECT\");\n            this.playSoundStart();\n            // bind quick show\n            this._actionBindQuickShow = cc.sequence(\n                cc.callFunc(() => {\n                    this.skippable = true;\n                }),\n                cc.delayTime(this.duration),\n                cc.callFunc(() => {\n                    this.finish();\n                    this.skippable = false;\n                })\n            );\n            this.node.runAction(this._actionBindQuickShow);\n        }\n        const { isAutoSpin } = this.node.gSlotDataStore;\n        const { isFinished } = this.node.gSlotDataStore.playSession;\n        if (!isAutoSpin && isFinished) {\n            this.callback && this.callback();\n            this.callback = null;\n        }\n    },\n    _showFastBigWin() {\n        const { winAmount } = this.content;\n        this.duration = 0.02;\n        this.winAmount.emit(\"PLAY_COIN_PARTICLE\");\n        this.winAmount.emit(\"UPDATE_WIN_AMOUNT\", { value: winAmount, time: this.duration * 1000 });\n        this.exit();\n    },\n\n    playSoundStart() { },\n\n    playSoundEnd() { },\n\n    onClick() {\n        if (!this.skippable) return;\n        if (this.isSpeedUp) return;\n        this.skippable = false;\n        cc.log(\"SKIP BIG WIN\");\n        this.isSpeedUp = true;\n        const { winAmount } = this.content;\n        this.winAmount.emit(\"FAST_UPDATE_WIN_AMOUNT\", { value: winAmount, time: 0 });\n        this.finish();\n    },\n    finish() {\n        this.coinEffect.emit(\"STOP_COIN_EFFECT\");\n        this.playSoundEnd();\n        this.toggleBlockInputs();\n        this.node.stopAllActions();\n        if (this.isForceSkip) {\n            if (this.node.soundPlayer) {\n                this.node.soundPlayer.stopAllAudio();\n                this.node.soundPlayer.playMainBGM();\n            }\n            this.exit();\n        } else {\n            this.node.runAction(cc.sequence(\n                cc.fadeOut(this.timeHide),\n                cc.callFunc(() => {\n                    if (this.node.soundPlayer) {\n                        this.node.soundPlayer.stopAllAudio();\n                        this.node.soundPlayer.playMainBGM();\n                    }\n                    this.exit();\n                })\n            ));\n        }\n    },\n\n    skip() {\n        this.isForceSkip = true;\n        this.onClick();\n    },\n\n    exit() {\n        this.callback && this.callback();\n        this.callback = null;\n        const currentSlotDirector = this.node.mainDirector.currentGameMode.director;\n        if (currentSlotDirector && currentSlotDirector.buttons && !this.node.mainDirector.isTutorialShowing()) {\n            currentSlotDirector.buttons.emit('ENABLE_SPIN_KEY', true);\n        }\n\n        if (this.node.mainDirector) {\n            this.node.mainDirector.onIngameEvent(\"ON_FINISH_BIG_WIN\", this.node.name);\n        }\n        this.node.active = false;\n        this.isForceSkip = false;\n    },\n});"]}