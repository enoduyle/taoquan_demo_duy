{"version":3,"sources":["SoundPlayer.js"],"names":["cc","Class","extends","Component","properties","sfxClick","default","type","AudioClip","bgmMain","storageKeyBGM","storageKeySFX","onLoad","setDefaultVolume","isEnableBGM","isEnableSFX","node","on","playSound","stopSound","playSFXClick","playSFX","emit","soundPlayer","isWebSoundClient2","sys","isNative","closeCreatorGame","readBGMKey","readSFXKey","onExtendedLoad","localStorage","getItem","result","JSON","parse","config","MUSIC_VOLUME","SOUND_EFFECT_VOLUME","audioEngine","setEffectsVolume","setMusicVolume","start","sfxToggle","gSlotDataStore","setItem","stopAllEffects","bgmToggle","playMainBGM","pauseMusic","playMusic","audio","loop","volume","isMusicPlaying","currentBGM","playEffect","sfx","sound","play","soundkey","stop","stopAllAudio","stopAll"],"mappings":"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","file":"SoundPlayer.js","sourceRoot":"../../../../../../assets/cc-common/cc-share-v1/common","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        sfxClick: {\n            default: null,\n            type: cc.AudioClip,\n        },\n        bgmMain: {\n            default: null,\n            type: cc.AudioClip,\n        },\n        storageKeyBGM: \"enableBackgroundMusic\",\n        storageKeySFX: \"enableSound\"\n    },\n\n    onLoad () {\n        this.setDefaultVolume();\n        this.isEnableBGM = false;\n        this.isEnableSFX = false;\n        this.node.on(\"PLAY_SOUND\",this.playSound,this);\n        this.node.on(\"STOP_SOUND\",this.stopSound,this);\n        this.node.on(\"PLAY_CLICK\",this.playSFXClick,this);\n        this.node.on(\"PLAY_SFX\",this.playSFX,this);\n        this.emit = this.node.emit;\n        this.node.soundPlayer = this;\n        this.isWebSoundClient2 = cc.sys.isNative && typeof(closeCreatorGame) === 'function';\n        this.storageKeyBGM = this.isWebSoundClient2 ? \"user_bg_music\": this.storageKeyBGM;\n        this.storageKeySFX = this.isWebSoundClient2 ? \"user_fx_sound\": this.storageKeySFX;\n        this.isEnableBGM = this.readBGMKey();\n        this.isEnableSFX = this.readSFXKey();\n        this.onExtendedLoad();\n    },\n\n    readBGMKey() {\n        const isEnableBGM = cc.sys.localStorage.getItem(this.storageKeyBGM);\n        const result = (isEnableBGM != null) ? JSON.parse(isEnableBGM) : true;\n        return result;\n    },\n\n    readSFXKey() {\n        const isEnableSFX = cc.sys.localStorage.getItem(this.storageKeySFX);\n        const result = (isEnableSFX != null) ? JSON.parse(isEnableSFX) : true;\n        return result;\n    },\n    \n    setDefaultVolume() {\n        const {MUSIC_VOLUME, SOUND_EFFECT_VOLUME} = this.node.config || {};\n        this.MUSIC_VOLUME = MUSIC_VOLUME || 0.5;\n        this.SOUND_EFFECT_VOLUME = SOUND_EFFECT_VOLUME || 1;\n        cc.audioEngine.setEffectsVolume(this.SOUND_EFFECT_VOLUME);\n        cc.audioEngine.setMusicVolume(this.MUSIC_VOLUME);\n    },\n    onExtendedLoad(){\n        \n    },\n    start() {\n        \n    },\n    sfxToggle() {\n        this.isEnableSFX = !this.isEnableSFX;\n        if (this.node.gSlotDataStore) this.node.gSlotDataStore.isEnableSFX = this.isEnableSFX;\n\n        if (this.isWebSoundClient2) {\n            cc.sys.localStorage.setItem(this.storageKeySFX, this.isEnableSFX ? \"1\" : \"0\");\n        } else {\n            cc.sys.localStorage.setItem(this.storageKeySFX, this.isEnableSFX);\n        }\n        \n        if (!this.isEnableSFX) {\n            cc.audioEngine.stopAllEffects();\n        }\n    },\n    bgmToggle() {\n        this.isEnableBGM = !this.isEnableBGM;\n        if (this.node.gSlotDataStore) this.node.gSlotDataStore.isEnableBGM = this.isEnableBGM;\n\n        if (this.isWebSoundClient2) {\n            cc.sys.localStorage.setItem(this.storageKeyBGM, this.isEnableBGM ? \"1\" : \"0\");\n        } else {\n            cc.sys.localStorage.setItem(this.storageKeyBGM, this.isEnableBGM);\n        }\n\n        if (this.isEnableBGM) {\n            this.playMainBGM();\n        } else {\n            cc.audioEngine.pauseMusic();\n        }\n    },\n    playMusic(audio, loop = true, volume = this.MUSIC_VOLUME) {\n        if (!this.isEnableBGM) return;\n        if (cc.audioEngine.isMusicPlaying() && this.currentBGM === audio) {\n            return; // return if this bgm audio is playing\n        }\n        cc.audioEngine.playMusic(audio, loop);\n        cc.audioEngine.setMusicVolume(volume);\n        this.currentBGM = audio;\n    },\n    playSFXClick() {\n        if (!this.isEnableSFX) return;\n        cc.audioEngine.playEffect(this.sfxClick);\n    },\n    playSFX(sfx) {\n        if (!this.isEnableSFX) return;\n        return cc.audioEngine.playEffect(sfx);\n    },\n    playMainBGM() {\n        if (!this.isEnableBGM) return;\n        this.playMusic(this.bgmMain, true);\n    },\n    playSound(sound, loop = false, volume = this.SOUND_EFFECT_VOLUME) {\n        if (!this.isEnableSFX) return;\n        return cc.audioEngine.play(sound, loop, volume);\n    },\n    stopSound(soundkey) {\n        cc.audioEngine.stop(soundkey);\n    },\n    stopAllAudio() {\n        cc.audioEngine.stopAll();\n    },\n});\n"]}