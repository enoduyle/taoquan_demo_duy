{"version":3,"sources":["../../../../../../../assets/cc-common/cc-slot-base-test/Streaming/scripts/assets/cc-common/cc-slot-base-test/Streaming/scripts/Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../../assets/cc-common/cc-slot-base-test/Streaming/scripts","sourcesContent":["cc.macro.ENABLE_TRANSPARENT_CANVAS = true;\n\nconst wsURL = \"wss://my-test-streaming-hgq4ku4h.livekit.cloud\"\n\nimport {Room, RoomEvent, VideoQuality } from 'livekit-client';\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class Player extends cc.Component {\n\n    @property(cc.Label)\n    roomName = null;\n\n    @property(cc.Label)\n    roomStatus = null;\n\n    @property(cc.EditBox)\n    token = null;\n\n    _room = null;\n\n    public onLoad(): void {\n        this._room = new Room();\n        this._room.on(RoomEvent.Connected, this.onRoomConnected.bind(this));\n        this._room.on(RoomEvent.Disconnected, this.onRoomDisconnected.bind(this));\n        this._room.on(RoomEvent.Reconnected, this.onRoomStatusChange.bind(this));\n        this._room.on(RoomEvent.Reconnecting, this.onRoomStatusChange.bind(this));\n        const {getUrlParam} = require('gameCommonUtils');\n        const stoken = getUrlParam('stoken');\n        if (stoken) {\n            this.joinRoomWithToken(wsURL, stoken);\n        }\n    }\n\n    onRoomConnected() {\n        this.roomName.string = `Room: ${this._room.name}`;\n        this.onRoomStatusChange();\n    }\n\n    onRoomDisconnected() {\n        this.roomName.string = `Room: n/a`;\n        this.onRoomStatusChange();\n    }\n\n    onRoomStatusChange(displayStatus = null) {\n        this.roomStatus.string = `Status: ${displayStatus ? displayStatus : this._room.state}`;\n    }\n\n    onClickJoinRoom() {\n        this.joinRoomWithToken(wsURL, this.token.string)\n        .then(() => {\n            this.subscribeDealer();\n            this.listenRoomEvents();\n        })\n        .catch((e)=>{\n            this.onRoomStatusChange('failed');\n            console.log('Error while connecting to room, please recheck token' + e);\n        })\n    }\n\n    joinRoomWithToken(socket, token) {\n        console.log('joinRoom, waiting for connect...');  \n        this.onRoomStatusChange('connecting');      \n        return this._room.connect(socket, token, {\n            autoSubscribe: false,\n        });\n    }\n\n    subscribeDealer() {\n        console.log('subscribeDealer');\n        this._room.participants.forEach((participant) => {\n            participant.tracks.forEach((publication) => {\n              publication.setSubscribed(true);\n            })\n        })\n    }\n\n    listenRoomEvents() {\n        this._room.on(RoomEvent.TrackSubscribed, this.handleTrackSubscribed)\n        this._room.on(RoomEvent.TrackUnsubscribed, this.handleTrackUnsubscribed);\n        this._room.on(RoomEvent.TrackPublished, this.handleTrackPublished);\n        this._room.on(RoomEvent.TrackUnpublished, this.handleTrackUnpublished);\n        this._room.on(RoomEvent.TrackMuted, this.handleTrackMuted);\n    }\n\n    handleTrackMuted(track, publication, participant) {\n        //Event raised when MC stop broadcast media/streaming\n        console.log('Handle track muted/stop broadcast from MC');\n    }\n\n    handleTrackUnpublished(track, publication, participant) {\n        //Event raised when client stop subscribe MC, if it's not called from client, maybe MC left room\n    }\n\n    handleTrackPublished(track, publication, participant) {\n        publication.setVideoQuality(VideoQuality.MEDIUM);\n        if (track.kind === 'video') {\n            const container = CC_DEV ? document.getElementById('GameDiv') : document.body;\n            const videoElement = track.attach();\n            container.insertBefore(videoElement, container.firstChild);\n            videoElement.style = `position: absolute; bottom: 0px; left: 0px; visibility: visible; width: 100%; height: 100%;`\n        }\n        else if (track.kind === 'audio') {\n            const container = document.getElementById('Cocos2dGameContainer');\n            const audioElement = track.attach();\n            container.appendChild(audioElement);\n        }\n    }\n\n    handleTrackUnsubscribed(track, publication, participant) {\n        //Event raised when client stop subscribe MC, if it's not called from client, maybe MC left room\n    }\n\n    handleTrackSubscribed(track, publication, participant) {\n        publication.setVideoQuality(VideoQuality.MEDIUM);\n\n        if (track.kind === 'video') {\n            const container = CC_DEV ? document.getElementById('GameDiv') : document.body;\n            const videoElement = track.attach();\n            container.insertBefore(videoElement, container.firstChild);\n            videoElement.style = `position: absolute; bottom: 0px; left: 0px; visibility: visible; width: 100%; height: 100%;`\n        }\n        else if (track.kind === 'audio') {\n            const container = document.getElementById('Cocos2dGameContainer');\n            const audioElement = track.attach();\n            container.appendChild(audioElement);\n        }\n\n    }\n}\n"]}