{"version":3,"sources":["../../../../../../assets/cc-common/cc-slot-base-test/ShockWaveFilter/assets/cc-common/cc-slot-base-test/ShockWaveFilter/ShockWaveFilter.js"],"names":["dat","require","cc","Class","extends","Component","properties","mainCamera","Camera","inputCamera","outputCamera","sprite","Sprite","onLoad","node","width","height","_center","Object","freeze","v2","uniforms","filterArea","v4","filterClamp","center","amplitude","wavelength","brightness","speed","radius","time","director","on","play","stop","scaleY","sys","isBrowser","update","dt","material","isPlaying","setProperty","onDestroy","off","export","console","error","_createTexture","active","targetTexture","renderTexture","RenderTexture","initWithSize","gfx","RB_FMT_D24S8","spriteFrame","SpriteFrame","setTexture","Rect","getMaterial","_setUniforms","_tweenCenter","key","start","_initTestGui","gui","GUI","name","domElement","parentElement","style","zIndex","folder","_folder","addFolder","open","add","data","__controllers","forEach","control","initValue","property","object","JSON","stringify","exportDataFile","config","dataStr","fileName","type","split","pop","dataUri","encodeURIComponent","linkElement","document","createElement","setAttribute","click"],"mappings":"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","file":"ShockWaveFilter.js","sourceRoot":"../../../../../../assets/cc-common/cc-slot-base-test/ShockWaveFilter","sourcesContent":["const dat = require('dat.gui');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        mainCamera: cc.Camera,\n        inputCamera: cc.Camera,\n        outputCamera: cc.Camera,\n        sprite: cc.Sprite,\n    },\n\n    onLoad() {\n        const { width, height } = this.sprite.node;\n        this._center = Object.freeze(cc.v2(0, 0));\n        this.uniforms = {\n            filterArea: cc.v4(width, height, 0, 0),\n            filterClamp : cc.v4(0.0, 0.0, 1.0, 1.0),\n            center: cc.v2(width / 2, height / 2),\n            amplitude : 3,\n            wavelength : 900,\n            brightness : 1.12,\n            speed : 1800,\n            radius : -1,\n            time : 0,\n        }\n        cc.director.on(\"PLAY_SHADER\", this.play, this);\n        cc.director.on(\"STOP_SHADER\", this.stop, this);\n        this.sprite.node.scaleY = cc.sys.isBrowser ? -1 : 1;\n    },\n    update(dt) {\n        if (!this.material) return;\n        if (!this.isPlaying) return;\n        this.uniforms.time += dt;\n        this.material.setProperty('time', this.uniforms.time);\n    },\n    onDestroy(){\n        cc.director.off(\"PLAY_SHADER\", this.play, this);\n        cc.director.off(\"STOP_SHADER\", this.stop, this);\n    },\n    export() {\n        console.error(this.uniforms);\n    },\n    play() {\n        this._createTexture();\n        this.inputCamera.node.active = true;\n        this.inputCamera.targetTexture = this.renderTexture;\n\n        this.mainCamera.node.active = false;        \n        this.mainCamera.node.active = false;        \n\n        this.outputCamera.node.active = true;\n        this.sprite.node.active = true;\n        this.isPlaying = true;\n    },\n    _createTexture() {\n        const { width, height } = this.sprite.node;\n        this.renderTexture = new cc.RenderTexture();\n        this.renderTexture.initWithSize(width, height, cc.gfx.RB_FMT_D24S8 );\n\n        const spriteFrame = new cc.SpriteFrame();\n        spriteFrame.setTexture(this.renderTexture, new cc.Rect(0, 0, width, height ));\n        this.sprite.spriteFrame = spriteFrame;\n        this.material = this.sprite.getMaterial(0);\n        this.uniforms.time = 0;\n        this._setUniforms();\n    },\n    stop() {\n        this.mainCamera.node.active = true;\n        this.inputCamera.node.active = false;\n        this.outputCamera.node.active = false;\n        this.sprite.node.active = false;\n        this._tweenCenter && this._tweenCenter.stop();\n        this._tweenCenter = null;\n        this.isPlaying = false;\n    },\n    _setUniforms() {\n        for (let key in this.uniforms) {\n            this.material.setProperty(key, this.uniforms[key]);\n        }\n    },\n    // /* //!test\n    start() { \n        this._initTestGui();\n    }, \n    _initTestGui() {\n        const gui = new dat.GUI({ name: \"Filter\", width: 250 });\n        gui.domElement.parentElement.style.zIndex = 1000;\n        const folder = this._folder = gui.addFolder(\"Shockwave\");\n\n        folder.open();\n        folder.add(this, \"play\");\n        folder.add(this, \"stop\");\n        folder.add(this, \"export\");\n        folder.add(this.uniforms.center, \"x\", 0, 720, 1);\n        folder.add(this.uniforms.center, \"y\", 0, 1280, 1);\n        folder.add(this.uniforms, \"time\", 0, 2.5, 0.1);\n        folder.add(this.uniforms, \"radius\", -100, 2000, 1);\n        folder.add(this.uniforms, \"wavelength\", 2, 1000);\n        folder.add(this.uniforms, \"amplitude\", 1, 50, 1);\n        folder.add(this.uniforms, \"brightness\", .2, 2, .01);\n        folder.add(this.uniforms, \"speed\", 0, 4000, 1);\n        folder.add(this, \"export\" );\n    },\n    \n    export() {\n        const data = {};\n        this._folder.__controllers.forEach(control => {\n            if (typeof control.initValue !== \"function\") {\n                const { property, object } = control;\n                data[property] = object[property];\n            }\n        });\n        console.error(JSON.stringify(data));\n        this.exportDataFile(JSON.stringify(data), config);\n    },\n    exportDataFile(dataStr, fileName) {\n        let type = fileName.split(\".\").pop();\n        const dataUri = `data:application/${type};charset=utf-8,${encodeURIComponent(dataStr)}`;\n        const linkElement = document.createElement('a');\n        linkElement.setAttribute('href', dataUri);\n        linkElement.setAttribute('download', fileName);\n        linkElement.click();\n    }\n    // */\n});\n"]}