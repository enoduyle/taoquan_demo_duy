{"version":3,"sources":["CoinsEffectv2.js"],"names":["cc","Class","extends","require","properties","coinSpawnerCount","coinDropper","Node","diamondDropper","moneySpawner","moneyPrefab","Prefab","coinPiles","diamondPiles","coinPipeDelayTime","onLoad","initValue","node","on","startParticle","stopParticle","randomDropMoney","dropDiamond","duration","moneyPool","i","money","instantiate","parent","opacity","push","stopAllActions","getComponent","ParticleSystem","resetSystem","runAction","sequence","delayTime","fadeIn","forEach","pile","setPosition","view","getVisibleSize","height","callFunc","moveBy","stopSystem","moneyIndex","repeatForever","dropMoney","length","x","Math","random","width","randomAnimIdx","animName","sp","Skeleton","setAnimation"],"mappings":"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","file":"CoinsEffectv2.js","sourceRoot":"../../../../../../../../assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect","sourcesContent":["\n\ncc.Class({\n    extends: require('CutsceneMode'),\n\n    properties: {\n        coinSpawnerCount: 3,\n        coinDropper: cc.Node,\n        diamondDropper: cc.Node,\n        moneySpawner: cc.Node,\n        moneyPrefab: cc.Prefab,\n        coinPiles : [cc.Node],\n        diamondPiles: [cc.Node],\n        coinPipeDelayTime: 1.3,\n    },\n\n    onLoad() {\n        this.initValue();\n        this.node.on('START_PARTICLE', this.startParticle, this);\n        this.node.on('STOP_PARTICLE', this.stopParticle, this);\n        this.node.on('DROP_MONEY', this.randomDropMoney, this);\n        this.node.on('DROP_DIAMOND', this.dropDiamond, this);\n        this.duration = 10;\n    },  \n\n    initValue(){\n        if(!this.moneyPrefab){\n            return;\n        }\n\n        this.moneyPool = [];\n        for(let i = 0; i < 20; ++i) {\n            const money = cc.instantiate(this.moneyPrefab);\n            money.parent = this.moneySpawner;\n            money.opacity = 0;\n            this.moneyPool.push(money);\n        }\n        this.moneySpawner.opacity = 0;\n    },\n\n    startParticle(){\n        this.coinDropper.opacity = 0;\n        this.coinDropper.stopAllActions();\n        this.coinDropper.getComponent(cc.ParticleSystem).resetSystem();\n        this.coinDropper.runAction(cc.sequence(cc.delayTime(0.2), cc.fadeIn(0.1)));\n\n        this.coinPiles.forEach(pile => {\n            pile.opacity = 0;\n            pile.stopAllActions();\n            pile.setPosition(0, -cc.view.getVisibleSize().height / 2 - 20);\n            pile.runAction(cc.sequence( \n                cc.delayTime(this.coinPipeDelayTime),\n                cc.callFunc(()=>{\n                    pile.getComponent(cc.ParticleSystem).resetSystem();\n                }),\n                cc.delayTime(0.2),\n                cc.fadeIn(0.1),\n                cc.moveBy(this.duration, 0, 200)\n            ));\n        });\n    },\n\n    stopParticle(){\n        this.coinDropper.stopAllActions();\n        this.coinDropper.getComponent(cc.ParticleSystem).stopSystem();\n        this.coinPiles.forEach(pile => {\n            pile.stopAllActions();\n            pile.getComponent(cc.ParticleSystem).stopSystem();\n        });\n        this.moneySpawner.stopAllActions();\n        if(this.diamondDropper) {\n            this.diamondDropper.getComponent(cc.ParticleSystem).resetSystem();\n            this.diamondDropper.getComponent(cc.ParticleSystem).stopSystem();\n            this.diamondPiles.forEach(pile => {\n                pile.getComponent(cc.ParticleSystem).resetSystem();\n                pile.getComponent(cc.ParticleSystem).stopSystem();\n            });\n        }\n    },\n\n    randomDropMoney(){\n        if(!this.moneyPrefab){\n            return;\n        }\n        this.moneyIndex = 0;\n        this.moneySpawner.opacity = 255;\n        this.moneySpawner.runAction(cc.repeatForever(cc.sequence(\n            cc.delayTime(0.3),\n            cc.callFunc(()=>{ this.dropMoney(); })\n        )));\n    },\n\n    dropMoney(){\n        const money = this.moneyPool[this.moneyIndex];\n        this.moneyIndex = (this.moneyIndex + 1) % this.moneyPool.length;\n        money.x = (Math.random() - 0.5) * cc.view.getVisibleSize().width;\n        const randomAnimIdx = Math.random() * 3 | 0 + 1;\n        const animName = 'TienRoi' + randomAnimIdx;\n        money.opacity = 255;\n        money.getComponent(sp.Skeleton).setAnimation(0, animName, false);\n    },\n\n    dropDiamond() {\n        this.diamondDropper.opacity = 0;\n        this.diamondDropper.getComponent(cc.ParticleSystem).resetSystem();\n        this.diamondDropper.runAction(cc.sequence(cc.delayTime(0.2), cc.fadeIn(0.1)));\n    }\n});\n"]}