{"version":3,"sources":["MysteryChoice9983.js"],"names":["cc","Class","extends","Component","properties","display","Node","fgoSymbol","Prefab","delayStop","rollingSpeed","glow","onLoad","node","on","init","reset","roll","stop","symbolList","slice","defaultSprite","splice","height","i","symbol","instantiate","parent","isRolling","getRandomSymbol","length","Math","random","pass","opacity","scale","getComponent","Sprite","spriteFrame","children","y","setSiblingIndex","speedY","callback","runAction","sequence","moveBy","easing","easeCubicActionIn","callFunc","emit","scaleY","result","delayTime","gapY","abs","tween","to","start","soundPlayer","playSFXOptionPickEnd","circularSymbol","update","dt","updatePosition"],"mappings":"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","file":"MysteryChoice9983.js","sourceRoot":"../../../../../../assets/cc-taoquan-9983/scripts/cutScene","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        display: cc.Node,\n        fgoSymbol: cc.Prefab,\n        delayStop: 2,\n        rollingSpeed: 2000,\n        glow: cc.Node,\n    },\n\n    onLoad () {\n        this.node.on('INIT', this.init, this);\n        this.node.on('RESET', this.reset, this);\n        this.node.on('MYSTERY_CHOICE', this.roll, this);\n        this.node.on('STOP_ROLL', this.stop, this);\n    },\n\n    init(symbolList){\n        this.symbolList = symbolList.slice();\n        this.defaultSprite = this.symbolList[3];\n        this.symbolList.splice(3, 1);\n        this.height =  this.node.height;\n        for(let i = 0; i < 3; ++i) {\n            const symbol = cc.instantiate(this.fgoSymbol);\n            symbol.parent = this.display;\n        }\n        this.reset();\n        this.isRolling = false;\n    },\n\n    getRandomSymbol() {\n        return this.symbolList[this.symbolList.length * Math.random() | 0];\n    },\n\n    reset(){\n        this.pass = 1;\n        this.glow.opacity = 255;\n        this.glow.scale = 1;\n        this.glow.getComponent(cc.Sprite).spriteFrame = this.defaultSprite;\n        this.display.opacity = 0;\n        for(let i = 0; i < 3; ++i) {\n            const symbol = this.display.children[i];\n            symbol.getComponent(cc.Sprite).spriteFrame = this.getRandomSymbol();\n            symbol.y = i * this.height;\n            symbol.setSiblingIndex(i);\n        }\n        this.display.y = 0;\n        this.speedY = 0.0;\n        this.display.children[0].getComponent(cc.Sprite).spriteFrame = this.defaultSprite;\n    },\n\n    roll(callback){\n        this.glow.opacity = 0;\n        this.display.opacity = 255;\n        this.isRolling = true;\n        this.display.runAction(cc.sequence(\n            cc.moveBy(0.2, 0, 0.5 * this.height).easing(cc.easeCubicActionIn()),\n            cc.callFunc(()=>{\n                this.speedY = -this.rollingSpeed;\n                for(let i = 0; i < 3; ++i) {\n                    this.display.children[i].emit('ACTIVE_BLUR', 0.03);\n                    this.display.children[i].scaleY = 2;\n                }\n                callback && callback();\n            })\n        ));\n    },\n\n    stop(result, callback){\n        this.node.runAction(cc.sequence(\n            cc.delayTime(this.delayStop),\n            cc.callFunc(()=>{\n                this.isRolling = false;\n                this.speedY = 0;\n                for(let i = 0; i < 3; ++i) {\n                    this.display.children[i].emit('STOP_BLUR');\n                    this.display.children[i].scaleY = 1;\n                }\n                const symbol = this.display.children[2];\n                symbol.getComponent(cc.Sprite).spriteFrame = this.symbolList[result - 1];\n                const gapY = Math.abs(this.display.y) - this.height * (this.pass - 1);\n                this.display.runAction(cc.sequence(\n                    cc.moveBy(0.01, 0, -this.height * 2),\n                    cc.moveBy(0.3, 0, gapY),\n                    cc.callFunc(()=>{\n                        this.glow.getComponent(cc.Sprite).spriteFrame = this.symbolList[result - 1];\n                        this.glow.opacity = 200;\n                        this.glow.scale = 1;\n                        cc.tween(this.glow).to(0.5, {opacity: 0, scale: 2}).start();\n                        this.node.soundPlayer && this.node.soundPlayer.playSFXOptionPickEnd();\n                    }),\n                    cc.delayTime(2),\n                    cc.callFunc(()=>{\n                        callback && callback();\n                    })\n                ));\n            })\n        ));\n    },\n\n    circularSymbol(){\n        const symbol = this.display.children[0];\n        symbol.y += this.height * 3;\n        symbol.getComponent(cc.Sprite).spriteFrame = this.getRandomSymbol();\n        symbol.setSiblingIndex(2);\n    },\n\n    update(dt){\n        if(!this.isRolling) return;\n        this.updatePosition(dt);\n        while(this.display.y <= -this.height * this.pass) {\n            this.circularSymbol();\n            ++this.pass;\n        }\n    },\n\n    updatePosition(dt){\n        this.display.y += this.speedY * dt;\n    }\n});\n"]}