{"version":3,"sources":["DissolveControl.js"],"names":["cc","Class","extends","Component","properties","normalTransitionDuration","fastTransitionDuration","lerpOnStart","isLoop","propName","useLinear","useCubicEaseIn","useCubicEaseOut","customMaterial","type","Material","default","onLoad","_sprite","node","getComponent","Sprite","_mainMaterial","getMaterial","_transitionFactor","_isLerping","start","lerpTransition","_timer","transitionDuration","onEnable","setProperty","update","dt","cubicEasingIn","cubicEasingOut","emit","startFadeIn","isTurbo","startFadeOut","isLerping","setMaterial","time","beginVal","changeVal","duration"],"mappings":"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","file":"DissolveControl.js","sourceRoot":"../../../../../../../../assets/cc-common/cc-share-v1/shader/shader-metaGear/Utils","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        normalTransitionDuration: 1,\n        fastTransitionDuration: 0.3,\n        lerpOnStart: true,\n        isLoop: false,\n        propName: \"threshold\",\n        useLinear: false,\n        useCubicEaseIn: false,\n        useCubicEaseOut: false,\n        customMaterial: {\n            type: cc.Material,\n            default: null,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this._sprite = this.node.getComponent(cc.Sprite);\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._transitionFactor = 0;\n        this._isLerping = false;\n    },\n\n    start () {\n        if(this.lerpOnStart){\n            this.lerpTransition(true);\n        }\n        this._timer = 0;\n        this.transitionDuration = this.normalTransitionDuration;\n    },\n\n    onEnable(){\n        this._transitionFactor = 0;\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._mainMaterial.setProperty(this.propName, 1 - this._transitionFactor);\n    },\n\n    update (dt) {\n        if(this._isLerping){\n            if(this.useLinear){\n                this._transitionFactor+= dt*(1/this.transitionDuration);\n            }else if(this.useCubicEaseIn){\n                this._timer += dt;\n                this._transitionFactor = this.cubicEasingIn(this._timer, 0, 1, this.transitionDuration);\n            }else if(this.useCubicEaseOut){\n                this._timer += dt;\n                this._transitionFactor = this.cubicEasingOut(this._timer, 0, 1, this.transitionDuration);\n            }else{\n                this._isLerping = false;\n                return;\n            }\n            \n            if(this._transitionFactor>1){\n                if(this.isLoop){\n                    this._transitionFactor = 0;\n                }else{\n                    this._isLerping = false;\n                    this.node.emit(\"TRANSITION_COMPLETE\");\n                }\n                this._timer = 0;\n            }\n            this._mainMaterial = this._sprite.getMaterial(0);\n            this._mainMaterial.setProperty(this.propName,1 - this._transitionFactor);\n        }\n    },\n\n    startFadeIn(isTurbo = false){\n        this.transitionDuration = isTurbo? this.fastTransitionDuration : this.normalTransitionDuration;\n        this.lerpTransition(true);\n    },\n\n    startFadeOut(isTurbo = false){\n        this.transitionDuration = isTurbo? this.fastTransitionDuration : this.normalTransitionDuration;\n        this.lerpTransition(false);\n    },\n\n    lerpTransition(isLerping){\n        if(isLerping){\n            this._sprite.setMaterial(0, this.customMaterial);\n        }\n        this._isLerping = isLerping;\n        this._transitionFactor = 0;\n        this._timer = 0;\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._mainMaterial.setProperty(this.propName, 1 - this._transitionFactor);\n    },\n\n    cubicEasingIn(time, beginVal, changeVal, duration){\n        time /=duration;\n        return changeVal*time*time*time + beginVal;\n    },\n\n    cubicEasingOut(time, beginVal, changeVal, duration){\n        time /=duration;\n        time--;\n        return changeVal*(time*time*time+1) + beginVal;\n    },\n\n});"]}