{"version":3,"sources":["../../../../../../assets/cc-common/cc-share-v1/CustomEngine/assets/cc-common/cc-share-v1/CustomEngine/CustomHTMLTextParser.js"],"names":["eventRegx","imageAttrReg","CustomHtmlTextParser","_parsedObject","_specialSymbolArray","push","prototype","constructor","parse","htmlString","_resultObjectArray","_stack","startIndex","length","tagBeginIndex","indexOf","pop","_processResult","substring","tagEndIndex","charAt","_addToStack","_attributeToObject","attribute","trim","obj","header","match","tagName","nextSpace","eventObj","eventHanlderString","color","size","parseInt","_processEventHandler","event","startsWith","isNewLine","text","style","newline","tagValue","remainingArgument","isValidImageTag","substr","replace","toLocaleLowerCase","isImage","endsWith","src","imageHeight","imageWidth","scale","parseFloat","anchorY","param","defaultOutlineObject","width","outlineAttrReg","outline","underline","italic","bold","eventString","index","eventNames","isValidTag","eventName","eventValue","previousTagObj","key","value","_escapeSpecialSymbol","str","i","CC_TEST","cc","_Test","HtmlTextParser","module","exports"],"mappings":"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","file":"CustomHTMLTextParser.js","sourceRoot":"../../../../../../assets/cc-common/cc-share-v1/CustomEngine","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n var eventRegx = /^(click)(\\s)*=|(param)(\\s)*=/;\n\n //AD support more param\n var imageAttrReg = /(\\s)*src(\\s)*=|(\\s)*height(\\s)*=|(\\s)*width(\\s)*=|(\\s)*click(\\s)*=|(\\s)*param(\\s)*=|(\\s)*scale(\\s)*=|(\\s)*anchorY(\\s)*=/;\n /**\n  * A utils class for parsing HTML texts. The parsed results will be an object array.\n  */\n var CustomHtmlTextParser = function() {\n     this._parsedObject = {};\n     this._specialSymbolArray = [];\n     this._specialSymbolArray.push([/&lt;/g, '<']);\n     this._specialSymbolArray.push([/&gt;/g, '>']);\n     this._specialSymbolArray.push([/&amp;/g, '&']);\n     this._specialSymbolArray.push([/&quot;/g, '\"']);\n     this._specialSymbolArray.push([/&apos;/g, '\\'']);\n };\n \n CustomHtmlTextParser.prototype = {\n     constructor: CustomHtmlTextParser,\n     parse: function(htmlString) {\n         this._resultObjectArray = [];\n         this._stack = [];\n \n         var startIndex = 0;\n         var length = htmlString.length;\n         while (startIndex < length) {\n             var tagBeginIndex = htmlString.indexOf('<', startIndex);\n             if (tagBeginIndex < 0) {\n                 this._stack.pop();\n                 this._processResult(htmlString.substring(startIndex));\n                 startIndex = length;\n             } else {\n                 this._processResult(htmlString.substring(startIndex, tagBeginIndex));\n \n                 var tagEndIndex = htmlString.indexOf('>', startIndex);\n                 if (tagEndIndex === -1) {\n                     // cc.error('The HTML tag is invalid!');\n                     tagEndIndex = tagBeginIndex;\n                 } else if (htmlString.charAt(tagBeginIndex + 1) === '\\/'){\n                     this._stack.pop();\n                 } else {\n                     this._addToStack(htmlString.substring(tagBeginIndex + 1, tagEndIndex));\n                 }\n                 startIndex = tagEndIndex + 1;\n \n             }\n         }\n \n \n         return this._resultObjectArray;\n     },\n \n     _attributeToObject: function (attribute) {\n         attribute = attribute.trim();\n \n         var obj = {};\n         var header = attribute.match(/^(color|size)(\\s)*=/);\n         var tagName;\n         var nextSpace;\n         var eventObj;\n         var eventHanlderString;\n         if (header) {\n             tagName = header[0];\n             attribute = attribute.substring(tagName.length).trim();\n             if(attribute === \"\") return obj;\n \n             //parse color\n             nextSpace = attribute.indexOf(' ');\n             switch(tagName[0]){\n               case 'c':\n                   if (nextSpace > -1) {\n                       obj.color = attribute.substring(0, nextSpace).trim();\n                   } else {\n                       obj.color = attribute;\n                   }\n                   break;\n               case 's':\n                   obj.size = parseInt(attribute);\n                   break;\n             }\n \n             //tag has event arguments\n             if(nextSpace > -1) {\n                 eventHanlderString = attribute.substring(nextSpace+1).trim();\n                 eventObj = this._processEventHandler(eventHanlderString);\n                 obj.event = eventObj;\n             }\n             return obj;\n         }\n \n         header = attribute.match(/^(br(\\s)*\\/)/);\n         if(header && header[0].length > 0) {\n             tagName = header[0].trim();\n             if(tagName.startsWith(\"br\") && tagName[tagName.length-1] === \"/\") {\n                 obj.isNewLine = true;\n                 this._resultObjectArray.push({text: \"\", style: {newline: true}});\n                 return obj;\n             }\n         }\n \n         header = attribute.match(/^(img(\\s)*src(\\s)*=[^>]+\\/)/);\n         if(header && header[0].length > 0) {\n             tagName = header[0].trim();\n             if(tagName.startsWith(\"img\") && tagName[tagName.length-1] === \"/\") {\n                 header = attribute.match(imageAttrReg);\n                 var tagValue;\n                 var remainingArgument;\n                 var isValidImageTag = false;\n                 while (header) {\n                     //skip the invalid tags at first\n                     attribute = attribute.substring(attribute.indexOf(header[0]));\n                     tagName = attribute.substr(0, header[0].length);\n                     //remove space and = character\n                     remainingArgument = attribute.substring(tagName.length).trim();\n                     nextSpace = remainingArgument.indexOf(' ');\n \n                     tagValue = (nextSpace > -1) ? remainingArgument.substr(0, nextSpace) : remainingArgument;\n                     tagName = tagName.replace(/[^a-zA-Z]/g, \"\").trim();\n                     tagName = tagName.toLocaleLowerCase();\n \n                     attribute = remainingArgument.substring(nextSpace).trim();\n                     if (tagName === \"src\") {\n                         obj.isImage = true\n                         if( tagValue.endsWith( '\\/' ) ) tagValue = tagValue.substring( 0, tagValue.length - 1 );\n                         if( tagValue.indexOf('\\'')===0 ) {\n                             isValidImageTag = true;\n                             tagValue = tagValue.substring( 1, tagValue.length - 1 );\n                         } else if( tagValue.indexOf('\"')===0 ) {\n                             isValidImageTag = true;\n                             tagValue = tagValue.substring( 1, tagValue.length - 1 );\n                         }\n                         obj.src = tagValue;\n                     } else if (tagName === \"height\") {\n                         obj.imageHeight = parseInt(tagValue);\n                     } else if (tagName === \"width\") {\n                         obj.imageWidth = parseInt(tagValue);\n                     } else if (tagName === \"click\") {\n                         obj.event = this._processEventHandler(tagName + \"=\" + tagValue);\n                     } else if (tagName === \"scale\") { //AD support more param\n                        obj.scale = parseFloat(tagValue);\n                     } else if (tagName === \"anchorY\" || tagName === \"anchory\") {\n                        obj.anchorY = parseFloat(tagValue);\n                     }\n                     \n                     if (obj.event && tagName === 'param') {\n                         obj.event.param = tagValue.replace(/^\\\"|\\\"$/g, '');\n                     }\n \n                     header = attribute.match(imageAttrReg);\n                 }\n \n                 if( isValidImageTag && obj.isImage )\n                 {\n                     this._resultObjectArray.push({text: \"\", style: obj});\n                 }\n \n                 return {};\n             }\n         }\n \n         header = attribute.match(/^(outline(\\s)*[^>]*)/);\n         if (header) {\n             attribute = header[0].substring(\"outline\".length).trim();\n             var defaultOutlineObject = {color: \"#ffffff\", width: 1};\n             if (attribute) {\n                 var outlineAttrReg = /(\\s)*color(\\s)*=|(\\s)*width(\\s)*=|(\\s)*click(\\s)*=|(\\s)*param(\\s)*=/;\n                 header = attribute.match(outlineAttrReg);\n                 var tagValue;\n                 while (header) {\n                     //skip the invalid tags at first\n                     attribute = attribute.substring(attribute.indexOf(header[0]));\n                     tagName = attribute.substr(0, header[0].length);\n                     //remove space and = character\n                     remainingArgument = attribute.substring(tagName.length).trim();\n                     nextSpace = remainingArgument.indexOf(' ');\n                     if (nextSpace > -1) {\n                         tagValue = remainingArgument.substr(0, nextSpace);\n                     } else {\n                         tagValue = remainingArgument;\n                     }\n                     tagName = tagName.replace(/[^a-zA-Z]/g, \"\").trim();\n                     tagName = tagName.toLocaleLowerCase();\n \n                     attribute = remainingArgument.substring(nextSpace).trim();\n                     if (tagName === \"click\") {\n                         obj.event = this._processEventHandler(tagName + \"=\" + tagValue);\n                     } else if (tagName === \"color\") {\n                         defaultOutlineObject.color = tagValue;\n                     } else if (tagName === \"width\") {\n                         defaultOutlineObject.width = parseInt(tagValue);\n                     }\n \n                     if (obj.event && tagName === 'param') {\n                         obj.event.param = tagValue.replace(/^\\\"|\\\"$/g, '');\n                     }\n \n                     header = attribute.match(outlineAttrReg);\n                 }\n             }\n             obj.outline = defaultOutlineObject;\n         }\n \n         header = attribute.match(/^(on|u|b|i)(\\s)*/);\n         if(header && header[0].length > 0) {\n             tagName = header[0];\n             attribute = attribute.substring(tagName.length).trim();\n             switch(tagName[0]){\n               case 'u':\n                   obj.underline = true;\n                   break;\n               case 'i':\n                   obj.italic = true;\n                   break;\n               case 'b':\n                   obj.bold = true;\n                   break;\n             }\n             if(attribute === \"\") {\n                 return obj;\n             }\n             eventObj = this._processEventHandler(attribute);\n             obj.event = eventObj;\n         }\n \n         return obj;\n     },\n \n     _processEventHandler: function (eventString) {\n         var index = 0;\n         var obj = {};\n         var eventNames = eventString.match(eventRegx);\n         var isValidTag = false;\n         while(eventNames) {\n             var eventName = eventNames[0];\n             var eventValue = \"\";\n             isValidTag = false;\n             eventString = eventString.substring(eventName.length).trim();\n             if(eventString.charAt(0) === \"\\\"\") {\n                 index = eventString.indexOf(\"\\\"\", 1);\n                 if (index > -1) {\n                     eventValue = eventString.substring(1, index).trim();\n                     isValidTag = true;\n                 }\n                 index++;\n             } else if(eventString.charAt(0) === \"\\'\") {\n                 index = eventString.indexOf('\\'', 1);\n                 if(index > -1) {\n                     eventValue = eventString.substring(1, index).trim();\n                     isValidTag = true;\n                 }\n                 index++;\n             } else {\n                 //skip the invalid attribute value\n                 var match = eventString.match(/(\\S)+/);\n                 if(match) {\n                     eventValue = match[0];\n                 } else {\n                     eventValue = \"\";\n                 }\n                 index = eventValue.length;\n             }\n \n             if(isValidTag) {\n                 eventName = eventName.substring(0, eventName.length-1).trim();\n                 obj[eventName] = eventValue;\n             }\n \n             eventString = eventString.substring(index).trim();\n             eventNames = eventString.match(eventRegx);\n         }\n \n         return obj;\n     },\n \n     _addToStack: function(attribute) {\n         var obj = this._attributeToObject(attribute);\n \n         if (this._stack.length === 0){\n             this._stack.push(obj);\n         } else {\n             if(obj.isNewLine || obj.isImage) {\n                 return;\n             }\n             //for nested tags\n             var previousTagObj = this._stack[this._stack.length - 1];\n             for (var key in previousTagObj) {\n                 if (!(obj[key])) {\n                     obj[key] = previousTagObj[key];\n                 }\n             }\n             this._stack.push(obj);\n         }\n     },\n \n     _processResult: function(value) {\n         if (value === \"\") {\n             return;\n         }\n \n         value = this._escapeSpecialSymbol(value);\n         if (this._stack.length > 0) {\n             this._resultObjectArray.push({text: value, style: this._stack[this._stack.length - 1]});\n         } else {\n             this._resultObjectArray.push({text: value});\n         }\n     },\n \n     _escapeSpecialSymbol: function(str) {\n         for(var i = 0; i < this._specialSymbolArray.length; ++i) {\n             var key = this._specialSymbolArray[i][0];\n             var value = this._specialSymbolArray[i][1];\n \n             str = str.replace(key, value);\n         }\n         return str;\n     }\n };\n \n if (CC_TEST) {\n     cc._Test.HtmlTextParser = CustomHtmlTextParser;\n }\n \n module.exports = CustomHtmlTextParser;"]}