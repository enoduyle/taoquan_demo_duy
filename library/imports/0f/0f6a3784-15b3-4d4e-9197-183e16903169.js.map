{"version":3,"sources":["../../../../../../../assets/cc-common/cc-share-v1/common/baseComponent/assets/cc-common/cc-share-v1/common/baseComponent/BaseDirectorV2.js"],"names":["cc","Class","extends","Component","onLoad","node","director","lastCommand","onExtendedLoad","start","writer","forceToExitMode","exitScript","runAction","actionName","data","script","executeNextScript","length","isSkipAllScrips","nextScript","shift","command","getCommandName","log","name","error","gameSpeed","getGameSpeed","commandWithSpeed","destroyData","forceToExit","resetGameSpeed","gSlotDataStore","getDefaultGameSpeed","setGameSpeed","setGameSpeedMode","mode","GAME_SPEED","getGameSpeedConfig","NORMAL","modeTurbo","TURBO","config","INSTANTLY","getRemainScripts","result","map","it","getLastCommand"],"mappings":"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","file":"BaseDirectorV2.js","sourceRoot":"../../../../../../../assets/cc-common/cc-share-v1/common/baseComponent","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n    onLoad() {\n        this.node.director = this;\n        this.lastCommand = null;\n        this.onExtendedLoad();\n    },\n    start() {\n        this.writer = this.node.writer;\n        this.forceToExitMode = false;\n        this.exitScript = [];\n    },\n    onExtendedLoad(){},\n    runAction(actionName,data) {\n        if (!this.writer || typeof this.writer['makeScript'+actionName] !== 'function') return;\n        let script = this.writer['makeScript'+actionName](data);\n        this.executeNextScript(script);\n    },\n    executeNextScript(script) {\n        if (!this.writer || !script || script.length == 0 || this.isSkipAllScrips) return;\n        this.script = script;\n        if(this.forceToExitMode && this.exitScript && this.exitScript.length >0){\n            this.script = this.exitScript;\n        }\n        // if(this.script.length === 0) return;\n        const nextScript = this.script.shift();\n        let { command, data } = nextScript;\n\n        command = this.getCommandName(command);\n        this.lastCommand = command;\n        if (this[command] && typeof this[command] === 'function') {\n            cc.log(this.name+' run command', command, data);\n            this[command](this.script,data);\n        } else {\n            cc.error('There is no '+this.name+' command', command);\n            this.executeNextScript(this.script);\n        }\n    },\n    getCommandName(command) {\n        let gameSpeed = this.getGameSpeed();\n        while (gameSpeed > 0) {\n            const commandWithSpeed = command + '_' + gameSpeed;\n            if (this[commandWithSpeed] && typeof this[commandWithSpeed] === 'function') {\n                return commandWithSpeed;\n            }\n            gameSpeed--;\n        }\n        return command;\n    },\n    destroyData() {\n        this.runAction = () => {};\n        this.executeNextScript = () => {};\n        this.script = [];\n    },\n\n    forceToExit(script){\n        this.forceToExitMode = true;\n        this.exitScript = script;\n    },\n\n    resetGameSpeed() {\n        this.node.gSlotDataStore.gameSpeed = this.getDefaultGameSpeed();\n    },\n    setGameSpeed(gameSpeed) {\n        this.node.gSlotDataStore.gameSpeed = gameSpeed || this.getDefaultGameSpeed();\n    },\n    setGameSpeedMode(mode = 'NORMAL') {\n        const GAME_SPEED = this.getGameSpeedConfig();\n        this.node.gSlotDataStore.gameSpeed = GAME_SPEED[mode] || GAME_SPEED.NORMAL;\n    },\n    getGameSpeed() {\n        return this.node.gSlotDataStore.gameSpeed || this.getDefaultGameSpeed();\n    },\n    getDefaultGameSpeed() {\n        const GAME_SPEED = this.getGameSpeedConfig();\n        return this.node.gSlotDataStore.modeTurbo ? GAME_SPEED.TURBO : GAME_SPEED.NORMAL;\n    },\n    getGameSpeedConfig() { // remove after all games updated\n        if (this.node.config && this.node.config.GAME_SPEED) {\n            return this.node.config.GAME_SPEED;\n        } else {\n            return {\n                NORMAL: 0,\n                TURBO: 1,\n                INSTANTLY: 2,\n            };\n        }\n    },\n    getRemainScripts() {\n        let result = [];\n        if (this.script) {\n            result = this.script.map(it => {return it.command;});\n        }\n        return result;\n    },\n    getLastCommand() {\n        return this.lastCommand;\n    },\n});\n"]}