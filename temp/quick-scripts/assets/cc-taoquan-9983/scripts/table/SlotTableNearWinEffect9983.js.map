{"version":3,"sources":["SlotTableNearWinEffect9983.js"],"names":["NodePool","require","cc","Class","extends","properties","paylineSymbol","Prefab","nearWinHolderNode","Node","tableNode","isNormalMode","start","node","on","reelStopNearWin","reelReset","adjustReelDelay","paylineSymbolPool","init","usingObj","getFirstNearWin","data","subSym","countSubSymbol","stopNearWinReel","nearWinList","col","length","isNearWinSubSymbol","isNearWin","row","symbolValue","indexOf","createPaylineSymbol","reels","count","context","isFastToResult","i","adjustReelSpeed","config","SUPER_TURBO","director","getScheduler","schedule","curentConfig","TIME","runAnimationNearWin","clearSymbolPaylines","getXPosition","index","SYMBOL_WIDTH","SYMBOL_MARGIN_RIGHT","reel","symbol","isSubSymbol","neawWinSymbol","getObj","push","parent","x","y","showNumber","SYMBOL_HEIGHT","disableHighlight","stopAnimation","removeAllChildren","children","forEach","symbolReel","opacity","remove","symbolName","currentIndex","enableHighlight","playAnimation"],"mappings":"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","file":"SlotTableNearWinEffect9983.js","sourceRoot":"../../../../../../assets/cc-taoquan-9983/scripts/table","sourcesContent":["\nconst NodePool = require('NodePool9983');\ncc.Class({\n    extends: require('SlotTableNearWinEffect'),\n\n    properties: {\n        paylineSymbol: cc.Prefab,\n        nearWinHolderNode: cc.Node,\n        tableNode: cc.Node,\n        isNormalMode: false,\n    },\n\n\n    start() {\n        this.node.on(\"REEL_STOP_NEARWIN\", this.reelStopNearWin, this);\n        this.node.on(\"TABLE_START_NEARWIN\", this.reelReset, this);\n        this.node.on(\"REEL_ABOUT_TO_STOP_NEARWIN\", this.adjustReelDelay, this);\n        this.reelReset();\n        this.paylineSymbolPool = new NodePool('SlotSymbolPayline9983');\n        this.paylineSymbolPool.init(this.paylineSymbol, 15);\n        this.usingObj = [];\n\n    },\n\n    reelReset() {\n        this.getFirstNearWin = false;\n    },\n\n    adjustReelDelay({ data, subSym }) {\n        let countSubSymbol = 0;\n        this.stopNearWinReel = 0;\n        this.nearWinList = [];\n\n        for (let col = 0; col < data.length; ++col) {\n            let isNearWinSubSymbol = countSubSymbol >= 0;\n            if (countSubSymbol != (col)) {\n                isNearWinSubSymbol = false;\n            }\n            const isNearWin = isNearWinSubSymbol;\n            for (let row = 0; row < data[col].length; ++row) {\n                const symbolValue = data[col][row];\n                if (subSym && subSym.indexOf((col * 3) + row) >= 0) {\n                    countSubSymbol++;\n                    this.createPaylineSymbol(this.node.reels[col], symbolValue, col, row, true);\n                }\n            }\n            if (isNearWin) {\n                this.nearWinList[col] = { isNearWinSubSymbol, isNearWin };\n            }\n\n        }\n    },\n\n    reelStopNearWin({ count, context }) {\n        if (this.nearWinList[count] && this.nearWinList[count].isNearWin && !context.isFastToResult) {\n            for (let i = count; i < this.node.reels.length; i++) {\n                this.node.reels[i].adjustReelSpeed(this.node.config.SUPER_TURBO);\n            }\n            if (count === (this.node.reels.length - 1)) {\n                cc.director.getScheduler().schedule(function () {\n                    this.node.reels[count].adjustReelSpeed(this.node.curentConfig.TIME);\n                }, this, 0, 0, 1, false);\n            }\n\n            if (this.nearWinList[count].isNearWinSubSymbol) {\n                this.runAnimationNearWin('subSymbol', count);\n            }\n        }\n        if (count >= this.node.reels.length) {\n            this.clearSymbolPaylines();\n        }\n    },\n    getXPosition(index) {\n        return (this.node.config.SYMBOL_WIDTH + this.node.config.SYMBOL_MARGIN_RIGHT) * index + this.node.config.SYMBOL_WIDTH / 2;\n    },\n    createPaylineSymbol(reel, symbol, col, row, isSubSymbol = false) {\n        let neawWinSymbol;\n\n        neawWinSymbol = this.paylineSymbolPool.getObj();\n        this.usingObj.push(neawWinSymbol);\n        neawWinSymbol.parent = this.nearWinHolderNode;\n        neawWinSymbol.init(symbol);\n        neawWinSymbol.symbol = symbol;\n        neawWinSymbol.isSubSymbol = isSubSymbol;\n        neawWinSymbol.col = col;\n        neawWinSymbol.row = row;\n        neawWinSymbol.x = this.getXPosition(col);\n        neawWinSymbol.y = (reel.showNumber - row + 0) * this.node.config.SYMBOL_HEIGHT - this.node.config.SYMBOL_HEIGHT / 2;\n        neawWinSymbol.disableHighlight();\n        neawWinSymbol.stopAnimation();\n\n        return neawWinSymbol;\n    },\n    clearSymbolPaylines() {\n        this.nearWinHolderNode.removeAllChildren(true);\n        this.tableNode.children.forEach((reel) => {\n            reel.children[0].children.forEach(symbolReel => {\n                symbolReel.opacity = 255;\n            });\n        });\n        for (let i = 0; i < this.usingObj.length; i++) {\n            this.usingObj[i].remove();\n        }\n        this.usingObj = [];\n    },\n\n    runAnimationNearWin(symbolName, currentIndex) {\n        this.nearWinHolderNode.children.forEach(symbol => {\n            if ((symbolName === 'subSymbol' && symbol.isSubSymbol || symbol.symbol === symbolName) && symbol.col < currentIndex) {\n                symbol.opacity = 255;\n                symbol.enableHighlight();\n                symbol.playAnimation();\n                this.tableNode.children[symbol.col].children[0].children[symbol.row + 1].opacity = 0;\n            }\n\n        });\n    },\n\n});\n"]}