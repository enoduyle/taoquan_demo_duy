{"version":3,"sources":["../../../../../../assets/cc-common/cc-slotbase-v2/component/assets/cc-common/cc-slotbase-v2/component/slotUtils.js"],"names":["factorial","combination","bezier","bezierTo","bezierBy","exportDataFile","importDataFile","getWorldScale","node","currentNode","scale","parent","_factoryCache","n","k","pos","t","length","t1","_val","i","Math","pow","duration","positions","option","_target","bezierX","bezierY","_options","Object","assign","progress","start","end","current","ratio","x","y","tweenBezier","cc","tween","call","map","p","to","_x","_y","dataStr","fileName","type","split","pop","dataUri","encodeURIComponent","linkElement","document","createElement","setAttribute","click","callback","input","window","body","appendChild","setTimeout","onchange","selectedFile","files","reader","FileReader","onload","event","console","log","target","result","readAsText","module","exports"],"mappings":";;;;;;;;;QAYgBA,YAAAA;QAMAC,cAAAA;QAIAC,SAAAA;QAUAC,WAAAA;QAwBAC,WAAAA;QA6BAC,iBAAAA;QAaAC,iBAAAA;;;;AAlGhB,SAASC,aAAT,CAAuBC,IAAvB,EAA4B;AACxB,QAAIC,cAAcD,IAAlB;AACA,QAAIE,QAAQD,YAAYC,KAAxB;AACA,WAAOD,YAAYE,MAAnB,EAA2B;AACvBD,iBAASD,YAAYE,MAAZ,CAAmBD,KAA5B;AACAD,sBAAcA,YAAYE,MAA1B;AACH;AACD,WAAOD,KAAP;AACH;;AAED,IAAME,gBAAgB,EAAtB;;AAEO,SAASZ,SAAT,CAAmBa,CAAnB,EAAsB;AACzB,QAAID,cAAcC,CAAd,MAAqB,KAAK,CAA9B,EAAiC,OAAOD,cAAcC,CAAd,CAAP;AACjCD,kBAAcC,CAAd,IAAmBA,IAAI,CAAJ,GAAQ,CAAR,GAAYA,IAAIb,UAAUa,IAAI,CAAd,CAAnC;AACA,WAAOD,cAAcC,CAAd,CAAP;AACH;;AAEM,SAASZ,WAAT,CAAqBY,CAArB,EAAwBC,CAAxB,EAA2B;AAC9B,WAAOd,UAAUa,CAAV,IAAeb,UAAUc,CAAV,CAAf,GAA8Bd,UAAUa,IAAIC,CAAd,CAArC;AACH;;AAEM,SAASZ,MAAT,CAAgBa,GAAhB,EAAqBC,CAArB,EAAwB;AAC3B,QAAMH,IAAIE,IAAIE,MAAJ,GAAa,CAAvB;AAAA,QAA0BC,KAAK,IAAIF,CAAnC;AACA,QAAIG,OAAO,CAAX;AACA,SAAK,IAAIC,IAAI,CAAb,EAAgBA,KAAKP,CAArB,EAAwBO,GAAxB,EAA6B;AACzB;AACAD,gBAAQJ,IAAIK,CAAJ,IAASnB,YAAYY,CAAZ,EAAeO,CAAf,CAAT,GAA6BC,KAAKC,GAAL,CAASN,CAAT,EAAYI,CAAZ,CAA7B,GAA8CC,KAAKC,GAAL,CAASJ,EAAT,EAAcL,IAAIO,CAAlB,CAAtD;AACH;AACD,WAAOD,IAAP;AACH;;AAEM,SAAShB,QAAT,CAAkBK,IAAlB,EAAwBe,QAAxB,EAAkCC,SAAlC,EAA0D;AAAA,QAAbC,MAAa,uEAAJ,EAAI;;AAC7D,QAAMC,UAAU,EAAEV,GAAG,CAAL,EAAhB;AACA,QAAIW,gBAAJ;AAAA,QAAaC,gBAAb;AACA,QAAMC,WAAWC,OAAOC,MAAP,CAAc,EAAd,EAAkBN,MAAlB,CAAjB;AACAI,aAASG,QAAT,GAAoB,UAACC,KAAD,EAAQC,GAAR,EAAaC,OAAb,EAAsBC,KAAtB,EAAgC;AAAA,YACxCpB,CADwC,GAClCU,OADkC,CACxCV,CADwC;;AAEhDR,aAAK6B,CAAL,GAASnC,OAAOyB,OAAP,EAAgBX,CAAhB,CAAT;AACAR,aAAK8B,CAAL,GAASpC,OAAO0B,OAAP,EAAgBZ,CAAhB,CAAT;AACA,eAAOiB,QAAQ,CAACC,MAAMD,KAAP,IAAgBG,KAA/B;AACH,KALD;;AAOA,QAAMG,cAAcC,GAAGC,KAAH,CAASf,OAAT,EACfgB,IADe,CACV,YAAM;AACRhB,gBAAQV,CAAR,GAAY,CAAZ;AADQ,YAEAqB,CAFA,GAES7B,IAFT,CAEA6B,CAFA;AAAA,YAEGC,CAFH,GAES9B,IAFT,CAEG8B,CAFH;;AAGRX,mBAAWU,CAAX,4BAAiBb,UAAUmB,GAAV,CAAc;AAAA,mBAAKC,EAAEP,CAAP;AAAA,SAAd,CAAjB;AACAT,mBAAWU,CAAX,4BAAiBd,UAAUmB,GAAV,CAAc;AAAA,mBAAKC,EAAEN,CAAP;AAAA,SAAd,CAAjB;AACH,KANe,EAOfO,EAPe,CAOZtB,QAPY,EAOF,EAAEP,GAAG,CAAL,EAPE,EAOQa,QAPR,EAQfI,KARe,EAApB;;AAUA,WAAOM,WAAP;AACH;;AAEM,SAASnC,QAAT,CAAkBI,IAAlB,EAAwBe,QAAxB,EAAkCC,SAAlC,EAA0D;AAAA,QAAbC,MAAa,uEAAJ,EAAI;;AAC7D,QAAMC,UAAU,EAAEV,GAAG,CAAL,EAAhB;AACA,QAAIW,gBAAJ;AAAA,QAAaC,gBAAb;;AAEAH,WAAOO,QAAP,GAAkB,UAACC,KAAD,EAAQC,GAAR,EAAaC,OAAb,EAAsBC,KAAtB,EAAgC;AAAA,YACtCpB,CADsC,GAChCU,OADgC,CACtCV,CADsC;;AAE9CR,aAAK6B,CAAL,GAASnC,OAAOyB,OAAP,EAAgBX,CAAhB,CAAT;AACAR,aAAK8B,CAAL,GAASpC,OAAO0B,OAAP,EAAgBZ,CAAhB,CAAT;AACA,eAAOiB,QAAQ,CAACC,MAAMD,KAAP,IAAgBG,KAA/B;AACH,KALD;;AAOA,QAAMG,cAAcC,GAAGC,KAAH,CAASf,OAAT,EACfgB,IADe,CACV,YAAM;AACRhB,gBAAQV,CAAR,GAAY,CAAZ;AADQ,YAEAqB,CAFA,GAES7B,IAFT,CAEA6B,CAFA;AAAA,YAEGC,CAFH,GAES9B,IAFT,CAEG8B,CAFH;;AAGR,YAAIQ,KAAKT,CAAT;AAAA,YAAYU,KAAKT,CAAjB;AACAX,mBAAWU,CAAX,4BAAiBb,UAAUmB,GAAV,CAAc;AAAA,mBAAKG,MAAMF,EAAEP,CAAb;AAAA,SAAd,CAAjB;AACAT,mBAAWU,CAAX,4BAAiBd,UAAUmB,GAAV,CAAc;AAAA,mBAAKI,MAAMH,EAAEN,CAAb;AAAA,SAAd,CAAjB;AACH,KAPe,EAQfO,EARe,CAQZtB,QARY,EAQF,EAAEP,GAAG,CAAL,EARE,EAQQS,MARR,EASfQ,KATe,EAApB;;AAWA,WAAOM,WAAP;AACH;;AAED;;;;AAIO,SAASlC,cAAT,CAAwB2C,OAAxB,EAAiCC,QAAjC,EAA2C;AAC9C,QAAIC,OAAOD,SAASE,KAAT,CAAe,GAAf,EAAoBC,GAApB,EAAX;AACA,QAAMC,gCAA8BH,IAA9B,uBAAoDI,mBAAmBN,OAAnB,CAA1D;AACA,QAAMO,cAAcC,SAASC,aAAT,CAAuB,GAAvB,CAApB;AACAF,gBAAYG,YAAZ,CAAyB,MAAzB,EAAiCL,OAAjC;AACAE,gBAAYG,YAAZ,CAAyB,UAAzB,EAAqCT,QAArC;AACAM,gBAAYI,KAAZ;AACH;;AAED;;;;AAIO,SAASrD,cAAT,CAAwBsD,QAAxB,EAAkC;AACrC,QAAMC,QAAQC,OAAON,QAAP,CAAgBC,aAAhB,CAA8B,OAA9B,CAAd;AACAI,UAAMX,IAAN,GAAa,MAAb;AACAM,aAASO,IAAT,CAAcC,WAAd,CAA0BH,KAA1B;AACAI,eAAW,YAAM;AACbJ,cAAMF,KAAN;AACH,KAFD,EAEG,GAFH;AAGAE,UAAMK,QAAN,GAAiB,YAAM;AACnB,YAAMC,eAAeN,MAAMO,KAAN,CAAY,CAAZ,CAArB;AACA,YAAMC,SAAS,IAAIC,UAAJ,EAAf;AACAD,eAAOE,MAAP,GAAgB,UAACC,KAAD,EAAW;AACvBC,oBAAQC,GAAR,CAAY,aAAZ,EAA2BF,MAAMG,MAAN,CAAaC,MAAxC;AACAhB,qBAASY,MAAMG,MAAN,CAAaC,MAAtB;AACH,SAHD;AAIAP,eAAOQ,UAAP,CAAkBV,YAAlB;AACH,KARD;AASH;;AAGDW,OAAOC,OAAP,GAAiB;AACbxE,gCADa;AAEbJ,sBAFa;AAGbC,sBAHa;AAIbF,kBAJa;AAKbG,kCALa;AAMbC;AANa,CAAjB","file":"slotUtils.js","sourceRoot":"../../../../../../assets/cc-common/cc-slotbase-v2/component","sourcesContent":["function getWorldScale(node){\n    let currentNode = node;\n    let scale = currentNode.scale;\n    while (currentNode.parent) {\n        scale *= currentNode.parent.scale;\n        currentNode = currentNode.parent;\n    }\n    return scale;\n}\n\nconst _factoryCache = {};\n\nexport function factorial(n) {\n    if (_factoryCache[n] !== void 0) return _factoryCache[n];\n    _factoryCache[n] = n < 2 ? 1 : n * factorial(n - 1);\n    return _factoryCache[n];\n}\n\nexport function combination(n, k) {\n    return factorial(n) / factorial(k) / factorial(n - k);\n}\n\nexport function bezier(pos, t) {\n    const n = pos.length - 1, t1 = 1 - t;\n    let _val = 0;\n    for (let i = 0; i <= n; i++) {\n        // Pi * Combine(n,i) * t^i * (1-t)^(n-i)\n        _val += pos[i] * combination(n, i) * Math.pow(t, i) * Math.pow(t1, (n - i));\n    }\n    return _val;\n}\n\nexport function bezierTo(node, duration, positions, option = {}) {\n    const _target = { t: 0 };\n    let bezierX, bezierY;\n    const _options = Object.assign({}, option);\n    _options.progress = (start, end, current, ratio) => {\n        const { t } = _target;\n        node.x = bezier(bezierX, t);\n        node.y = bezier(bezierY, t);\n        return start + (end - start) * ratio;\n    }\n\n    const tweenBezier = cc.tween(_target)\n        .call(() => {\n            _target.t = 0;\n            const { x, y } = node;\n            bezierX = [x, ...positions.map(p => p.x)];\n            bezierY = [y, ...positions.map(p => p.y)];\n        })\n        .to(duration, { t: 1 }, _options)\n        .start();\n\n    return tweenBezier;\n}\n\nexport function bezierBy(node, duration, positions, option = {}) {\n    const _target = { t: 0 };\n    let bezierX, bezierY;\n    \n    option.progress = (start, end, current, ratio) => {\n        const { t } = _target;\n        node.x = bezier(bezierX, t);\n        node.y = bezier(bezierY, t);\n        return start + (end - start) * ratio;\n    }\n\n    const tweenBezier = cc.tween(_target)\n        .call(() => {\n            _target.t = 0;\n            const { x, y } = node;\n            let _x = x, _y = y;\n            bezierX = [x, ...positions.map(p => _x += p.x)];\n            bezierY = [y, ...positions.map(p => _y += p.y)];\n        })\n        .to(duration, { t: 1 }, option)\n        .start();\n\n    return tweenBezier;\n}\n\n/**\n * @only for web\n * @example exportDataFile({\"speed\":10}, config.json);\n */\nexport function exportDataFile(dataStr, fileName) {\n    let type = fileName.split(\".\").pop();\n    const dataUri = `data:application/${type};charset=utf-8,${encodeURIComponent(dataStr)}`;\n    const linkElement = document.createElement('a');\n    linkElement.setAttribute('href', dataUri);\n    linkElement.setAttribute('download', fileName);\n    linkElement.click();\n}\n\n/**\n * @only for web\n * @example importDataFile((result)=> {console.log(result)});\n */\nexport function importDataFile(callback) {\n    const input = window.document.createElement(\"input\");\n    input.type = \"file\";\n    document.body.appendChild(input);\n    setTimeout(() => {\n        input.click();\n    }, 500);\n    input.onchange = () => {\n        const selectedFile = input.files[0];\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            console.log(\"file loaded\", event.target.result);\n            callback(event.target.result);\n        };\n        reader.readAsText(selectedFile);\n    }\n}\n\n\nmodule.exports = {\n    getWorldScale,\n    bezierTo,\n    bezierBy,\n    bezier,\n    exportDataFile,\n    importDataFile\n};"]}