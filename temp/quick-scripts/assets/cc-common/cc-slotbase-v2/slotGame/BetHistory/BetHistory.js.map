{"version":3,"sources":["BetHistory.js"],"names":["globalNetwork","require","cc","Class","extends","properties","noBetHistoryText","Node","betHistoryNode","betDetailNode","closeButton","pageIndex","onLoad","_super","extendOnload","node","on","closeNotice","openBetDetail","showBetHistory","start","localizeText","config","MESSAGE_DIALOG","NO_BET_HISTORY","getComponentInChildren","Label","string","ERROR_CONNECTION_HISTORY","errorMessage","HISTORY_PAGE","init","GAME_ID","initBase","currentPage","gameId","url","openPanel","active","opacity","requestDataPage","page","quantity","callback","callbackErr","from","token","getToken","headers","Authorization","requestParams","serviceId","size","requestHistory","onRequestResponse","res","stopLoading","table","emit","error","msg","serverMessage","isError","nextBtn","getComponent","Button","interactable","backBtn","Object","keys","length","data","resultList","total","totalPage","Math","ceil","itemPerPage","updatePageIndexView","playLoading","ev","loading","stopPropagation","getUserData","showBetDetail","setToken","type","userId","tokenType","disableCloseDetail","requestErr"],"mappings":"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","file":"BetHistory.js","sourceRoot":"../../../../../../../assets/cc-common/cc-slotbase-v2/slotGame/BetHistory","sourcesContent":["const globalNetwork = require('globalNetwork');\n\n\ncc.Class({\n    extends: require(\"BaseHistory\"),\n\n    properties: {\n        noBetHistoryText: cc.Node,\n        betHistoryNode: cc.Node,\n        betDetailNode: cc.Node,\n        closeButton: cc.Node,\n        pageIndex: cc.Node,\n    },\n\n    onLoad() {\n        this._super();\n        this.extendOnload();\n        this.node.on(\"CLOSE_NOTICE\", this.closeNotice, this);\n        this.node.on(\"OPEN_BET_DETAIL\", this.openBetDetail, this);\n        this.betDetailNode.on(\"SHOW_BET_HISTORY\", ()=>{\n            this.showBetHistory();\n        });\n    },\n\n    start() {\n        this.localizeText();\n    },\n\n    localizeText() {\n        if (this.node.config.MESSAGE_DIALOG) {\n            if (this.node.config.MESSAGE_DIALOG.NO_BET_HISTORY) {\n                this.noBetHistoryText.getComponentInChildren(cc.Label).string = this.node.config.MESSAGE_DIALOG.NO_BET_HISTORY;\n            }\n            if (this.node.config.MESSAGE_DIALOG.ERROR_CONNECTION_HISTORY) {\n                this.errorMessage.getComponentInChildren(cc.Label).string = this.node.config.MESSAGE_DIALOG.ERROR_CONNECTION_HISTORY;\n            }\n            if (this.pageIndex && this.node.config.MESSAGE_DIALOG.HISTORY_PAGE) {\n                this.pageIndex.getComponentInChildren(cc.Label).string = this.node.config.MESSAGE_DIALOG.HISTORY_PAGE;\n            }\n        }\n    },\n\n    extendOnload() {\n        this.init(this.node.config.GAME_ID);\n    },\n\n    initBase()\n    {\n        this._super();\n        this.currentPage = 1;\n    },\n\n    init(gameId, url = \"history/getHistoryUserSpins\") {\n        this.gameId = gameId;\n        this.url = url;\n    },\n\n    openPanel() {\n        this.showBetHistory();\n        this._super();\n        if(this.pageIndex) this.pageIndex.active = false;\n    },\n\n    showBetHistory() {\n        this.betHistoryNode.active = true;\n        this.betHistoryNode.opacity = 255;\n        this.betDetailNode.active = false;\n    },\n\n    requestDataPage(page, quantity, callback, callbackErr) {\n        let from = (page - 1) * quantity;\n        let token = globalNetwork.getToken();\n        let headers = {\n            Authorization: token,\n        };\n        let requestParams = {\n            serviceId: this.gameId,\n            from: from,\n            size: quantity,\n        };\n        if (this.errorMessage) this.errorMessage.active = false;\n        this.requestHistory(requestParams, callback, callbackErr, headers);\n    },\n\n    onRequestResponse(res) {\n        this.stopLoading();\n        this.table.emit('CLEAR_DATA');\n        if (res.error && res.error.msg) {\n            this.serverMessage.active = true;\n            this.serverMessage.getComponentInChildren(cc.Label).string = res.error.msg;\n            this.isError= true;\n            this.nextBtn.getComponent(cc.Button).interactable = false;\n            this.backBtn.getComponent(cc.Button).interactable = false;\n        }\n        else if (!res.error && Object.keys(res).length > 0 && res.data && res.data.resultList.length > 0) {\n            if (res.data && res.data.total) this.totalPage = Math.ceil(res.data.total / this.itemPerPage);\n\n            this.isError= false;\n            if(this.pageIndex) this.pageIndex.active = true;\n            this.nextBtn.getComponent(cc.Button).interactable = true;\n            this.backBtn.getComponent(cc.Button).interactable = true;\n            this.updatePageIndexView(this.currentPage);\n            if (this.table) this.table.opacity = 255;\n            this.table.emit('UPDATE_DATA', res.data.resultList);\n            if (this.currentPage == 1) {\n                this.backBtn.getComponent(cc.Button).interactable = false;\n            }\n            if (this.currentPage * this.itemPerPage >= res.data.total) {\n                this.nextBtn.getComponent(cc.Button).interactable = false;\n                return;\n            }\n        }\n        else if (res.error || !res.data || res.data.resultList.length <= 0) {\n            this.noBetHistoryText.active = true;\n            if(this.pageIndex) this.pageIndex.active = false;\n        } else {\n            this.noBetHistoryText.active = false;\n            if(this.pageIndex) this.pageIndex.active = true;\n        }\n    },\n\n    playLoading() {\n        this._super();\n        this.serverMessage.active = false;\n        this.noBetHistoryText.active = false;\n    },\n\n    openBetDetail(ev) {\n        if (this.loading.active) return;\n        ev.stopPropagation();\n        let data = ev.getUserData();\n        this.showBetDetail(data);\n    },\n\n    showBetDetail(data) {\n        this.betHistoryNode.active = false;\n        this.betDetailNode.active = true;\n        this.betDetailNode.emit(\"OPEN_BET_DETAIL\", data);\n    },\n\n    setToken(token, type = 'user', userId) {\n        this.token = token;\n        this.tokenType = type;\n        this.userId = userId;\n        this.betDetailNode.getComponent('BetDetailHistory').setToken(token, type, userId);\n    },\n\n    disableCloseDetail() {\n        this.betDetailNode.emit(\"DISABLE_CLOSE\");\n    },\n\n    closeNotice(){\n        if (this.errorMessage) this.errorMessage.active = false;\n        this.betDetailNode.emit(\"CLOSE_NOTICE\");\n    },\n    requestErr() {\n        this._super();\n        this.noBetHistoryText.active = false;\n    },\n});\n"]}