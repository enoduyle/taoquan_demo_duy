{"version":3,"sources":["../../../../../../assets/cc-common/cc-share-v1/shareServices/assets/cc-common/cc-share-v1/shareServices/loadConfigAsync.js"],"names":["serviceRest","require","lodash","appConfig","XOCypher","decryptData","data","keyEncrypt","IS_DECODE","Object","keys","forEach","key","indexOf","isArray","i","length","decode","loadConfigAsync","dataUpdate","cloneDeep","isDebugMode","cc","sys","isBrowser","window","location","hostname","REMOTE_CONFIG_URL_FULL","setTimeout","get","apiUrl","url","callback","handleDataSuccess","bind","callbackErr","handleDataError","getRawDataWeb","fullURL","REMOTE_CONFIG_URL","dataConfigM","dataUpdateProd","localStorage","setItem","JSON","stringify","IS_FINISHED_REMOTE","timeStampBuild","buildTime","parseInt","Date","getTime","domainName","globalDomainSupport","origin","params","t","getItem","appConfigDebug","e","appConfigLocal","parse","getConfig","TOKEN","switchEnv","isProd","setUpSentry","IS_PRODUCTION","IS_SHOW_STATS","Sentry","init","dsn","debug","setDisplayStats","setToken","token","module","exports"],"mappings":";;;;;;AAAA;;AAEA,IAAMA,cAAcC,QAAQ,aAAR,CAApB;AACA,IAAMC,SAASD,QAAQ,QAAR,CAAf;AACA,IAAME,YAAYF,QAAQ,WAAR,CAAlB;AACA,IAAMG,WAAWH,QAAQ,UAAR,CAAjB;;AAEA,IAAMI,cAAc,SAAdA,WAAc,CAACC,IAAD,EAAU;AAC1B,QAAMC,aAAa,uBAAnB;AACA,QAAID,KAAKE,SAAT,EAAoB;AAChBC,eAAOC,IAAP,CAAYJ,IAAZ,EAAkBK,OAAlB,CAA0B,eAAO;AAC7B,gBAAIC,QAAQ,SAAR,IAAqBA,QAAQ,YAA7B,IAA6CA,IAAIC,OAAJ,CAAY,UAAZ,IAA0B,CAAC,CAA5E,EAA+E;AAC3E,oBAAIX,OAAOY,OAAP,CAAeR,KAAKM,GAAL,CAAf,CAAJ,EAA+B;AAC3B,yBAAK,IAAIG,IAAI,CAAb,EAAgBA,IAAIT,KAAKM,GAAL,EAAUI,MAA9B,EAAsCD,GAAtC,EAA2C;AACvCT,6BAAKM,GAAL,EAAUG,CAAV,IAAeX,SAASa,MAAT,CAAgBV,UAAhB,EAA4BD,KAAKM,GAAL,EAAUG,CAAV,CAA5B,CAAf;AACH;AACJ,iBAJD,MAIO;AACHT,yBAAKM,GAAL,IAAYR,SAASa,MAAT,CAAgBV,UAAhB,EAA4BD,KAAKM,GAAL,CAA5B,CAAZ;AACH;AACJ;AACJ,SAVD;AAWH;AACD,WAAON,KAAKE,SAAZ;AACA,WAAOF,IAAP;AACH,CAjBD;;AAmBA,SAASY,eAAT,GAA2B;AAAA;;AACvB,SAAKC,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBjB,SAAjB,CAAlB;AACA,QAAMkB,cAAcC,GAAGC,GAAH,CAAOC,SAAP,IAAoBC,OAAOC,QAAP,CAAgBC,QAAhB,KAA6B,WAArE;;AAGA,QAAI,KAAKR,UAAL,CAAgBS,sBAAhB,IAA0C,CAACN,GAAGC,GAAH,CAAOC,SAAlD,IAA+D,CAACH,WAApE,EAAiF;AAC7EQ,mBAAW,YAAM;AACb7B,wBAAY8B,GAAZ,CAAgB;AACZC,wBAAQ,MAAKZ,UAAL,CAAgBS,sBADZ;AAEZI,qBAAK,EAFO;AAGZC,0BAAUC,kBAAkBC,IAAlB,OAHE;AAIZC,6BAAaC,gBAAgBF,IAAhB;AAJD,aAAhB;AAMH,SAPD,EAOG,GAPH;AAQH,KATD,MAUK,IAAI,KAAKhB,UAAL,CAAgBS,sBAAhB,IAA0CN,GAAGC,GAAH,CAAOC,SAAjD,IAA8D,CAACH,WAAnE,EAAgF;AACjFQ,mBAAW,YAAM;AACb7B,wBAAYsC,aAAZ,CAA0B;AACtBC,yBAAS,MAAKpB,UAAL,CAAgBS,sBADH;AAEtBK,0BAAUC,kBAAkBC,IAAlB,OAFY;AAGtBC,6BAAaC,gBAAgBF,IAAhB;AAHS,aAA1B;AAKH,SAND,EAMG,GANH;AAOH,KARI,MASA,IAAI,KAAKhB,UAAL,CAAgBqB,iBAAhB,IAAqClB,GAAGC,GAAH,CAAOC,SAA5C,IAAyD,CAACH,WAA9D,EAA2E;AAC5E,YAAII,UAAUA,OAAOgB,WAArB,EAAkC;AAC9B,iBAAKtB,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBK,OAAOgB,WAAxB,CAAlB;AACA,iBAAKtB,UAAL,GAAkBd,YAAY,KAAKc,UAAjB,CAAlB;AACA,iBAAKuB,cAAL,GAAsBxC,OAAOkB,SAAP,CAAiB,KAAKD,UAAtB,CAAtB;AACAG,eAAGC,GAAH,CAAOoB,YAAP,CAAoBC,OAApB,CAA4B,qBAA5B,EAAmDC,KAAKC,SAAL,CAAe,KAAKJ,cAApB,CAAnD;AACA,iBAAKvB,UAAL,CAAgB4B,kBAAhB,GAAqC,IAArC;AACH,SAND,MAMO;AACH,gBAAMC,iBAAiBvB,OAAOwB,SAAP,GAAmBC,SAASzB,OAAOwB,SAAhB,CAAnB,GAAgD,IAAIE,IAAJ,GAAWC,OAAX,EAAvE;AACAvB,uBAAW,YAAM;AACb,oBAAMwB,aAAa,OAAOC,mBAAP,KAA+B,WAA/B,GAA6CA,mBAA7C,GAAmE7B,OAAOC,QAAP,CAAgB6B,MAAtG;AACAvD,4BAAY8B,GAAZ,CAAgB;AACZC,4BAAQsB,aAAa,MAAKlC,UAAL,CAAgBqB,iBADzB;AAEZgB,4BAAO,EAACC,GAAIT,cAAL,EAFK;AAGZhB,yBAAK,EAHO;AAIZC,8BAAUC,kBAAkBC,IAAlB,OAJE;AAKZC,iCAAaC,gBAAgBF,IAAhB;AALD,iBAAhB;AAOH,aATD,EASG,GATH;AAUH;AACJ,KApBI,MAoBE;AACH,YAAIb,GAAGC,GAAH,CAAOoB,YAAP,CAAoBe,OAApB,CAA4B,YAA5B,KAA6C,IAAjD,EAAuD;AACnD,gBAAI;AACA,oBAAIpC,GAAGC,GAAH,CAAOoB,YAAP,CAAoBe,OAApB,CAA4B,YAA5B,EAA0C7C,OAA1C,CAAkD,MAAlD,KAA6D,CAAjE,EAAoE;AAChE,wBAAM8C,iBAAiB1D,QAAQ,iBAAR,CAAvB;AACA,wBAAI0D,cAAJ,EAAoB;AAChB,6BAAKxC,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBuC,cAAjB,CAAlB;AACA,6BAAKxC,UAAL,GAAkBd,YAAY,KAAKc,UAAjB,CAAlB;AACH,qBAHD,MAGO;AACH,6BAAKA,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBjB,SAAjB,CAAlB;AACA,6BAAKgB,UAAL,GAAkBd,YAAY,KAAKc,UAAjB,CAAlB;AACH;AACJ,iBATD,MASO;AACH,yBAAKA,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBjB,SAAjB,CAAlB;AACA,yBAAKgB,UAAL,GAAkBd,YAAY,KAAKc,UAAjB,CAAlB;AACH;AACJ,aAdD,CAcE,OAAOyC,CAAP,EAAU;AACR,qBAAKzC,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBjB,SAAjB,CAAlB;AACA,qBAAKgB,UAAL,GAAkBd,YAAY,KAAKc,UAAjB,CAAlB;AACH;AACJ,SAnBD,MAmBO;AACH,iBAAKA,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBjB,SAAjB,CAAlB;AACA,iBAAKgB,UAAL,GAAkBd,YAAY,KAAKc,UAAjB,CAAlB;AACH;AACD,aAAKA,UAAL,CAAgB4B,kBAAhB,GAAqC,IAArC;AACH;;AAED,QAAMb,oBAAoB,SAApBA,iBAAoB,CAAC5B,IAAD,EAAU;AAChC,cAAKa,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBd,IAAjB,CAAlB;AACA,cAAKa,UAAL,GAAkBd,YAAY,MAAKc,UAAjB,CAAlB;AACA,cAAKuB,cAAL,GAAsBxC,OAAOkB,SAAP,CAAiB,MAAKD,UAAtB,CAAtB;AACAG,WAAGC,GAAH,CAAOoB,YAAP,CAAoBC,OAApB,CAA4B,qBAA5B,EAAmDC,KAAKC,SAAL,CAAe,MAAKJ,cAApB,CAAnD;AACA,cAAKvB,UAAL,CAAgB4B,kBAAhB,GAAqC,IAArC;AACH,KAND;;AAQA,QAAMV,kBAAkB,SAAlBA,eAAkB,GAAM;AAC1B,YAAIwB,iBAAiBvC,GAAGC,GAAH,CAAOoB,YAAP,CAAoBe,OAApB,CAA4B,qBAA5B,CAArB;AACA,YAAIG,cAAJ,EAAoB;AAChBA,6BAAiBhB,KAAKiB,KAAL,CAAWD,cAAX,CAAjB;AACA,kBAAK1C,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiByC,cAAjB,CAAlB;AACH,SAHD,MAGO;AACH,kBAAK1C,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBjB,SAAjB,CAAlB;AACH;AACD,cAAKgB,UAAL,GAAkBd,YAAY,MAAKc,UAAjB,CAAlB;AACA,cAAKuB,cAAL,GAAsBxC,OAAOkB,SAAP,CAAiB,MAAKD,UAAtB,CAAtB;AACA,cAAKA,UAAL,CAAgB4B,kBAAhB,GAAqC,IAArC;AACH,KAXD;;AAaA,QAAMgB,YAAY,SAAZA,SAAY,GAAM;AACpB,cAAK5C,UAAL,CAAgB6C,KAAhB,GAAwB,MAAKA,KAA7B;AACA,eAAO,MAAK7C,UAAZ;AACH,KAHD;;AAKA,QAAM8C,YAAY,SAAZA,SAAY,CAACC,MAAD,EAAY;AAC1B,YAAIA,MAAJ,EAAY;AACR,gBAAM/D,aAAYF,QAAQ,WAAR,CAAlB;AACA,gBAAI,MAAKyC,cAAT,EAAyB;AACrB,sBAAKvB,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiB,MAAKsB,cAAtB,CAAlB;AACH,aAFD,MAEO;AACH,sBAAKvB,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBjB,UAAjB,CAAlB;AACH;AACD,kBAAKgB,UAAL,GAAkBd,YAAY,MAAKc,UAAjB,CAAlB;AACA,kBAAKA,UAAL,CAAgB4B,kBAAhB,GAAqC,IAArC;AACH,SATD,MASO;AACH,gBAAMY,kBAAiB1D,QAAQ,iBAAR,CAAvB;AACA,kBAAKkB,UAAL,GAAkBjB,OAAOkB,SAAP,CAAiBuC,eAAjB,CAAlB;AACA,kBAAKxC,UAAL,GAAkBd,YAAY,MAAKc,UAAjB,CAAlB;AACA,kBAAKA,UAAL,CAAgB4B,kBAAhB,GAAqC,IAArC;AACH;AACJ,KAhBD;;AAkBA,QAAMoB,cAAc,SAAdA,WAAc,GAAM;AAAA,0BACiB,MAAKhD,UADtB;AAAA,YACfiD,aADe,eACfA,aADe;AAAA,YACAC,aADA,eACAA,aADA;;AAEtB,YAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,gBAAIF,aAAJ,EAAmB;AACfE,uBAAOC,IAAP,CAAY,EAAEC,KAAK,4DAAP,EAAZ;AACH,aAFD,MAEO;AACH,oBAAIH,aAAJ,EAAmB;AACf/C,uBAAGmD,KAAH,CAASC,eAAT,CAAyB,IAAzB;AACH;AACDJ,uBAAOC,IAAP,CAAY,EAAEC,KAAK,4DAAP,EAAZ;AACH;AACJ;AACJ,KAZD;;AAcA,QAAMG,WAAW,SAAXA,QAAW,CAACC,KAAD,EAAW;AACxB,cAAKZ,KAAL,GAAaY,KAAb;AACH,KAFD;;AAIA,WAAO;AACHD,0BADG;AAEHR,gCAFG;AAGHF,4BAHG;AAIHF;AAJG,KAAP;AAMH;;AAEDc,OAAOC,OAAP,GAAiB,IAAI5D,eAAJ,EAAjB","file":"loadConfigAsync.js","sourceRoot":"../../../../../../assets/cc-common/cc-share-v1/shareServices","sourcesContent":["/* global globalDomainSupport,Sentry, CC_DEV */\n\nconst serviceRest = require('serviceRest');\nconst lodash = require('lodash');\nconst appConfig = require('appConfig');\nconst XOCypher = require(\"XOCypher\");\n\nconst decryptData = (data) => {\n    const keyEncrypt = 'Không Biết Đặt Tên Gì';\n    if (data.IS_DECODE) {\n        Object.keys(data).forEach(key => {\n            if (key === 'API_URL' || key === 'SOCKET_URL' || key.indexOf('IPMaster') > -1) {\n                if (lodash.isArray(data[key])) {\n                    for (let i = 0; i < data[key].length; i++) {\n                        data[key][i] = XOCypher.decode(keyEncrypt, data[key][i]);\n                    }\n                } else {\n                    data[key] = XOCypher.decode(keyEncrypt, data[key]);\n                }\n            }\n        });\n    }\n    delete data.IS_DECODE;\n    return data;\n};\n\nfunction loadConfigAsync() {\n    this.dataUpdate = lodash.cloneDeep(appConfig);\n    const isDebugMode = cc.sys.isBrowser && window.location.hostname === 'localhost';\n    \n\n    if (this.dataUpdate.REMOTE_CONFIG_URL_FULL && !cc.sys.isBrowser && !isDebugMode) {\n        setTimeout(() => {\n            serviceRest.get({\n                apiUrl: this.dataUpdate.REMOTE_CONFIG_URL_FULL,\n                url: '',\n                callback: handleDataSuccess.bind(this),\n                callbackErr: handleDataError.bind(this)\n            });\n        }, 100);\n    }\n    else if (this.dataUpdate.REMOTE_CONFIG_URL_FULL && cc.sys.isBrowser && !isDebugMode) {\n        setTimeout(() => {\n            serviceRest.getRawDataWeb({\n                fullURL: this.dataUpdate.REMOTE_CONFIG_URL_FULL,\n                callback: handleDataSuccess.bind(this),\n                callbackErr: handleDataError.bind(this)\n            });\n        }, 100);\n    }\n    else if (this.dataUpdate.REMOTE_CONFIG_URL && cc.sys.isBrowser && !isDebugMode) {\n        if (window && window.dataConfigM) {\n            this.dataUpdate = lodash.cloneDeep(window.dataConfigM);\n            this.dataUpdate = decryptData(this.dataUpdate);\n            this.dataUpdateProd = lodash.cloneDeep(this.dataUpdate);\n            cc.sys.localStorage.setItem('appConfigLocalStore', JSON.stringify(this.dataUpdateProd));\n            this.dataUpdate.IS_FINISHED_REMOTE = true;\n        } else {\n            const timeStampBuild = window.buildTime ? parseInt(window.buildTime) : new Date().getTime();\n            setTimeout(() => {\n                const domainName = typeof globalDomainSupport !== 'undefined' ? globalDomainSupport : window.location.origin;\n                serviceRest.get({\n                    apiUrl: domainName + this.dataUpdate.REMOTE_CONFIG_URL,\n                    params:{t : timeStampBuild}, \n                    url: '',\n                    callback: handleDataSuccess.bind(this),\n                    callbackErr: handleDataError.bind(this)\n                });\n            }, 100);\n        }\n    } else {\n        if (cc.sys.localStorage.getItem(\"enviroment\") != null) {\n            try {\n                if (cc.sys.localStorage.getItem(\"enviroment\").indexOf(\"test\") >= 0) {\n                    const appConfigDebug = require('appConfig-debug');\n                    if (appConfigDebug) {\n                        this.dataUpdate = lodash.cloneDeep(appConfigDebug);\n                        this.dataUpdate = decryptData(this.dataUpdate);\n                    } else {\n                        this.dataUpdate = lodash.cloneDeep(appConfig);\n                        this.dataUpdate = decryptData(this.dataUpdate);\n                    }\n                } else {\n                    this.dataUpdate = lodash.cloneDeep(appConfig);\n                    this.dataUpdate = decryptData(this.dataUpdate);\n                }\n            } catch (e) {\n                this.dataUpdate = lodash.cloneDeep(appConfig);\n                this.dataUpdate = decryptData(this.dataUpdate);\n            }\n        } else {\n            this.dataUpdate = lodash.cloneDeep(appConfig);\n            this.dataUpdate = decryptData(this.dataUpdate);\n        }\n        this.dataUpdate.IS_FINISHED_REMOTE = true;\n    }\n\n    const handleDataSuccess = (data) => {\n        this.dataUpdate = lodash.cloneDeep(data);\n        this.dataUpdate = decryptData(this.dataUpdate);\n        this.dataUpdateProd = lodash.cloneDeep(this.dataUpdate);\n        cc.sys.localStorage.setItem('appConfigLocalStore', JSON.stringify(this.dataUpdateProd));\n        this.dataUpdate.IS_FINISHED_REMOTE = true;\n    };\n\n    const handleDataError = () => {\n        let appConfigLocal = cc.sys.localStorage.getItem('appConfigLocalStore');\n        if (appConfigLocal) {\n            appConfigLocal = JSON.parse(appConfigLocal);\n            this.dataUpdate = lodash.cloneDeep(appConfigLocal);\n        } else {\n            this.dataUpdate = lodash.cloneDeep(appConfig);\n        }\n        this.dataUpdate = decryptData(this.dataUpdate);\n        this.dataUpdateProd = lodash.cloneDeep(this.dataUpdate);\n        this.dataUpdate.IS_FINISHED_REMOTE = true;\n    };\n\n    const getConfig = () => {\n        this.dataUpdate.TOKEN = this.TOKEN;\n        return this.dataUpdate;\n    };\n\n    const switchEnv = (isProd) => {\n        if (isProd) {\n            const appConfig = require('appConfig');\n            if (this.dataUpdateProd) {\n                this.dataUpdate = lodash.cloneDeep(this.dataUpdateProd);\n            } else {\n                this.dataUpdate = lodash.cloneDeep(appConfig);\n            }\n            this.dataUpdate = decryptData(this.dataUpdate);\n            this.dataUpdate.IS_FINISHED_REMOTE = true;\n        } else {\n            const appConfigDebug = require('appConfig-debug');\n            this.dataUpdate = lodash.cloneDeep(appConfigDebug);\n            this.dataUpdate = decryptData(this.dataUpdate);\n            this.dataUpdate.IS_FINISHED_REMOTE = true;\n        }\n    };\n\n    const setUpSentry = () => {\n        const {IS_PRODUCTION, IS_SHOW_STATS} = this.dataUpdate;\n        if (typeof Sentry !== 'undefined') {\n            if (IS_PRODUCTION) {\n                Sentry.init({ dsn: 'https://32ab507534bc4befbd5e1b20e223c93d@sentry.io/1780011' });\n            } else {\n                if (IS_SHOW_STATS) {\n                    cc.debug.setDisplayStats(true);\n                }\n                Sentry.init({ dsn: 'https://b034a1c4d32e42af90071e62d2bf3290@sentry.io/2655786' });\n            }\n        }\n    };\n\n    const setToken = (token) => {\n        this.TOKEN = token;\n    };\n\n    return {\n        setToken,\n        setUpSentry,\n        switchEnv,\n        getConfig\n    };\n}\n\nmodule.exports = new loadConfigAsync();\n"]}