{"version":3,"sources":["../../../../../../assets/cc-common/cc-slotbase-v2/component/assets/cc-common/cc-slotbase-v2/component/Bezier3D.js"],"names":["cc","Class","extends","Component","properties","useBezier","startPoint","Vec3","endPoint","curvePoint1","curvePoint2","tweenTime","scaleOffset","FOV","fadeOutEnding","onLoad","setBezier","node","on","tween","bind","isFading","callback","time","stopAllActions","active","opacity","runAction","fadeIn","currentTime","currentPos","p0","transformPosition2D","running","update","dt","GetPointAtTime","fadeOut","scale","z","x","y","v0","v1","v2","v3","p1","p2","p3","timePoint","p","u","tt","uu","uuu","ttt"],"mappings":"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","file":"Bezier3D.js","sourceRoot":"../../../../../../assets/cc-common/cc-slotbase-v2/component","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        useBezier: true,\n        startPoint: cc.Vec3,\n        endPoint: cc.Vec3,\n        curvePoint1: cc.Vec3,\n        curvePoint2: cc.Vec3,\n        tweenTime: 1,\n        scaleOffset: 1,\n        FOV: 100,\n        fadeOutEnding: true,\n    },\n\n    onLoad()\n    {\n        this.setBezier(this.startPoint, this.curvePoint1, this.curvePoint2, this.endPoint);\n        this.node.on(\"START_TWEEN\", this.tween.bind(this));\n        this.isFading = false;\n    },\n\n    tween(callback, time=1)\n    {\n        this.node.stopAllActions();\n        this.isFading = false;\n        this.tweenTime = time;\n        this.node.active = true;\n        this.node.opacity = 0;\n        this.node.runAction(cc.fadeIn(0.5));\n        this.currentTime = 0;\n        this.currentPos = this.p0;\n        this.transformPosition2D();\n        this.callback = callback;\n        this.running = true;\n    },\n\n    update (dt) {\n        if (this.running)\n        {\n            this.currentTime += dt/2;\n\n            if (this.currentTime < this.tweenTime)\n            {\n                this.currentPos = this.GetPointAtTime(this.currentTime/this.tweenTime);\n                this.transformPosition2D();\n                if (this.currentTime >= this.tweenTime * 0.8 && !this.isFading)\n                {\n                    this.isFading = true;\n                    this.node.runAction(cc.fadeOut(this.tweenTime * 0.2));\n                }\n            }\n            else\n            {\n                this.currentTime = this.tweenTime;\n                this.transformPosition2D();\n                this.running = false;\n                this.callback && this.callback();\n                this.node.runAction(cc.fadeOut(0.3));\n            }\n        }\n    },\n\n    transformPosition2D()\n    {\n        this.node.scale = this.FOV/(this.FOV + this.currentPos.z);\n        this.node.x = this.currentPos.x * this.node.scale;\n        this.node.y = this.currentPos.y * this.node.scale;\n        this.node.scale *= this.scaleOffset;\n    },\n\n    setBezier(v0, v1, v2,v3)\n    {\n        this.p0 = v0;\n        this.p1 = v1;\n        this.p2 = v2;\n        this.p3 = v3;\t\n    },\n\n    GetPointAtTime(timePoint)\n    {\n        let p = cc.v3(0,0,0);\n        if (this.useBezier)\n        {\n            let u = 1 - timePoint;\n            let tt = timePoint * timePoint;\n            let uu = u * u;\n            let uuu = uu * u;\n            let ttt = tt * timePoint;\n            \n            p = cc.v3(uuu * this.p0.x, uuu * this.p0.y, uuu * this.p0.z); //first term\n            p.x += 3 * uu * timePoint * this.p1.x; //second term\n            p.x += 3 * u * tt * this.p2.x; //third term\n            p.x += ttt * this.p3.x; //fourth term\n            \n            p.y += 3 * uu * timePoint * this.p1.y; //second term\n            p.y += 3 * u * tt * this.p2.y; //third term\n            p.y += ttt * this.p3.y; //fourth term\n            \n            p.z += 3 * uu * timePoint * this.p1.z; //second term\n            p.z += 3 * u * tt * this.p2.z; //third term\n            p.z += ttt * this.p3.z; //fourth term*/\n        }\n        else\n        {\n            p = cc.v3(this.p0.x, this.p0.y, this.p0.z);\n            p.x = this.p0.x + (this.p3.x - this.p0.x) * timePoint;\n            p.y = this.p0.y + (this.p3.y - this.p0.y) * timePoint;\n            p.z = this.p0.z + (this.p3.z - this.p0.z) * timePoint;\n        }\n        return p;\n    }\n});\n"]}