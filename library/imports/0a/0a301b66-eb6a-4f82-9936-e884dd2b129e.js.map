{"version":3,"sources":["../../../../../../../../assets/cc-common/cc-share-v1/shader/shader-metaGear/Utils/assets/cc-common/cc-share-v1/shader/shader-metaGear/Utils/DissolveBlurControl.js"],"names":["cc","Class","extends","Component","properties","normalTransitionDuration","fastTransitionDuration","maxStrength","resolutionPropName","thresholdPropName","strengthPropName","fadePropName","lerpOnStart","isLoop","customMaterial","type","Material","default","onLoad","_sprite","node","getComponent","Sprite","_mainMaterial","getMaterial","_transitionFactor","_isLerping","start","iResolution","Vec3","width","height","setProperty","lerpTransition","_timer","transitionDuration","onEnable","_blurFactor","fadeType","startFadeIn","isTurbo","startFadeOut","update","dt","cubicEasingIn","blurFactor","emit","isLerping","setMaterial","time","beginVal","changeVal","duration"],"mappings":"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","file":"DissolveBlurControl.js","sourceRoot":"../../../../../../../../assets/cc-common/cc-share-v1/shader/shader-metaGear/Utils","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        normalTransitionDuration: 1,\n        fastTransitionDuration: 0.3,\n        maxStrength: 1,\n        resolutionPropName:\"iResolution\",\n        thresholdPropName: \"threshold\",\n        strengthPropName: \"strength\",\n        fadePropName: \"fadeType\",\n        lerpOnStart: true,\n        isLoop: false,\n        customMaterial: {\n            type: cc.Material,\n            default: null,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this._sprite = this.node.getComponent(cc.Sprite);\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._transitionFactor = 0;\n        this._isLerping = false;\n    },\n\n    start () {\n        if(this._mainMaterial && this._sprite){\n            var iResolution = new cc.Vec3(this._sprite.node.width, this._sprite.node.height, 0);\n            this._mainMaterial.setProperty(this.resolutionPropName, iResolution);\n        }\n        if(this.lerpOnStart){\n            this.lerpTransition(true, 0);\n        }\n        this._timer = 0;\n        this.transitionDuration = this.normalTransitionDuration;\n    },\n    onEnable(){\n        this._transitionFactor = 0;\n        this._blurFactor = 0;\n        this.fadeType = 0;\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._mainMaterial.setProperty(this.thresholdPropName, this.fadeType>0?this._transitionFactor: 1 - this._transitionFactor);\n        this._mainMaterial.setProperty(this.strengthPropName, this._blurFactor);\n    },\n\n    startFadeIn(isTurbo = false){\n        this.transitionDuration = isTurbo? this.fastTransitionDuration : this.normalTransitionDuration;\n        this.lerpTransition(true, 1);\n    },\n\n    startFadeOut(isTurbo = false){\n        this.transitionDuration = isTurbo? this.fastTransitionDuration : this.normalTransitionDuration;\n        this.lerpTransition(true, 0);\n    },\n\n    update (dt) {\n        if(this._isLerping){\n            this._timer += dt;\n\n            // this._transitionFactor+= dt*(1/this.transitionDuration);\n            this._transitionFactor = this.cubicEasingIn(this._timer, 0, 1, this.transitionDuration);\n            let blurFactor = this.cubicEasingIn(this._timer, 0, this.maxStrength, this.transitionDuration);\n            if(this.fadeType>0){\n                this._blurFactor = this.maxStrength - blurFactor;\n            }else{\n                this._blurFactor = blurFactor;\n            }\n            if(this._timer > this.transitionDuration){\n                if(this.isLoop){\n                    this._transitionFactor = 0;\n                    this._blurFactor = 0;\n                }else{\n                    this._isLerping = false;\n                    this.node.emit(\"DISSOLVE_BLUR_COMPLETE\");\n                }\n                this._timer = 0;\n            }\n            this._mainMaterial = this._sprite.getMaterial(0);\n            this._mainMaterial.setProperty(this.thresholdPropName, this.fadeType>0?this._transitionFactor: 1 - this._transitionFactor);\n            this._mainMaterial.setProperty(this.strengthPropName, this._blurFactor);\n        }\n    },\n\n    lerpTransition(isLerping, fadeType){\n        if(this.isLerping){\n            this._sprite.setMaterial(0, this.customMaterial);\n        }\n        this.fadeType = fadeType;\n        this._isLerping = isLerping;\n        this._transitionFactor = 0;\n        this._blurFactor = this.fadeType>0? this.maxStrength : 0;\n        this._timer = 0;\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._mainMaterial.setProperty(this.thresholdPropName, this.fadeType>0?this._transitionFactor: 1 - this._transitionFactor);\n        this._mainMaterial.setProperty(this.strengthPropName, this._blurFactor);\n        this._mainMaterial.setProperty(this.fadePropName, fadeType);\n    },\n\n    cubicEasingIn(time, beginVal, changeVal, duration){\n        time /=duration;\n        return changeVal*time*time*time + beginVal;\n    },\n});\n"]}