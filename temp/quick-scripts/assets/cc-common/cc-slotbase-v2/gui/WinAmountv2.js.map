{"version":3,"sources":["WinAmountv2.js"],"names":["require","formatMoney","lodash","cc","Class","extends","properties","labelWinAmount","Label","_currentValue","currentValue","get","set","value","_updateLabelWinAmount","visible","onLoad","_super","node","on","fastUpdateWinAmount","clearWinAmount","fadeOutNumber","getCurrentWinValue","bind","gameDirector","mainDirector","director","_winValue","updateWinAmount","callback","time","isLastest","gSlotDataStore","playSession","winAmount","log","current","endValue","fastUpdateValue","_callBackOnComplete","_tweenWinAmount","error","_resetLabel","_tweenValue","stop","_updateWallet","isUpdateWinAmount","tween","to","easing","call","start","string","wallet","gameStateManager","getCurrentWallet","isNumber","isNaN","slotBetDataStore","updateWallet","trialMode","updateTrialWallet","isFading","stopAllActions","runAction","sequence","fadeOut","callFunc","opacity","onDestroy"],"mappings":"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","file":"WinAmountv2.js","sourceRoot":"../../../../../../assets/cc-common/cc-slotbase-v2/gui","sourcesContent":["const { formatMoney } = require(\"utils\");\nconst lodash = require('lodash');\ncc.Class({\n    extends: require(\"WinAmount\"),\n\n    properties: {\n        labelWinAmount: cc.Label,\n        _currentValue: 0,\n        currentValue: {\n            get(){\n                return this._currentValue;\n            },\n            set(value){\n                if(this._currentValue !== value){\n                    this._currentValue = value;\n                    this._updateLabelWinAmount();\n                }\n            },\n            visible: false\n        }\n    },\n\n    onLoad() {\n        this._super();\n        this.node.on(\"FAST_UPDATE_WIN_AMOUNT\", this.fastUpdateWinAmount, this);\n        this.node.on(\"RESET_NUMBER\", this.clearWinAmount, this);\n        this.node.on(\"FADE_OUT_NUMBER\", this.fadeOutNumber, this);\n        this.node.getCurrentWinValue = this.getCurrentWinValue.bind(this);\n        this.gameDirector = this.node.mainDirector ? this.node.mainDirector.director : null;\n    },\n    \n    getCurrentWinValue(){\n        return this._winValue;\n    },\n\n    updateWinAmount({value, time, isLastest}, callback) {\n        if(isLastest && this.node.gSlotDataStore) {\n            value = this.node.gSlotDataStore.playSession.winAmount;\n        }\n        if(value < this._currentValue || value < this._winValue) {\n            cc.log(\"Logic fail somewhere, script clear winamount have not ran yet\", {current: this._currentValue, endValue:this._winValue, fastUpdateValue:value});\n            this.clearWinAmount();\n        }\n        this._callBackOnComplete = callback;\n        this._winValue = value;\n        time = this._currentValue  === value ? 0 : time;\n        this._tweenWinAmount(value,time);\n        cc.log(\"run updateWinAmount\", {value, time, isLastest});\n    },\n\n    fastUpdateWinAmount({value, time}){\n        if(!value) value = this._winValue;\n        if(value < this._currentValue || value < this._winValue) {\n            cc.error(\"Logic fail: Could not speed up to the smaller value\", {current: this._currentValue, endValue:this._winValue, fastUpdateValue:value});\n            return;\n        }\n\n        this._tweenWinAmount(value,time);\n        cc.log(\"run fastUpdateWinAmount\", {value, time});\n    },\n\n    _tweenWinAmount(value, time){\n        this._resetLabel();\n        if(time === 0) {\n            this._tweenValue && this._tweenValue.stop();\n            this._tweenValue = null;\n            this.currentValue = value;\n            this._callBackOnComplete  && this._callBackOnComplete();\n            this._callBackOnComplete = null;\n            this._updateWallet();\n            cc.log(\"show win Amount instantly\", {value, time});\n            return;\n        }\n\n        this._tweenValue && this._tweenValue.stop();\n        if(this.node.gSlotDataStore){\n            this.node.gSlotDataStore.isUpdateWinAmount = true;\n        }\n        this._tweenValue = cc.tween(this)\n            .to(time/1000, {currentValue: value}, {easing: 'sineInOut'})\n            .call(()=>{\n                this._updateWallet();\n                this._callBackOnComplete && this._callBackOnComplete();\n                this._callBackOnComplete = null;\n                this._tweenValue = null;\n            });\n        this._tweenValue.start();\n        cc.log(\"_tweenWinAmount\", {value, time});\n    },\n\n    clearWinAmount(){\n        this._resetLabel();\n        this.currentValue = 0;\n        this._winValue = 0;\n    },\n\n    _updateLabelWinAmount(){\n        this.labelWinAmount.string = this.currentValue > 0 ? formatMoney(this._currentValue) : \"\";\n    },\n\n    _updateWallet(){\n        if(this.node.gSlotDataStore){\n            this.node.gSlotDataStore.isUpdateWinAmount = false;\n        }\n        if(this.gameDirector) {\n            const wallet = this.gameDirector.gameStateManager.getCurrentWallet();\n            if(wallet && lodash.isNumber(wallet) && !lodash.isNaN(wallet)){\n                this.node.gSlotDataStore.slotBetDataStore.updateWallet(wallet);\n            }\n            if(this.gameDirector.trialMode){\n                this.gameDirector.updateTrialWallet();\n            }else{\n                this.gameDirector.updateWallet();\n            }\n        }\n    },\n\n    fadeOutNumber(time = 1) {\n        if (!this.labelWinAmount) return;\n        this.node.isFading = true;\n        if( this._tweenValue){\n            this._tweenValue.stop();\n            this._tweenValue = null;\n            this.currentValue = this._winValue;\n        }\n        if(this._callBackOnComplete){\n            this._callBackOnComplete();\n            this._callBackOnComplete = null;\n        }\n        if(this.node.gSlotDataStore){\n            this.node.gSlotDataStore.isUpdateWinAmount = false;\n        }\n        this.labelWinAmount.node.stopAllActions();\n        this.labelWinAmount.node.runAction(cc.sequence(\n            cc.fadeOut(time),\n            cc.callFunc(() => {\n                this.node.isFading = false;\n                this.clearWinAmount();\n            })\n        ));\n    },\n\n    _resetLabel() {\n        this.labelWinAmount.node.stopAllActions();\n        this.labelWinAmount.node.opacity = 255;\n        this.node.isFading = false;\n    },\n\n    onDestroy() {\n        this._tweenValue && this._tweenValue.stop();\n    }\n});\n"]}