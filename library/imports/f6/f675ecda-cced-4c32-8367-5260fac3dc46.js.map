{"version":3,"sources":["../../../../../../../../assets/cc-common/cc-share-v1/shader/shader-metaGear/Utils/assets/cc-common/cc-share-v1/shader/shader-metaGear/Utils/RadientBlurControl.js"],"names":["cc","Class","extends","Component","properties","normalTransitionDuration","fastTransitionDuration","maxStrength","resolutionPropName","thresholdPropName","strengthPropName","lerpOnStart","isLoop","customMaterial","type","Material","default","onLoad","_sprite","node","getComponent","Sprite","_mainMaterial","getMaterial","_transitionFactor","_isLerping","_blurAtStart","start","iResolution","Vec3","width","height","setProperty","lerpTransition","_timer","transitionDuration","onEnable","_blurFactor","update","dt","cubicEasingIn","blurFactor","emit","isLerping","blurAtStart","isTurbo","setMaterial","time","beginVal","changeVal","duration"],"mappings":"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","file":"RadientBlurControl.js","sourceRoot":"../../../../../../../../assets/cc-common/cc-share-v1/shader/shader-metaGear/Utils","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        normalTransitionDuration: 1,\n        fastTransitionDuration: 0.3,\n        maxStrength: 0.125,\n        resolutionPropName:\"iResolution\",\n        thresholdPropName: \"threshold\",\n        strengthPropName: \"strength\",\n        lerpOnStart: true,\n        isLoop: false,\n        customMaterial: {\n            type: cc.Material,\n            default: null,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this._sprite = this.node.getComponent(cc.Sprite);\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._transitionFactor = 0;\n        this._isLerping = false;\n        this._blurAtStart = true;\n    },\n\n    start () {\n        if(this._mainMaterial && this._sprite){\n            var iResolution = new cc.Vec3(this._sprite.node.width, this._sprite.node.height, 0);\n            this._mainMaterial.setProperty(this.resolutionPropName, iResolution);\n        }\n        if(this.lerpOnStart){\n            this.lerpTransition(true);\n        }\n        this._timer = 0;\n        this.transitionDuration = this.normalTransitionDuration;\n    },\n    onEnable(){\n        this._transitionFactor = 0;\n        this._blurFactor = this._blurAtStart? this.maxStrength: 0;\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._mainMaterial.setProperty(this.thresholdPropName, this._transitionFactor);\n        this._mainMaterial.setProperty(this.strengthPropName, this._blurFactor);\n    },\n\n    update (dt) {\n        if(this._isLerping){\n            this._timer += dt;\n\n            // this._transitionFactor+= dt*(1/this.transitionDuration);\n            this._transitionFactor = this.cubicEasingIn(this._timer, 0, 1, this.transitionDuration);\n            let blurFactor = this.cubicEasingIn(this._timer, 0, this.maxStrength, this.transitionDuration);\n            \n            this._blurFactor = this._blurAtStart? (this.maxStrength - blurFactor): blurFactor;\n            \n            if(this._transitionFactor>1){\n                if(this.isLoop){\n                    this._transitionFactor = 0;\n                }else{\n                    this._isLerping = false;\n                    this.node.emit(\"RADIENT_BLUR_COMPLETE\");\n                }\n                this._timer = 0;\n            }\n            this._mainMaterial = this._sprite.getMaterial(0);\n            this._mainMaterial.setProperty(this.thresholdPropName, this._transitionFactor);\n            this._mainMaterial.setProperty(this.strengthPropName, this._blurFactor);\n        }\n    },\n\n    lerpTransition(isLerping, blurAtStart, isTurbo = false){\n        this.transitionDuration = isTurbo? this.fastTransitionDuration : this.normalTransitionDuration;\n        if(this.isLerping){\n            this._sprite.setMaterial(0, this.customMaterial);\n        }\n        this._isLerping = isLerping;\n        this._transitionFactor = 0;\n        this._timer = 0;\n        this._blurAtStart = blurAtStart;\n        this._blurFactor = this._blurAtStart? this.maxStrength : 0;\n        this._mainMaterial = this._sprite.getMaterial(0);\n        this._mainMaterial.setProperty(this.thresholdPropName, this._transitionFactor);\n        this._mainMaterial.setProperty(this.strengthPropName, this._blurFactor);\n    },\n\n    cubicEasingIn(time, beginVal, changeVal, duration){\n        time /=duration;\n        return changeVal*time*time*time + beginVal;\n    },\n});\n"]}