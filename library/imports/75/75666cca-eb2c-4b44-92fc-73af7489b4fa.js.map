{"version":3,"sources":["../../../../../../../assets/cc-common/cc-slotbase-v2/slotGame/table/assets/cc-common/cc-slotbase-v2/slotGame/table/SlotReel.js"],"names":["lodash","require","cc","Class","extends","Component","properties","reel","Node","onLoad","node","mainComponent","MAX_STEP","Number","MAX_SAFE_INTEGER","init","showNumber","gameConfig","col","symbolPrefab","CONFIG","symbolList","SYMBOL_NAME_LIST","showSymbols","bufferSpace","totalNumber","hasBigWild","i","symbol","instantiate","name","parent","x","SYMBOL_WIDTH","y","SYMBOL_HEIGHT","changeToSymbol","getRandomSymbolName","length","unshift","width","height","mode","curentConfig","STATS","index","reset","Math","floor","random","getRandomSymbol","listSymbol","cloneDeep","SUB_SYMBOL","filter","includes","stopReelRoll","stopAllActions","children","forEach","child","stop","step","showResult","matrix","setMode","startSpinningWithDelay","delay","isFastToResult","currentSpeed","TIME","action3","sequence","delayTime","REEL_DELAY_START","moveBy","callFunc","runSpinning","runAction","runSpinningAnimation","delayIndex","TABLE_FORMAT","isNearWin","runStopAnimation","REEL_EASING_DISTANCE","REEL_EASING_TIME","stopSpinningWithDelay","callback","callbackStopReel","reelDelayStop","REEL_DELAY_STOP","director","getScheduler","schedule","setStepToStop","getRandomSymbolNameWithException","push","adjustReelSpeed","speed","extendTimeToStop","extra","NEAR_WIN_DELAY_TIME","NEAR_WIN_DELAY_TIME_LAST_REEL","unschedule","STEP_STOP","fastStopSpinning","indexNearWin","time","timer","IS_CUSTOM_EASING","onReelStop","action0","circularSymbols","lastSymbol","changeToBlurSymbol","symbolValue","transformSymbol","getShowSymbol","exceptionSymbol","getRandomSymbolNameWithExceptions","exceptionSymbols","remainSymbols","defaultSymbol","res","j","exception"],"mappings":"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","file":"SlotReel.js","sourceRoot":"../../../../../../../assets/cc-common/cc-slotbase-v2/slotGame/table","sourcesContent":["const lodash = require('lodash');\n\ncc.Class({\n  extends: cc.Component,\n  properties: {\n    reel: cc.Node,\n  },\n  onLoad() {\n    this.node.mainComponent = this;\n    this.MAX_STEP = Number.MAX_SAFE_INTEGER;\n  },\n  init(showNumber, gameConfig, col, symbolPrefab) {\n    this.col = col;\n    this.CONFIG = gameConfig;\n    this.symbolList = this.CONFIG.SYMBOL_NAME_LIST[col];\n    this.symbolPrefab = symbolPrefab;\n    this.showNumber = showNumber;\n    this.showSymbols = [];\n    this.bufferSpace = 1;\n    this.totalNumber = this.showNumber + 2;\n    if (this.node.hasBigWild) {\n      //If there is big wild, there must be enough space for them to roll\n      this.bufferSpace = this.showNumber;\n      this.totalNumber += this.showNumber - 1;\n    }\n\n    for (let i = 0; i < this.totalNumber; ++i) {\n      const symbol = cc.instantiate(this.symbolPrefab);\n      symbol.name = 'Symbol_' + i;\n      symbol.parent = this.reel;\n      symbol.x = this.CONFIG.SYMBOL_WIDTH / 2;\n      symbol.y = i * this.CONFIG.SYMBOL_HEIGHT + this.CONFIG.SYMBOL_HEIGHT / 2;\n      symbol.changeToSymbol(this.getRandomSymbolName());\n      if (i >= this.bufferSpace && this.showSymbols.length < this.showNumber) {\n        this.showSymbols.unshift(symbol);\n      }\n    }\n\n    this.node.width = this.CONFIG.SYMBOL_WIDTH;\n    this.node.height = this.CONFIG.SYMBOL_HEIGHT * (this.showNumber + 2);\n\n    this.mode = 'FAST';\n    this.curentConfig = this.CONFIG.STATS[this.mode];\n    this.index = 0;\n    this.reset();\n\n    this.node.y = -1 * this.CONFIG.SYMBOL_HEIGHT * this.bufferSpace;\n  },\n  getRandomSymbolName() {\n    return this.symbolList[Math.floor(Math.random() * this.symbolList.length)];\n  },\n\n  getRandomSymbol() {\n    let listSymbol = lodash.cloneDeep(this.symbolList);\n    if (typeof this.CONFIG.SUB_SYMBOL !== 'undefined') {\n      listSymbol = listSymbol.filter(i => !this.CONFIG.SUB_SYMBOL.includes(i));\n    }\n    return listSymbol[Math.floor(Math.random() * listSymbol.length)];\n  },\n  stopReelRoll() {\n    this.reel.stopAllActions();\n  },\n  reset() {\n    this.reel.children.forEach(child => {\n      child.y += this.reel.y;\n    });\n    this.reel.y = 0;\n    this.index = this.index % this.totalNumber;\n    this.stop = 0;\n    this.step = this.MAX_STEP;\n    this.showResult = 0;\n    this.matrix = [];\n  },\n  setMode(mode) {\n    this.mode = mode;\n  },\n  startSpinningWithDelay(delay) {\n    this.step = this.MAX_STEP - 1;\n    this.isFastToResult = false;\n    this.curentConfig = this.CONFIG.STATS[this.mode];\n    this.currentSpeed = this.curentConfig.TIME;\n    const action3 = cc.sequence(\n      cc.delayTime(delay * this.curentConfig.REEL_DELAY_START),\n      cc.moveBy(this.currentSpeed, 0, 25),\n      cc.moveBy(this.currentSpeed, 0, -25),\n      cc.callFunc(() => {\n        this.runSpinning();\n      })\n    );\n    this.reel.runAction(action3);\n  },\n  runSpinning() {\n    this.runSpinningAnimation(() => {\n      if (this.step > this.showNumber) {\n        this.runSpinning();\n        this.step--;\n        if (this.step < this.totalNumber) {\n          this.showResult = 1;\n        }\n      } else if (this.step == this.showNumber) {\n        // check last reel, near win and not fast to result\n        if (\n          this.delayIndex === this.CONFIG.TABLE_FORMAT.length - 1 &&\n          this.isNearWin &&\n          !this.isFastToResult\n        ) {\n          this.runStopAnimation(50, 0.2);\n        } else {\n          this.runStopAnimation(\n            this.curentConfig.REEL_EASING_DISTANCE,\n            this.curentConfig.REEL_EASING_TIME\n          );\n        }\n      }\n    });\n  },\n\n  stopSpinningWithDelay(delay, matrix = [], callback) {\n    this.curentConfig = this.CONFIG.STATS[this.mode];\n    this.delayIndex = delay;\n    this.showSymbols = [];\n    this.matrix = matrix;\n    this.callbackStopReel = callback ? callback : () => {};\n\n    let reelDelayStop = delay * this.curentConfig.REEL_DELAY_STOP;\n    this.isNearWin = false;\n\n    this.delay = delay;\n    cc.director\n      .getScheduler()\n      .schedule(this.setStepToStop, this, 0, 0, reelDelayStop, false);\n\n    //Add 2 more symbol to apply near miss\n    this.matrix.unshift(this.getRandomSymbolNameWithException('A'));\n    this.matrix.push(this.getRandomSymbolNameWithException('A'));\n    // this.matrix.unshift(\"2\");\n    // this.matrix.push(\"3\");\n  },\n\n  adjustReelSpeed(speed) {\n    this.currentSpeed = speed;\n  },\n  extendTimeToStop(extra = 0) {\n    this.isNearWin = true;\n    let reelDelayStop =\n      (this.curentConfig.REEL_DELAY_STOP +\n        this.curentConfig.NEAR_WIN_DELAY_TIME) *\n      (this.delay + extra);\n    if (this.delay === this.CONFIG.TABLE_FORMAT.length - 1) {\n      reelDelayStop =\n        reelDelayStop + this.curentConfig.NEAR_WIN_DELAY_TIME_LAST_REEL;\n    }\n    cc.director.getScheduler().unschedule(this.setStepToStop, this);\n    cc.director\n      .getScheduler()\n      .schedule(this.setStepToStop, this, 0, 0, reelDelayStop, false);\n  },\n  setStepToStop() {\n    this.step = this.curentConfig.STEP_STOP * 2 - this.totalNumber;\n  },\n  fastStopSpinning() {\n    // check step is reset will not do anything.\n    if (this.step === this.MAX_STEP) return;\n    this.isFastToResult = true;\n    cc.director.getScheduler().unschedule(this.setStepToStop, this);\n    this.showResult = 1;\n    this.currentSpeed = this.currentSpeed / 3;\n  },\n  runStopAnimation(indexNearWin, time) {\n    const timer = time ? time : this.curentConfig.TIME;\n    indexNearWin = this.CONFIG.IS_CUSTOM_EASING ? -indexNearWin : indexNearWin;\n    this.onReelStop();\n    const action3 = cc.sequence(\n      cc.callFunc(() => {\n        this.callbackStopReel();\n      }),\n      cc.moveBy(timer, 0, -indexNearWin),\n      cc.moveBy(timer, 0, indexNearWin),\n      cc.callFunc(() => {\n        this.reset();\n        /// stop schedule when reel is stopped\n        cc.director.getScheduler().unschedule(this.setStepToStop, this);\n        this.currentSpeed = this.curentConfig.TIME;\n      })\n    );\n    this.reel.runAction(action3);\n  },\n  onReelStop() {\n    this.reel.children.forEach(child => {\n      child.changeToSymbol(child.symbol);\n    });\n  },\n  runSpinningAnimation(callback) {\n    let time = this.currentSpeed + (this.currentSpeed * this.stop) / 4;\n    const action0 = cc.sequence(\n      cc.moveBy(time, 0, -1 * this.CONFIG.SYMBOL_HEIGHT),\n      cc.callFunc(this.circularSymbols, this),\n      cc.callFunc(callback)\n    );\n    this.reel.runAction(action0);\n  },\n  circularSymbols() {\n    const lastSymbol = this.reel.children[this.index % this.totalNumber];\n    if (!this.showResult) {\n      lastSymbol.changeToBlurSymbol(this.getRandomSymbolName());\n    } else if (this.stop < this.showNumber + 2) {\n      // buffer = 2\n      let symbolValue = this.matrix[this.stop];\n      if (\n        this.node.transformSymbol &&\n        typeof this.node.transformSymbol == 'function'\n      ) {\n        //Apply special wild in specific col, or near miss or big wild,.. etcs\n        symbolValue = this.node.transformSymbol(\n          symbolValue,\n          this.col,\n          this.stop\n        );\n      }\n      /**@todo check this condition if buffer !== 2 */\n      if (this.stop === 0) {\n        lastSymbol.changeToBlurSymbol(symbolValue);\n      } else {\n        lastSymbol.changeToSymbol(symbolValue);\n      }\n      this.showSymbols.unshift(lastSymbol);\n      this.step =\n        this.totalNumber - this.stop + (this.showNumber - this.bufferSpace);\n      this.stop++;\n    }\n    lastSymbol.y = lastSymbol.y + this.CONFIG.SYMBOL_HEIGHT * this.totalNumber;\n    this.index++;\n  },\n\n  getShowSymbol(index) {\n    return this.showSymbols[index];\n  },\n\n  getRandomSymbolNameWithException(exceptionSymbol) {\n    let symbol =\n      this.symbolList[Math.floor(Math.random() * this.symbolList.length)];\n    if (symbol == exceptionSymbol) {\n      symbol = this.getRandomSymbolNameWithException(exceptionSymbol);\n    }\n\n    return symbol;\n  },\n\n  getRandomSymbolNameWithExceptions(exceptionSymbols) {\n    const remainSymbols = [];\n    const defaultSymbol = '3';\n    if (!this.symbolList) return defaultSymbol; //case haven't init;\n    for (let i = 0; i < this.symbolList.length; i++) {\n      const symbol = this.symbolList[i];\n      let res = true;\n      for (let j = 0; j < exceptionSymbols.length; j++) {\n        const exception = exceptionSymbols[j];\n        if (symbol == exception) {\n          res = false;\n          break;\n        }\n      }\n      if (res) {\n        remainSymbols.push(symbol);\n      }\n    }\n    let symbol =\n      remainSymbols[Math.floor(Math.random() * remainSymbols.length)];\n    return symbol;\n  },\n});\n"]}