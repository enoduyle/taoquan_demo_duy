{"version":3,"sources":["../../../../../../../../assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect/assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect/JackpotWinv2.js"],"names":["require","reverseEasing","formatMoney","cc","Class","extends","properties","winAmount","Node","title","winInfo","coinsEffect","delayShowTime","hideTime","animDuration","extendFinishDelayTime","onLoad","_super","label","getComponentInChildren","Label","enter","playSoundStart","scaleTime","runAction","repeatForever","sequence","scaleTo","initValue","startParticle","startUpdateWinAmount","playSoundEnd","scale","currentValue","currentTitle","string","isUpdating","speedUp","bindQuickShow","skippable","node","delayTime","callFunc","emit","speedUpEasing","t","slowDownEasing","halfAmount","content","gSlotDataStore","isAutoSpin","currentTween","tween","to","easing","delay","call","finish","start","update","onClick","stopAllActions","stop","stopParticle","exit","onDisable"],"mappings":"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","file":"JackpotWinv2.js","sourceRoot":"../../../../../../../../assets/cc-common/cc-slotbase-v2/g9000/cutscene/winEffect","sourcesContent":["const {reverseEasing} = require('globalAnimationLibrary');\nconst {formatMoney} = require('utils');\n\ncc.Class({\n    extends: require('CutsceneMode'),\n\n    properties: {\n        winAmount: cc.Node,\n        title: cc.Node,\n        winInfo: cc.Node,\n        coinsEffect: cc.Node,\n        delayShowTime: 2,\n        hideTime: 0.5,\n        animDuration: 10,\n        extendFinishDelayTime: 15,\n    },\n\n    onLoad() {\n        this._super();\n        this.label = this.winAmount.getComponentInChildren(cc.Label);\n    },\n\n    enter() {\n        this.playSoundStart();\n        const scaleTime = 0.2;\n        this.winAmount.runAction(cc.repeatForever(cc.sequence(\n            cc.scaleTo(scaleTime, 1.2),\n            cc.scaleTo(scaleTime, 1),\n        )));\n        if (this.title) {\n            this.title.runAction(cc.repeatForever(cc.sequence(\n                cc.scaleTo(0.5, 1.2),\n                cc.scaleTo(0.5, 1),\n            )));\n        }\n        this.initValue();\n        this.startParticle();\n        this.startUpdateWinAmount();\n    },\n\n    playSoundStart() {\n\n    },\n\n    playSoundEnd() {\n\n    },\n\n    initValue() {\n        this.winInfo.scale = 1;\n        this.currentValue = 0;\n        this.currentTitle = 0;\n        this.label.string = '';\n        this.isUpdating = true;\n        this.speedUp = false;\n        this.bindQuickShow();\n    },\n\n    bindQuickShow() {\n        this.skippable = false;\n        this.node.runAction(cc.sequence(\n            cc.delayTime(this.hideTime),\n            cc.callFunc(() => {\n                this.skippable = true;\n            }),\n        ));\n    },\n\n    startParticle() {\n        this.coinsEffect.emit('START_PARTICLE');\n        this.coinsEffect.emit('DROP_MONEY');\n    },\n\n    startUpdateWinAmount() {\n        const speedUpEasing = t => t*t; // constant accelerated\n        const slowDownEasing = reverseEasing(t => t*t);\n        const halfAmount = 0.5 * this.content.winAmount;\n        const extendFinishDelayTime = this.node.gSlotDataStore && this.node.gSlotDataStore.isAutoSpin ? this.extendFinishDelayTime : 0;\n        this.currentTween = cc.tween(this);\n        this.currentTween\n            .to(0.5*this.animDuration, {currentValue: halfAmount}, {easing: speedUpEasing})\n            .to(0.5*this.animDuration, {currentValue: this.content.winAmount}, {easing: slowDownEasing})\n            .delay(extendFinishDelayTime)\n            .call(() => {\n                if (this.node.gSlotDataStore && this.node.gSlotDataStore.isAutoSpin) {\n                    this.playSoundEnd();\n                    this.skippable = false;\n                    this.currentTween = null;\n                    this.finish();\n                }\n            });\n        this.currentTween.start();\n    },\n\n    update() {\n        if (!this.isUpdating) return;\n        this.label.string = formatMoney(this.currentValue);\n    },\n\n    onClick() {\n        if (!this.isUpdating || this.speedUp) return;\n        if (!this.skippable) return;\n\n        this.speedUp = true;\n        this.winAmount.stopAllActions();\n        const scaleTime = 0.13;\n        this.winAmount.runAction(cc.repeatForever(cc.sequence(\n            cc.scaleTo(scaleTime, 1.2),\n            cc.scaleTo(scaleTime, 1),\n        )));\n\n        this.playSoundEnd();\n\n        if (this.currentTween) {\n            this.currentTween.stop();\n            this.currentTween = null;\n        }\n        cc.tween(this)\n            .to(1, {currentValue: this.content.winAmount})\n            .call(() => {\n                this.finish();\n            })\n            .start();\n    },\n\n    stopParticle() {\n        this.coinsEffect.emit('STOP_PARTICLE');\n    },\n\n    finish() {\n        this.isUpdating = false;\n        this.label.string = formatMoney(this.content.winAmount);\n        this.winAmount.stopAllActions();\n        this.stopParticle();\n        this.winInfo.runAction(cc.sequence(\n            cc.delayTime(this.delayShowTime),\n            cc.scaleTo(this.hideTime, 0),\n            cc.callFunc(()=>{\n                //this.node.soundPlayer.playBackgroundMusic();\n                this.label.string = '';\n                this.exit(); // exit cutscene\n            })\n        ));\n    },\n\n    onDisable() {\n        if (this.currentTween) {\n            this.currentTween.stop();\n            this.currentTween = null;\n        }\n    }\n});\n"]}