{"version":3,"sources":["TotalFreeGameWiningCutscene.js"],"names":["CutsceneMode","require","formatMoney","cc","Class","extends","properties","overlayNode","Node","contentNode","particleNode","winAmountLabel","Label","freeSpinTimesLabel","appearingDuration","winText","onLoad","_super","_isShow","start","localizeText","node","config","MESSAGE_DIALOG","YOU_WON","string","show","content","totalFreeWinAmount","totalFreeSpinTime","convertedAmount","opacity","playShowingAnimation","enter","bindButtonClicked","_appearingAction","sequence","delayTime","callFunc","onExitButtonClicked","runAction","playClosingAnimation","resetNode","exit","log","_showContent","fadeTo","scale","tweenShow","tween","delay","call","soundPlayer","playSoundSumFreeStart","_playParticle","to","easing","_hideContent","stopSoundSumFreeStart","playSoundSumFreeEnd","tweenHide","fadeOut","_isPlayParticle","active","getComponent","ParticleSystem","resetSystem","_stopParticle","stopSystem","callback","bind","stopAction","stop"],"mappings":";;;;;;AAAA,IAAMA,eAAeC,QAAQ,cAAR,CAArB;;eACsBA,QAAQ,OAAR;IAAfC,uBAAAA;;AACPC,GAAGC,KAAH,CAAS;AACLC,aAASL,YADJ;;AAGLM,gBAAY;AACRC,qBAAaJ,GAAGK,IADR;AAERC,qBAAaN,GAAGK,IAFR;AAGRE,sBAAcP,GAAGK,IAHT;AAIRG,wBAAgBR,GAAGS,KAJX;AAKRC,4BAAoBV,GAAGS,KALf;AAMRE,2BAAmB,CANX;AAORC,iBAASZ,GAAGS;AAPJ,KAHP;;AAaLI,UAbK,oBAaI;AACL,aAAKC,MAAL;AACA,aAAKC,OAAL,GAAe,KAAf;AACH,KAhBI;AAkBLC,SAlBK,mBAkBG;AACJ,aAAKC,YAAL;AACH,KApBI;AAsBLA,gBAtBK,0BAsBU;AACX,YAAI,KAAKL,OAAL,IAAgB,KAAKM,IAAL,CAAUC,MAAV,CAAiBC,cAAjB,CAAgCC,OAApD,EAA6D;AACzD,iBAAKT,OAAL,CAAaU,MAAb,GAAsB,KAAKJ,IAAL,CAAUC,MAAV,CAAiBC,cAAjB,CAAgCC,OAAtD;AACH;AACJ,KA1BI;AA4BLE,QA5BK,kBA4BE;AAAA,uBAC6C,KAAKC,OADlD;AAAA,YACIC,kBADJ,YACIA,kBADJ;AAAA,YACwBC,iBADxB,YACwBA,iBADxB;;;AAGH,YAAID,kBAAJ,EAAwB;AACpB,gBAAME,kBAAkB5B,YAAY0B,kBAAZ,CAAxB;AACA,gBAAIE,eAAJ,EAAqB;AACjB,qBAAKnB,cAAL,CAAoBc,MAApB,GAA6BK,eAA7B;AACH,aAFD,MAEO;AACH,qBAAKnB,cAAL,CAAoBc,MAApB,GAA6BG,kBAA7B;AACH;AAEJ,SARD,MAQO;AACH,iBAAKjB,cAAL,CAAoBc,MAApB,GAA6B,GAA7B;AACH;;AAED,YAAII,iBAAJ,EAAuB;AACnB,iBAAKhB,kBAAL,CAAwBY,MAAxB,GAAiCI,iBAAjC;AACH;AACD,aAAKZ,MAAL;AACA,aAAKV,WAAL,CAAiBwB,OAAjB,GAA2B,CAA3B;AACA,aAAKC,oBAAL;AACA,aAAKd,OAAL,GAAe,IAAf;AACH,KAlDI;AAqDLe,SArDK,mBAqDG,CAEP,CAvDI;AAyDLC,qBAzDK,+BAyDe;AAAA;;AAChB,aAAKC,gBAAL,GAAwBhC,GAAGiC,QAAH,CACpBjC,GAAGkC,SAAH,CAAa,KAAKvB,iBAAlB,CADoB,EAEpBX,GAAGmC,QAAH,CAAY,YAAM;AACd,kBAAKC,mBAAL;AACH,SAFD,CAFoB,CAAxB;;AAMA,aAAKlB,IAAL,CAAUmB,SAAV,CAAoB,KAAKL,gBAAzB;AACH,KAjEI;AAmELI,uBAnEK,iCAmEiB;AAAA;;AAClB,YAAI,CAAC,KAAKrB,OAAV,EAAmB;AACf;AACH;;AAED,aAAKA,OAAL,GAAe,KAAf;AACA,aAAKuB,oBAAL,CAA0B,YAAM;AAC5B,mBAAKC,SAAL;AACA,mBAAKC,IAAL;AACH,SAHD;AAIH,KA7EI;AA+ELX,wBA/EK,kCA+EkB;AACnB7B,WAAGyC,GAAH;AACA,aAAKC,YAAL;AACH,KAlFI;AAoFLA,gBApFK,0BAoFU;AAAA;;AACX,aAAKtC,WAAL,CAAiBiC,SAAjB,CAA2BrC,GAAG2C,MAAH,CAAU,GAAV,EAAe,GAAf,CAA3B;AACA,aAAKrC,WAAL,CAAiBsC,KAAjB,GAAyB,CAAzB;AACA,aAAKC,SAAL,GAAiB7C,GAAG8C,KAAH,CAAS,KAAKxC,WAAd,EACZyC,KADY,CACN,GADM,EAEZC,IAFY,CAEP,YAAM;AACR,gBAAI,OAAK9B,IAAL,CAAU+B,WAAd,EAA2B;AACvB,uBAAK/B,IAAL,CAAU+B,WAAV,CAAsBC,qBAAtB;AACH;AACD,gBAAI,OAAK1B,OAAL,CAAaC,kBAAb,GAAkC,CAAtC,EAAyC;AACrC,uBAAK0B,aAAL;AACH;AACJ,SATY,EAUZC,EAVY,CAUT,GAVS,EAUJ,EAACR,OAAO,CAAR,EAVI,EAUQ,EAACS,QAAQ,SAAT,EAVR,EAWZL,IAXY,CAWP,YAAM;AACR,mBAAKjB,iBAAL;AACH,SAbY,CAAjB;;AAeA,aAAKc,SAAL,CAAe7B,KAAf;AACH,KAvGI;AAwGLsC,gBAxGK,0BAwGU;AAAA;;AACX,YAAI,KAAKpC,IAAL,CAAU+B,WAAd,EAA2B;AACvB,iBAAK/B,IAAL,CAAU+B,WAAV,CAAsBM,qBAAtB;AACA,iBAAKrC,IAAL,CAAU+B,WAAV,CAAsBO,mBAAtB;AACH;AACD,aAAKC,SAAL,GAAiBzD,GAAG8C,KAAH,CAAS,KAAKxC,WAAd,EACZ8C,EADY,CACT,GADS,EACJ,EAACR,OAAO,CAAR,EADI,EACQ,EAACS,QAAQ,QAAT,EADR,EAEZL,IAFY,CAEP,YAAM;AACR,mBAAK5C,WAAL,CAAiBiC,SAAjB,CAA2BrC,GAAG0D,OAAH,CAAW,GAAX,CAA3B;AACH,SAJY,CAAjB;;AAMA,aAAKD,SAAL,CAAezC,KAAf;AACH,KApHI;AAsHLmC,iBAtHK,2BAsHW;AACZ,aAAKQ,eAAL,GAAuB,IAAvB;AACA,aAAKpD,YAAL,CAAkBqD,MAAlB,GAA2B,IAA3B;AACA,aAAKrD,YAAL,CAAkBsD,YAAlB,CAA+B7D,GAAG8D,cAAlC,EAAkDC,WAAlD;AACH,KA1HI;AA2HLC,iBA3HK,2BA2HW;AACZ,aAAKL,eAAL,GAAuB,KAAvB;AACA,aAAKpD,YAAL,CAAkBsD,YAAlB,CAA+B7D,GAAG8D,cAAlC,EAAkDG,UAAlD;AACH,KA9HI;AAgIL3B,wBAhIK,gCAgIgB4B,QAhIhB,EAgI0B;AAC3BlE,WAAGyC,GAAH;AACA,YAAI,KAAKkB,eAAT,EAA0B;AACtB,iBAAKK,aAAL;AACH;AACD,aAAK9C,IAAL,CAAUmB,SAAV,CAAoBrC,GAAGiC,QAAH,CAChBjC,GAAGkC,SAAH,CAAa,GAAb,CADgB,EAEhBlC,GAAGmC,QAAH,CAAY,KAAKmB,YAAL,CAAkBa,IAAlB,CAAuB,IAAvB,CAAZ,CAFgB,EAGhBnE,GAAGkC,SAAH,CAAa,CAAb,CAHgB,EAIhBlC,GAAGmC,QAAH,CAAY,YAAM;AACd+B,wBAAYA,UAAZ;AACH,SAFD,CAJgB,CAApB;AAQH,KA7II;AA+IL3B,aA/IK,uBA+IO;AACR,aAAKhC,YAAL,CAAkBqD,MAAlB,GAA2B,KAA3B;AACA,YAAI,KAAK5B,gBAAT,EAA2B;AACvB,iBAAKd,IAAL,CAAUkD,UAAV,CAAqB,KAAKpC,gBAA1B;AACA,iBAAKA,gBAAL,GAAwB,IAAxB;AACH;;AAED,YAAI,KAAKa,SAAT,EAAoB;AAChB,iBAAKA,SAAL,CAAewB,IAAf;AACA,iBAAKxB,SAAL,GAAiB,IAAjB;AACH;;AAED,YAAI,KAAKY,SAAT,EAAoB;AAChB,iBAAKA,SAAL,CAAeY,IAAf;AACA,iBAAKZ,SAAL,GAAiB,IAAjB;AACH;AAEJ;AAhKI,CAAT","file":"TotalFreeGameWiningCutscene.js","sourceRoot":"../../../../../../../assets/cc-common/cc-slotbase-v2/g9000/cutscene","sourcesContent":["const CutsceneMode = require('CutsceneMode');\nconst {formatMoney} = require('utils');\ncc.Class({\n    extends: CutsceneMode,\n\n    properties: {\n        overlayNode: cc.Node,\n        contentNode: cc.Node,\n        particleNode: cc.Node,\n        winAmountLabel: cc.Label,\n        freeSpinTimesLabel: cc.Label,\n        appearingDuration: 4,\n        winText: cc.Label\n    },\n\n    onLoad() {\n        this._super();\n        this._isShow = false;\n    },\n\n    start() {\n        this.localizeText();\n    },\n\n    localizeText() {\n        if (this.winText && this.node.config.MESSAGE_DIALOG.YOU_WON) {\n            this.winText.string = this.node.config.MESSAGE_DIALOG.YOU_WON;\n        }\n    },\n\n    show() {\n        const {totalFreeWinAmount, totalFreeSpinTime} = this.content;\n\n        if (totalFreeWinAmount) {\n            const convertedAmount = formatMoney(totalFreeWinAmount);\n            if (convertedAmount) {\n                this.winAmountLabel.string = convertedAmount;\n            } else {\n                this.winAmountLabel.string = totalFreeWinAmount;\n            }\n\n        } else {\n            this.winAmountLabel.string = \"0\";\n        }\n\n        if (totalFreeSpinTime) {\n            this.freeSpinTimesLabel.string = totalFreeSpinTime;\n        }\n        this._super();\n        this.overlayNode.opacity = 0;\n        this.playShowingAnimation();\n        this._isShow = true;\n    },\n\n\n    enter() {\n\n    },\n\n    bindButtonClicked() {\n        this._appearingAction = cc.sequence(\n            cc.delayTime(this.appearingDuration),\n            cc.callFunc(() => {\n                this.onExitButtonClicked();\n            }));\n\n        this.node.runAction(this._appearingAction);\n    },\n\n    onExitButtonClicked() {\n        if (!this._isShow) {\n            return;\n        }\n\n        this._isShow = false;\n        this.playClosingAnimation(() => {\n            this.resetNode();\n            this.exit();\n        });\n    },\n\n    playShowingAnimation() {\n        cc.log(`Play Free Winning Cutscene Showing Animation`);\n        this._showContent();\n    },\n\n    _showContent() {\n        this.overlayNode.runAction(cc.fadeTo(0.3, 220));\n        this.contentNode.scale = 0;\n        this.tweenShow = cc.tween(this.contentNode)\n            .delay(0.5)\n            .call(() => {\n                if (this.node.soundPlayer) {\n                    this.node.soundPlayer.playSoundSumFreeStart();\n                }\n                if (this.content.totalFreeWinAmount > 0) {\n                    this._playParticle();\n                }\n            })\n            .to(0.5, {scale: 1}, {easing: \"backOut\"})\n            .call(() => {\n                this.bindButtonClicked();\n            });\n\n        this.tweenShow.start();\n    },\n    _hideContent() {\n        if (this.node.soundPlayer) {\n            this.node.soundPlayer.stopSoundSumFreeStart();\n            this.node.soundPlayer.playSoundSumFreeEnd();\n        }\n        this.tweenHide = cc.tween(this.contentNode)\n            .to(0.5, {scale: 0}, {easing: \"backIn\"})\n            .call(() => {\n                this.overlayNode.runAction(cc.fadeOut(0.5));\n            });\n\n        this.tweenHide.start();\n    },\n\n    _playParticle() {\n        this._isPlayParticle = true;\n        this.particleNode.active = true;\n        this.particleNode.getComponent(cc.ParticleSystem).resetSystem();\n    },\n    _stopParticle() {\n        this._isPlayParticle = false;\n        this.particleNode.getComponent(cc.ParticleSystem).stopSystem();\n    },\n\n    playClosingAnimation(callback) {\n        cc.log(`Play Free Winning Cutscene Closing Animation`);\n        if (this._isPlayParticle) {\n            this._stopParticle();\n        }\n        this.node.runAction(cc.sequence(\n            cc.delayTime(0.1),\n            cc.callFunc(this._hideContent.bind(this)),\n            cc.delayTime(1),\n            cc.callFunc(() => {\n                callback && callback();\n            }),\n        ));\n    },\n\n    resetNode() {\n        this.particleNode.active = false;\n        if (this._appearingAction) {\n            this.node.stopAction(this._appearingAction);\n            this._appearingAction = null;\n        }\n\n        if (this.tweenShow) {\n            this.tweenShow.stop();\n            this.tweenShow = null;\n        }\n\n        if (this.tweenHide) {\n            this.tweenHide.stop();\n            this.tweenHide = null;\n        }\n\n    }\n\n});\n"]}