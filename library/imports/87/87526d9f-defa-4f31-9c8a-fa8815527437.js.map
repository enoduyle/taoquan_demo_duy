{"version":3,"sources":["../../../../../../assets/cc-taoquan-9983/scripts/table/assets/cc-taoquan-9983/scripts/table/SlotTable9983.js"],"names":["cc","Class","extends","require","properties","fishFlyingController","Node","onLoad","_super","node","on","setWildType","init","isFastToResult","isFreeMode","curentConfig","config","STATS","mode","reels","tableFormat","TABLE_FORMAT_FREE","TABLE_FORMAT","col","length","reel","instantiate","reelPrefab","name","parent","table","zIndex","mainComponent","symbolPrefab","setPosition","getXPosition","initTable","startSpinning","isStopRunning","isHavingFakeWild","stopReeWithRandomMatrix","callback","matrixRandom","row","getRandomSymbolNameWithException","stopSpinning","matrix","subSym","data","tableData","bigSymbols","stopSpinningCallbackCount","countSoundScatter","currentCol","checkAdd","symbolValue","emit","push","stopSpinningWithDelay","checkStopSpinningCallback","bind","isMissWild","context","lastWildColumn","countWild","changeMatrix","rowOffset","showSymbols","changeToSymbol","type","playFishFlyingAnimation","fishFlyingData","isTurbo","speedUpFishFlyingEffect"],"mappings":"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","file":"SlotTable9983.js","sourceRoot":"../../../../../../assets/cc-taoquan-9983/scripts/table","sourcesContent":["cc.Class({\n    extends: require('SlotTablev2'),\n\n    properties: {\n        fishFlyingController : cc.Node\n    },\n\n    onLoad() {\n        this._super();\n        this.node.on(\"SET_WILD_TYPE\", this.setWildType, this);\n    },\n\n    init() {\n        this.isFastToResult = false;\n        this.node.isFreeMode = this.isFreeMode;\n        this.node.curentConfig = this.node.config.STATS[this.node.mode];\n        this.node.reels = [];\n        this.tableFormat = this.isFreeMode ? this.node.config.TABLE_FORMAT_FREE : this.node.config.TABLE_FORMAT;\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            const reel = cc.instantiate(this.reelPrefab);\n            //Must attach to node so component can be loadded\n            reel.name = \"Reel_\" + col;\n            reel.parent = this.table;\n            //Then we can use this\n            reel.zIndex = this.tableFormat.length - 1 - col;\n            reel.mainComponent.init(this.tableFormat[col], this.node.config, col, this.symbolPrefab, this.isFreeMode);\n            reel.setPosition(this.getXPosition(col), 0);\n            this.node.reels[col] = reel.mainComponent;\n            reel.mainComponent.initTable(this);\n        }\n    },\n\n    startSpinning() {\n        this.isStopRunning = false;\n        this.isHavingFakeWild = false;\n        this._super();\n    },\n\n    stopReeWithRandomMatrix(callback) {\n        let matrixRandom = [];\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            matrixRandom[col] = [];\n            for (let row = this.tableFormat[col] - 1; row >= 0; --row) {\n                matrixRandom[col][row] = this.node.reels[col].getRandomSymbolNameWithException([\"A\", \"K\", \"s1\", \"s2\"]);\n            }\n        }\n        this.stopSpinning({ matrix: matrixRandom, subSym: [] }, () => {\n            callback && callback();\n        });\n    },\n\n    stopSpinning(data, callback) {\n        const { matrix, subSym } = data;\n        this.tableData = data;\n        this.matrix = matrix;\n        this.subSym = subSym;\n        this.node.bigSymbols = [];\n        this.stopSpinningCallbackCount = 0;\n        this.countSoundScatter = 0;\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            const currentCol = this.matrix[col];\n            let matrix = [];\n            let checkAdd = false;\n            for (let row = currentCol.length - 1; row >= 0; --row) {\n                let symbolValue = currentCol[row];\n                this.node.emit('CHECK_MEGA_SYMBOL', symbolValue, col, row);\n                matrix.push(symbolValue);\n                if (symbolValue == 'A' && checkAdd == false) {\n                    checkAdd = true;\n                    this.countSoundScatter = this.countSoundScatter + 1;\n                }\n            }\n            this.node.reels[col].stopSpinningWithDelay(col, matrix, data, this.checkStopSpinningCallback.bind(this, matrix, callback), this.isMissWild(this.matrix));\n        }\n\n        if (this.table) {\n            this.table.bigSymbols = this.node.bigSymbols;\n        }\n\n        this.node.emit('REEL_ABOUT_TO_STOP_NEARWIN', { reels: this.node.reels, data: matrix, subSym, context: this, });\n        this.node.emit('REEL_ABOUT_TO_STOP_SOUND', { reels: this.node.reels, data: matrix, context: this, });\n        this.node.emit('REEL_ABOUT_TO_STOP_EFFECT', { reels: this.node.reels, data: matrix, context: this, });\n        this.node.emit('REEL_ABOUT_TO_STOP_MISC', { reels: this.node.reels, data: matrix, context: this, });\n    },\n\n    isMissWild(matrix) {\n        if (this.isFreeMode) return;\n        this.lastWildColumn = -1;\n        let countWild = 0;\n        for (let col = 0; col < matrix.length; col++) {\n            for (let row = 0; row < matrix[col].length; row++) {\n                if (matrix[col][row] === 'K') {\n                    countWild++;\n                    this.lastWildColumn = col;\n                }\n            }\n        }\n        return countWild === 0;\n    },\n\n    changeMatrix({ matrix, rowOffset = 0 }) {\n        this.matrix = matrix;\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            for (let row = 0; row < this.tableFormat[col]; ++row) {\n                this.node.reels[col].showSymbols[row + rowOffset].changeToSymbol(this.matrix[col][row]);\n            }\n        }\n    },\n\n    checkStopSpinningCallback(matrix, callback) {\n        this._super(matrix, callback);\n        if (this.fishFlyingController && !this.isFastToResult) {\n            this.fishFlyingController.emit('PLAY_SOUND_FISH_FLYING_END', this.stopSpinningCallbackCount - 1);\n        }\n        if (this.stopSpinningCallbackCount >= this.node.reels.length && callback && typeof callback == \"function\") {\n            this.node.emit('STOP_SPINNING_SOUND');\n            this.fishFlyingController.emit('STOP_FISH_FLYING_EFFECT');\n        }\n    },\n\n    setWildType(type) {\n        for (let col = 0; col < this.tableFormat.length; ++col) {\n            this.node.reels[col].setWildType(type);\n        }\n    },\n\n    playFishFlyingAnimation(fishFlyingData) {\n        fishFlyingData.isTurbo = this.node.mode === 'TURBO';\n        fishFlyingData.lastWildColumn = this.lastWildColumn;\n        this.fishFlyingController.emit('PLAY_FISH_FLYING_EFFECT', fishFlyingData);\n    },\n    \n    speedUpFishFlyingEffect(fishFlyingData) {\n        this.fishFlyingController.emit('SPEED_UP_FISH_FLYING_EFFECT', fishFlyingData);\n    },\n});"]}