{"version":3,"sources":["Broadcaster.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../../assets/cc-common/cc-slot-base-test/Streaming/scripts","sourcesContent":["cc.macro.ENABLE_TRANSPARENT_CANVAS = true;\nconst wsURL = \"wss://my-test-streaming-hgq4ku4h.livekit.cloud\"\nimport {Room, RoomEvent, VideoQuality } from 'livekit-client';\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class Broadcaster extends cc.Component {\n\n    @property(cc.Label)\n    roomName = null;\n\n    @property(cc.Label)\n    roomStatus = null;\n\n    @property(cc.EditBox)\n    token = null;\n\n    _room = null;\n\n    onLoad(): void {\n        this.createVideoDiv();\n    }\n\n    createVideoDiv() {\n        const container = CC_DEV ? document.getElementById('GameDiv') : document.body;\n        const remoteVideo = document.createElement('div');\n        const localVideo = document.createElement('div');\n        remoteVideo.id = 'remoteVideo';\n        localVideo.id = 'localVideo';\n        container.insertBefore(localVideo, container.firstChild);\n        container.insertBefore(remoteVideo, container.firstChild);\n    }\n\n    start(): void {\n        this._room = new Room();\n        this._room.on(RoomEvent.Connected, this.onRoomConnected.bind(this));\n        this._room.on(RoomEvent.Disconnected, this.onRoomDisconnected.bind(this));\n        this._room.on(RoomEvent.Reconnected, this.onRoomStatusChange.bind(this));\n        this._room.on(RoomEvent.Reconnecting, this.onRoomStatusChange.bind(this));\n    }\n\n    onRoomConnected() {\n        this.roomName.string = `Room: ${this._room.name}`;\n        this.onRoomStatusChange();\n    }\n\n    onRoomDisconnected() {\n        this.roomName.string = `Room: n/a`;\n        this.onRoomStatusChange();\n    }\n\n    onRoomStatusChange() {\n        this.roomStatus.string = `Status: ${this._room.state}`;\n    }\n\n\n    onClickJoinRoom() {\n        this.joinRoomWithToken(wsURL, this.token.string)\n        .then(() => {\n            console.log('Join room successfully');\n            this.subscribeOthers();\n            this.listenRoomEvents();\n        })\n        .catch((e)=>{\n            this.roomStatus.string = `Status: Failed connecting to room`;\n            console.log('Error while connecting to room, please recheck token');\n        })\n    }\n\n    joinRoomWithToken(socket, token) {\n        console.log('joinRoom, waiting for connect...');        \n        return this._room.connect(socket, token, {\n            autoSubscribe: false,\n        });\n    }\n\n    listenRoomEvents() {\n        this._room.on(RoomEvent.ParticipantConnected, this.handleParticipantConnected.bind(this));\n        this._room.on(RoomEvent.ParticipantDisconnected, this.handleParticipantDisconnected.bind(this));\n        this._room.on(RoomEvent.TrackSubscribed, this.handleTrackSubscribed.bind(this));\n        this._room.on(RoomEvent.TrackUnsubscribed, this.handleTrackUnsubscribed.bind(this));\n        this._room.on(RoomEvent.TrackPublished, this.handleTrackPublished.bind(this));\n        this._room.on(RoomEvent.TrackUnpublished, this.handleTrackUnpublished.bind(this));\n        this._room.on(RoomEvent.TrackMuted, this.handleTrackMuted.bind(this));\n    }\n\n    handleParticipantConnected(RemoteParticipant) {\n        cc.log('[LiveKit] new participant connected: ', RemoteParticipant.identity);\n\n    }\n\n    handleParticipantDisconnected(RemoteParticipant) {\n        cc.log('[LiveKit] participant disconnected: ', RemoteParticipant.identity);\n    }\n\n    //subscribe all participants in the room\n    subscribeOthers() {\n        this._room.participants.forEach((participant) => {\n            participant.tracks.forEach((publication) => {\n              publication.setSubscribed(true);\n            })\n        })\n    }\n\n    startBroadcast() {\n        console.log('startBroadcast');\n        this._room.localParticipant.setCameraEnabled(true);\n        this._room.localParticipant.setMicrophoneEnabled(true);\n        this._room.on(RoomEvent.LocalTrackPublished, this.handleLocalTrackPublished.bind(this));\n    }\n\n    handleLocalTrackPublished(trackPublication) {\n        //display local video on screen & skip audio\n        if (trackPublication.kind === 'video') {\n            const container = document.getElementById('localVideo');\n            const videoElement = trackPublication.track.attach();\n            container.insertBefore(videoElement, container.firstChild);\n            videoElement.style = `position: absolute; bottom: 0px; right: 0px; visibility: visible; width: 33%; height: 33%;`\n            videoElement.zIndex = -1;\n        }\n    }\n\n    stopBroadcast() {\n        console.log('stopBroadcast');\n        this._room.localParticipant.setCameraEnabled(false);\n        this._room.localParticipant.setMicrophoneEnabled(false);\n    }\n\n    handleTrackMuted(track, publication, participant) {\n        //Event raised when MC stop broadcast media/streaming\n        console.log('Handle track muted/stop broadcast from MC');\n    }\n\n    handleTrackUnpublished(publication, participant) {\n        //Event raised when client stop subscribe MC, if it's not called from client\n    }\n\n    handleTrackPublished(publication, participant) {\n        //Event raise when a participant start broadcast media/streaming\n        publication.setSubscribed(true);\n    }\n\n    handleTrackUnsubscribed(track, publication, participant) {\n        //Event raised when a participant stop subscribe MC, if it's not called from client\n    }\n\n    handleTrackSubscribed(track, publication, participant) {\n        publication.setVideoQuality(VideoQuality.HIGH);\n\n        if (track.kind === 'video') {\n            const container = document.getElementById('remoteVideo');\n            const videoElement = track.attach();\n            container.insertBefore(videoElement, container.firstChild);\n            videoElement.style = `position: absolute; bottom: 0px; left: 0px; visibility: visible; width: 100%; height: 100%;`\n        }\n        else if (track.kind === 'audio') {\n            const container = document.getElementById('Cocos2dGameContainer');\n            const audioElement = track.attach();\n            container.appendChild(audioElement);\n        }\n    }\n}\n"]}