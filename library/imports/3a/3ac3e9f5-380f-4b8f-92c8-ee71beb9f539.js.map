{"version":3,"sources":["../../../../../../../assets/cc-common/cc-slotbase-v2/portrailGame/gui/assets/cc-common/cc-slotbase-v2/portrailGame/gui/TouchPayableSymbol.js"],"names":["EventListenerManager","require","cc","Class","extends","Component","properties","gradient","Node","infoSymbol","touchBlocks","onLoad","node","showInfoSymbol","bind","hideInfoSymbol","on","EventType","TOUCH_END","onInfoSymbolTouchEnded","serviceId","config","GAME_ID","eventListenerManager","getInstance","registerEvent","active","i","length","TOUCH_START","onBlockTouchStarted","unRegisterAll","targetOff","wLocation","symbol","spineData","spineBorder","pos","parent","convertToNodeSpaceAR","getBoundingBox","contains","opacity","twFadeIn","stop","tween","to","call","emit","showTouchBlocks","start","SYMBOL_SPECIALS","indexOf","mainComponent","symbolName","soundPlayer","playGodTap","playSFXClick","p1","convertToWorldSpaceAR","getPosition","p2","isLeftBorder","Layout","HorizontalDirection","LEFT_TO_RIGHT","isRightBorder","RIGHT_TO_LEFT","isMiddle","twFadeOut","onDestroy","log","isOn","event","stopPropagation"],"mappings":"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","file":"TouchPayableSymbol.js","sourceRoot":"../../../../../../../assets/cc-common/cc-slotbase-v2/portrailGame/gui","sourcesContent":["const EventListenerManager = require(\"EventListenerManager\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        gradient : cc.Node,\n        infoSymbol : cc.Node,\n        touchBlocks: [cc.Node],\n    },\n\n    onLoad() {\n        this.node.showInfoSymbol = this.showInfoSymbol.bind(this);\n        this.node.hideInfoSymbol = this.hideInfoSymbol.bind(this);\n        this.infoSymbol.on(cc.Node.EventType.TOUCH_END, this.onInfoSymbolTouchEnded, this);\n        let serviceId = this.node.config.GAME_ID || \"9966\";\n        this.eventListenerManager = EventListenerManager.getInstance(serviceId);\n        this.registerEvent();\n        this.node.active = false;\n        for(let i = 0; i< this.touchBlocks.length; i++){\n            this.touchBlocks[i].on(cc.Node.EventType.TOUCH_START, this.onBlockTouchStarted, this);\n        }\n    },\n\n    registerEvent() {\n        if (this.eventListenerManager) {\n            this.eventListenerManager.on(\"SHOW_SYMBOL_PAYTABLE_INFO\", this.showInfoSymbol, this);\n            this.eventListenerManager.on(\"HIDE_SYMBOL_PAYTABLE_INFO\", this.hideInfoSymbol, this);\n        }\n    },\n    unRegisterAll() {\n        if (this.eventListenerManager) {\n            this.eventListenerManager.targetOff(this);\n        }\n    },\n\n    showInfoSymbol(wLocation, symbol , spineData, spineBorder) {\n        const pos = this.gradient.parent.convertToNodeSpaceAR(wLocation);\n        if(!this.gradient.getBoundingBox().contains(pos)) {\n            return;\n        }\n        \n        if (this.node.active == false){\n            this.node.active = true;\n            this.infoSymbol.active = true;\n            this.node.opacity = 0;\n            this.twFadeIn && this.twFadeIn.stop();\n            this.twFadeIn = cc.tween(this.node)\n                .to(0.03, {opacity : 255})\n                .call(()=>{\n                    this.twFadeIn = null;\n                    if(this.eventListenerManager){\n                        this.eventListenerManager.emit(\"ON_SHOW_SYMBOL_INFO\", true);\n                    }\n                    this.showTouchBlocks();\n                })\n                .start();\n        }\n        const SYMBOL_SPECIALS = (this.node.config && this.node.config.SYMBOL_SPECIALS) || [];\n        if (SYMBOL_SPECIALS.indexOf(symbol.mainComponent.symbolName) !== -1) {\n            this.node.soundPlayer && this.node.soundPlayer.playGodTap();\n        } else {\n            this.node.soundPlayer && this.node.soundPlayer.playSFXClick();\n        }\n        const symbolName = symbol.mainComponent.symbolName;\n        const p1 = symbol.parent.convertToWorldSpaceAR(symbol.getPosition());\n        const p2 = this.infoSymbol.parent.convertToNodeSpaceAR(p1);\n        this.infoSymbol.emit(\"UPDATE_DATA\", symbol.mainComponent.symbolName,spineData, spineBorder);\n        if (symbol.isLeftBorder) {\n            this.infoSymbol.emit(\"UPDATE_LAYOUT\", cc.Layout.HorizontalDirection.LEFT_TO_RIGHT, p2, symbolName);\n        } else if (symbol.isRightBorder) {\n            this.infoSymbol.emit(\"UPDATE_LAYOUT\", cc.Layout.HorizontalDirection.RIGHT_TO_LEFT, p2, symbolName);\n        } else if (symbol.isMiddle) {\n            this.infoSymbol.emit(\"UPDATE_LAYOUT\", cc.Layout.HorizontalDirection.LEFT_TO_RIGHT, p2, symbolName);\n        }\n    },\n\n    hideInfoSymbol(){\n        this.twFadeOut && this.twFadeOut.stop();\n        this.twFadeOut = cc.tween(this.node)\n            .to(0.03, {opacity : 0})\n            .call(()=>{\n                this.twFadeOut = null;\n                if(this.eventListenerManager){\n                    this.eventListenerManager.emit(\"ON_SHOW_SYMBOL_INFO\", false);\n                }\n                this.infoSymbol.emit(\"RESET_ANIM\");\n                this.infoSymbol.active = false;\n                this.node.active  = false;\n            })\n            .start();\n    },\n\n    onDestroy(){\n        this.unRegisterAll();\n    },\n\n    onBlockTouchStarted(){\n        this.showTouchBlocks(false);\n        cc.log(\">>> On Touch Started on Block!\");\n        this.hideInfoSymbol();\n    },\n\n    showTouchBlocks(isOn = true){\n        for(let i = 0; i< this.touchBlocks.length; i++){\n            this.touchBlocks[i].active = isOn;\n        }\n    },\n\n    onInfoSymbolTouchEnded(event){\n        if(event) event.stopPropagation();\n        this.hideInfoSymbol();\n    }\n\n});\n"]}