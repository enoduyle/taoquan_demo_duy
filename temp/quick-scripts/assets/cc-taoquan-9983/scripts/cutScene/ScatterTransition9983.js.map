{"version":3,"sources":["ScatterTransition9983.js"],"names":["cc","Class","extends","require","properties","particleNode","Node","table","destPos","plus1fx","onLoad","_super","storePos","position","enter","content","matrix","isNormal","opacity","parList","scatCoorList","i","length","j","push","v2","playAnim","scrollAnim","arrCoor","particle","instantiate","parent","active","x","getXPosition","colCount","height","node","config","SYMBOL_HEIGHT","y","delayTime","tween","to","call","runAction","spawn","fadeOut","moveBy","delay","exit","start","overlay","getChildByName","isScrolling","rollLeft","angle","easing","rollRight","scroll","callback","emit","exitForNormal","update","width","removeFromParent","destroy","stopAllActions","index","SYMBOL_WIDTH","SYMBOL_MARGIN_RIGHT"],"mappings":"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","file":"ScatterTransition9983.js","sourceRoot":"../../../../../../assets/cc-taoquan-9983/scripts/cutScene","sourcesContent":["\ncc.Class({\n    extends: require('CutsceneMode'),\n\n    properties: {\n        particleNode: cc.Node,\n        table: cc.Node,\n        destPos: cc.Node,\n        plus1fx: cc.Node,\n    },\n\n    onLoad() {\n        this._super();\n        this.plus1fx.storePos = this.plus1fx.position;\n    },\n\n    enter() {\n        const {matrix,isNormal} = this.content;\n        this.plus1fx.opacity = 0;\n        this.parList = [];\n        if(!isNormal){\n            let scatCoorList = [];\n            for(let i = 0; i < matrix.length; ++i){\n                let j = 0;\n                for(; j < matrix[i].length; ++j){\n                    if(matrix[i][j] === 'A'){\n                        scatCoorList.push(cc.v2(i,j));\n                        break;\n                    }\n                }\n                if(j >= matrix[i].length) break;\n            }\n            this.playAnim(scatCoorList);\n        }\n        else\n            this.scrollAnim();\n    },\n    playAnim(arrCoor){\n        for(let i = 0; i < arrCoor.length; ++i){\n            let particle = cc.instantiate(this.particleNode);\n            particle.parent = this.table;\n            particle.active = true;\n            particle.x = this.getXPosition(arrCoor[i].x);\n            let colCount = (0< arrCoor[i].x && arrCoor[i].x <4) ? 4 : 4;\n            let height = (this.node.config.SYMBOL_HEIGHT/1) * 0.87;\n            particle.y =  (colCount - arrCoor[i].y) * height - height/2;\n            this.parList.push(particle);\n            const delayTime = 0.25;\n            cc.tween(particle)\n                .to(0.5, {x: this.destPos.x, y: this.destPos.y})\n                .call(()=>{\n                    this.plus1fx.opacity = 255;\n                    this.plus1fx.position = this.plus1fx.storePos;\n                    this.plus1fx.runAction(cc.spawn(\n                        cc.fadeOut(delayTime),\n                        cc.moveBy(delayTime, 0, 10),\n                    ));\n                })\n                .delay(delayTime)\n                .call(()=>{\n                    this.exit();\n                })\n                .start();\n        }\n    },\n    scrollAnim(){\n        let overlay = this.node.getChildByName('overlay');\n        cc.tween(overlay)\n            .to(0.75, {opacity: 150})\n            .call(()=>{\n                // let particle = this.node.getChildByName('phaohoa');\n                // particle.active = true;\n            })\n            .start();\n\n        cc.tween(this.node)\n            .call(()=>{\n                this.isScrolling = true;\n                let rollLeft = this.node.getChildByName('Roll_Left');\n                cc.tween(rollLeft)\n                    .to(0.5, {opacity: 255})\n                    .to(0.7, {x: -300, y: -30, angle: 15}, {easing: 'backOut'})\n                    .start();\n                let rollRight = this.node.getChildByName('Roll_Right');\n                cc.tween(rollRight)\n                    .to(0.5, {opacity: 255})\n                    .to(0.7, {x: 300, y: -30, angle: -15}, {easing: 'backOut'})\n                    .start();\n                let scroll = this.node.getChildByName('scroll');\n                cc.tween(scroll)\n                    .to(0.5, {opacity:255})\n                    .start();\n            })\n            .delay(1.25)\n            .call(()=>{\n                let overlay = this.node.getChildByName('overlay');\n                cc.tween(overlay)\n                    .call(()=>{\n                        // let particle = this.node.getChildByName('phaohoa');\n                        // particle.active = true;\n                    })\n                    .to(0.75, {opacity: 0})\n                    .start();\n            })\n            .delay(0.25)\n            .call(()=>{\n                if (this.callback && typeof this.callback == \"function\") {\n                    this.node.emit(\"STOP\");\n                    this.callback();\n                }\n            })\n            .delay(1.5)\n            .call(()=>{\n                this.isScrolling = false;\n                this.exitForNormal();\n            })\n            .start();\n\n    },\n\n    update(){\n        if(this.isScrolling){\n            let rollLeft = this.node.getChildByName('Roll_Left');\n            let rollRight = this.node.getChildByName('Roll_Right');\n            let scroll = this.node.getChildByName('scroll');\n            scroll.width  = rollRight.x - rollLeft.x - 50;\n        }\n    },\n    exitForNormal(){\n        for(let i = 0; i < this.parList.length; ++i){\n            this.parList[i].removeFromParent(true);\n            this.parList[i].destroy();\n        }\n        let rollLeft = this.node.getChildByName('Roll_Left');\n        rollLeft.x = -75;\n        rollLeft.y = 15;\n        rollLeft.angle = 0;\n        rollLeft.opacity = 0;\n        let rollRight = this.node.getChildByName('Roll_Right');\n        rollRight.x = 75;\n        rollRight.y = 15;\n        rollRight.angle = 0;\n        rollRight.opacity = 0;\n        let scroll = this.node.getChildByName('scroll');\n        scroll.opacity = 0;\n\n        this.node.active = false;\n    },\n\n    exit() {\n        const overlay = this.node.getChildByName('overlay');\n        if (overlay) {\n            overlay.stopAllActions();\n        }\n        this.node.stopAllActions();\n        if (this.callback && typeof this.callback == \"function\") {\n            this.node.emit(\"STOP\");\n            this.callback();\n        }\n        for(let i = 0; i < this.parList.length; ++i){\n            this.parList[i].removeFromParent(true);\n            this.parList[i].destroy();\n        }\n        let rollLeft = this.node.getChildByName('Roll_Left');\n        rollLeft.opacity = 0;\n        let rollRight = this.node.getChildByName('Roll_Right');\n        rollRight.opacity = 0;\n        let scroll = this.node.getChildByName('scroll');\n        scroll.opacity = 0;\n\n        this.node.active = false;\n    },\n    getXPosition(index) {\n        let width = this.node.config.SYMBOL_WIDTH * 1;\n        return (width + this.node.config.SYMBOL_MARGIN_RIGHT) * index + width/2;\n    },\n});\n"]}